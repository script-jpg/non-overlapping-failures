-- All the solutions to the equation are rational.
  have h₂ : ∀ x : ℝ, x ∈ S → a * x = 2 ∨ a * x = 3 ∨ a * x = 11 ∨ a * x = 17 ∨ a * x = 19 ∨ a * x = 31 ∨ a * x = 37 ∨ a * x = 41 ∨ a * x = 43 ∨ a * x = 47 ∨ a * x = 53 ∨ a * x = 59 ∨ a * x = 61 ∨ a * x = 67 ∨ a * x = 71 ∨ a * x = 73 ∨ a * x = 79 ∨ a * x = 83 ∨ a * x = 89 ∨ a * x = 97 ∨ a * x = 101 ∨ a * x = 103 ∨ a * x = 107 ∨ a * x = 109 ∨ a * x = 113 ∨ a * x = 121 ∨ a * x = 127 ∨ a * x = 131 ∨ a * x = 137 ∨ a * x = 139 ∨ a * x = 149 ∨ a * x = 151 ∨ a * x = 157 ∨ a * x = 163 ∨ a * x = 167 ∨ a * x = 173 ∨ a * x = 179 ∨ a * x = 181 ∨ a * x = 191 ∨ a * x = 193 ∨ a * x = 197 ∨ a * x = 199 ∨ a * x = 211 ∨ a * x = 223 ∨ a * x = 227 ∨ a * x = 229 ∨ a * x = 233 ∨ a * x = 239 ∨ a * x = 241 ∨ a * x = 251 ∨ a * x = 257 ∨ a * x = 263 ∨ a * x = 269 ∨ a * x = 271 ∨ a * x = 277 ∨ a * x = 281 ∨ a * x = 283 ∨ a * x = 293 ∨ a * x = 307 ∨ a * x = 311 ∨ a * x = 313 ∨ a * x = 317 ∨ a * x = 331 ∨ a * x = 337 ∨ a * x = 347 ∨ a * x = 349 ∨ a * x = 353 ∨ a * x = 359 ∨ a * x = 367 ∨ a * x = 373 ∨ a * x = 379 ∨ a * x = 383 ∨ a * x = 389 ∨ a * x = 397 ∨ a * x = 401 ∨ a * x = 409 ∨ a * x = 419 ∨ a * x = 421 ∨ a * x = 431 ∨ a * x = 433 ∨ a * x = 439 ∨ a * x = 443 ∨ a * x = 449 ∨ a * x = 457 ∨ a * x = 461 ∨ a * x = 463 ∨ a * x = 467 ∨ a * x = 479 ∨ a * x = 487 ∨ a * x = 491 ∨ a * x = 499 ∨ a * x = 503 ∨ a * x = 509 ∨ a * x = 521 ∨ a * x = 523 ∨ a * x = 541 ∨ a * x = 547 ∨ a * x = 557 ∨ a * x = 563 ∨ a * x = 569 ∨ a * x = 571 ∨ a * x = 577 ∨ a * x = 587 ∨ a * x = 593 ∨ a * x = 599 ∨ a * x = 601 ∨ a * x = 607 ∨ a * x = 613 ∨ a * x = 617 ∨ a * x = 619 ∨ a * x = 631 ∨ a * x = 641 ∨ a * x = 643 ∨ a * x = 647 ∨ a * x = 653 ∨ a * x = 659 ∨ a * x = 661 ∨ a * x = 673 ∨ a * x = 677 ∨ a * x = 683 ∨ a * x = 691 ∨ a * x = 701 ∨ a * x = 709 ∨ a * x = 719 ∨ a * x = 727 ∨ a * x = 733 ∨ a * x = 739 ∨ a * x = 743 ∨ a * x = 751 ∨ a * x = 757 ∨ a * x = 761 ∨ a * x = 769 ∨ a * x = 773 ∨ a * x = 787 ∨ a * x = 797 ∨ a * x = 809 ∨ a * x = 811 ∨ a * x = 821 ∨ a * x = 823 ∨ a * x = 827 ∨ a * x = 829 ∨ a * x = 839 ∨ a * x = 853 ∨ a * x = 857 ∨ a * x = 859 ∨ a * x = 863 ∨ a * x = 877 ∨ a * x = 881 ∨ a * x = 883 ∨ a * x = 887 ∨ a * x = 907 ∨ a * x = 911 ∨ a * x = 919 ∨ a * x = 929 ∨ a * x = 937 ∨ a * x = 941 ∨ a * x = 947 ∨ a * x = 953 ∨ a * x = 967 ∨ a * x = 971 ∨ a * x = 977 ∨ a * x = 983 ∨ a * x = 991 ∨ a * x = 997\} := by
    intro x hx
    rw [h₀] at hx
    set n := ↑⌊x⌋ with hn
    set r := x - ↑⌊x⌋ with hr
    have hn : n = ⌊x⌋ := by
      exact_mod_cast hn
    have hr : r = x - ⌊x⌋ := by
      exact_mod_cast hr
    rw [show x = ↑⌊x⌋ + (x - ↑⌊x⌋) by ring] at hx
    rw [hn, hr] at hx
    rw [mul_add] at hx
    rcases mul_right_eq_self.mp hx with h | h
    · left; exact h
    · have : n ≥ 0 := by
        rw [hn]
        exact Int.floor_nonneg.mpr (by linarith)
      have : n ≠ 0 := by
        intro hn
        rw [hn] at hx
        simp at hx
        linarith
      have : r < 1 := by
        rw [hr]
        exact sub_lt_self.mpr (Int.lt_floor_add_one x)
      nlinarith

  -- Each rational solution to the equation is of the form $x = \frac{m}{n}$ where $m$ and $n$ are relatively prime positive integers.
  have h₃ : ∀ x : ℝ, x ∈ S → ∃ m n : ℕ, x = ↑m / ↑n ∧ Nat.Prime m ∧ Nat.Prime n ∧ Nat.Coprime m n := by
    intro x hx
    specialize h₂ x hx
    rcases h₂ with h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ | h₂ := h₂
    · -- x = 2 / a
      have h₃ : x = 2 / a := by
        rw [← h₂]
        field_simp
      have h₄ : a ≠ 0 := by
        intro ha
        rw [ha] at h₃
        simp at h₃
        linarith
      use 2 * x.den, x.den
      rw [h₃]
      refine ⟨?_,?_,?_⟩
      · -- m = 2 * x.den
        -- m = 2 * n
        apply Nat.prime_mul.1
        · apply Nat.prime_two
        · rw [hn]
          exact (x.den).ne_zero
      · apply Nat.prime_den_of_ne_zero
        exact (x.den).ne_zero
      · -- m and n are coprime
        rw [hn, Nat.coprime_mul_iff_left]
        have : x.den.Coprime (2 * x.den) := by
          apply Nat.Coprime.mul_right
          apply Nat.coprime_den
        have h₅ : x.Coprime 2 := by
          rw [← h₃]
          apply Rat.coprime_iff_coprime_int.mp
          apply Nat.coprime_of_lt_prime
          · exact Nat.prime_two
          · exact Nat.coprime_two_of_ne_even
          · simp
            by_contra h
            rw [h] at h₃
            simp at h₃
            have : x * x = 1/2 * (2 / x * x) := by
              rw [h₃]
              ring
            rw [this, mul_assoc, mul_inv_cancel₀] at h₃
            norm_num at h₃
            let n := x.den * 2
            have h₆ : x = (n + 1) / (2 * n) := by
              rw [h₃]
              congr
              · have : x.den * 2 = n + 1 := by
                  calc
                    x.den * 2 = 2 * x.den := by ring
                    _ = n + 1 := by rw [hn]
                linarith
              · calc
                  x.den * 2 = n + 1 := by rw [h₆]
                  _ = (n + 1) * 2 / 2 := by rw [Nat.mul_div_cancel]
                  _ = 2 * (n + 1) / 2 := by ring
                  _ = 2 * n / 2 + 2 / 2 := by rw [Nat.add_mul_div_right]
                  _ = n + 1 := by norm_num
            rw [h₆, Rat.coprime_iff_coprime_int]
            apply Nat.Coprime.mul_left
            apply Nat.coprime_add_of_coprime_mul_right
            · exact Nat.coprime_two_right.mpr h₅
            · apply Nat.Prime.coprime
              · exact Nat.prime_two
              · by_contra h₇
                have h₈ : x = -1 := by
                  rw [h₇] at h₃
                  linarith
                rw [h₈] at h₆
                simp at h₆
                linarith
            · apply Nat.Prime.coprime
              · exact h₅
              · by_contra h₉
                have h₁₀ : x = 2 := by
                  rw [h₉] at h₃
                  linarith
                rw [h₁₀] at h₆
                simp at h₆
                linarith
        rw [← h₃]
        apply Rat.coprime_iff_coprime_int.2
        apply Nat.Coprime.mul_right
        · apply Nat.coprime_den
        · apply Nat.Prime.coprime
          · exact Nat.prime_two
          · by_contra h₁₁
            have h₁₂ : x = -1 := by
              rw [h₁₁] at h₃
              linarith
            rw [h₁₂] at h₄
            simp at h₄
            linarith
    · -- x = 3 / a
      have h₃ : x = 3 / a := by
        rw [← h₂]
        field_simp
      have h₄ : a ≠ 0 := by
        intro ha
        rw [ha] at h₃
        simp at h₃
        linarith
      use 3 * x.den, x.den
      rw [h₃]
      refine ⟨?_,?_,?_⟩
      · -- m = 3 * x.den
        -- m = 3 * n
        apply Nat.prime_mul.1
        · apply Nat.prime_three
        · rw [hn]
          exact (x.den).ne_zero
      · apply Nat.prime_den_of_ne_zero
        exact (x.den).ne_zero
      · -- m and n are coprime
        rw [hn, Nat.coprime_mul_iff_left]
        have : x.den.Coprime (3 * x.den) := by
          apply Nat.Coprime.mul_right
          apply Nat.coprime_den
        have h₅ : x.Coprime 3 := by
          rw [← h₃]
          apply Rat.coprime_iff_coprime_int.mp
          apply Nat.coprime_of_lt_prime
          · exact Nat.prime_three
          · exact Nat.coprime_three_of_ne
          · simp
            by_contra h
            rw [h] at h₃
            simp at h₃
            linarith
        rw [h₃]
        apply Rat.coprime_iff_coprime_int.2
        apply Nat.Coprime.mul_right
        · apply Nat.coprime_den
        · apply Nat.Prime.coprime
          · exact Nat.prime_three
          · by_contra h₇
            have h₈ : x = -1 := by
              rw [h₇] at h₃
              linarith
            rw [h₈] at h₄
            simp at h₄
            linarith
    · -- x = 11 / a
      have h₃ : x = 11 / a := by
        rw [← h₂]
        field_simp
      have h₄ : a ≠ 0 := by
        intro ha
        rw [ha] at h₃
        simp at h₃
        linarith
      use 11 * x.den, x.den
      rw [h₃]
      refine ⟨?_,?_,?_⟩
      · -- m = 11 * x.den
        -- m = 11 * n
        apply Nat.prime_mul.1
        · apply Nat.prime_eleven
        · rw [hn]
          exact (x.den).ne_zero
      · apply Nat.prime_den_of_ne_zero
        exact (x.den).ne_zero
      · -- m and n are coprime
        rw [hn, Nat.coprime_mul_iff_left]
        have : x.den.Coprime (11 * x.den) := by
          apply Nat.Coprime.mul_right
          apply Nat.coprime_den
        have h₅ : x.Coprime 11 := by
          rw [← h₃]
          apply Rat.coprime_iff_coprime_int.mp
          apply Nat.coprime_of_lt_prime
          · exact Nat.prime_eleven
          · exact Nat.coprime_eleven_of_ne
          · simp
            by_contra h
            rw [h] at h₃
            simp at h₃
            have : x * x = 1/11 * (11 / x * x) := by
              rw [h₃]
              ring
            rw [this, mul_assoc, mul_inv_cancel₀] at h₃
            norm_num at h₃
            let n := x.den * 11
            have h₆ : x = (n + 11) / (11 * n) := by
              rw [h₃]
              congr
              · have : x.den * 11 = n + 11 := by
                  calc
                    x.den * 11 = 11 * x.den := by ring
                    _ = n + 11 := by rw [hn]
                  linarith
              · calc
                  x.den * 11 = n + 11 := by rw [h₆]
                  _ = (n + 11) * 11 / 11 := by rw [Nat.mul_div_cancel]
                  _