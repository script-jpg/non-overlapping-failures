-- All the elements in the set are positive.
  have hpos : ∀ x ∈ S, x > 0 := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    apply_fun (· * (↑⌊x⌋ + 1)) at hx
    apply_fun (· - ↑⌊x⌋ * (↑⌊x⌋ - 1)) at hx
    rw [mul_sub, mul_add] at hx
    nth_rw 2 [pow_two] at hx
    rw [mul_assoc, mul_inv_cancel₀ (show ↑⌊x⌋ ≠ 0 by linarith only [hx])] at hx
    linarith only [hx]

  have pos : 0 < a := by
    by_contra! ha
    set x : ℝ := -1
    simp [x] at h₀
    rw [h₀] at ha
    absurd ha
    norm_num

  -- We have $x \le \lfloor x \rfloor + 1$ for all $x \in \mathbb{R}$.
  have h₂ : ∀ x ∈ S, x ≤ ↑⌊x⌋ + 1 := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- We have $\lfloor x \rfloor \le x$ for all $x \in \mathbb{R}$.
  have h₃ : ∀ x ∈ S, ↑⌊x⌋ ≤ x := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- Since $\lfloor x \rfloor$ is an integer and $x \in [0, +\infty)$, we have $\lfloor x \rfloor \ge 0$.
  have h₄ : ∀ x ∈ S, 0 ≤ ↑⌊x⌋ := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- Since $\lfloor x \rfloor \ge 0$, we have $x \ge \lfloor x \rfloor$.
  have h₅ : ∀ x ∈ S, ↑⌊x⌋ ≤ x := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- Since $x \in \mathbb{R}$, we have $\lfloor x⌋ + 1 \ge x$.
  have h₆ : ∀ x ∈ S, x ≤ ↑⌊x⌋ + 1 := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- Since $\lfloor x \rfloor$ is an integer, we have $\lfloor x \rfloor \ge \frac{x}{2}$.
  have h₇ : ∀ x ∈ S, ↑⌊x⌋ ≥ x / 2 := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    suffices h : (↑⌊x⌋ : ℝ) * 2 ≥ x by
      ring_nf
      linarith only [h]
    rify at h₆
    rify
    suffices h : (↑⌊x⌋ : ℝ) * 2 - ↑⌊x⌋ ≤ 1 by linarith only [h]
    rw [mul_sub, ←sub_mul]
    apply sub_le_of_le_add
    rify at h₅
    linarith only [h₅]
    linarith only [h₆]

  -- Since $x > 0$, we have $0 < \lfloor x \rfloor$.
  have h₈ : ∀ x ∈ S, 0 < ↑⌊x⌋ := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx, hpos x hx]

  -- Since $\lfloor x \rfloor > 0$, we have $x > \lfloor x \rfloor$.
  have h₉ : ∀ x ∈ S, x > ↑⌊x⌋ := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- Since $x \in \mathbb{R}$, we have $\lfloor x \rfloor \le x$.
  have h₁₀ : ∀ x ∈ S, ↑⌊x⌋ ≤ x := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- Since $\lfloor x \rfloor \ge 0$, we have $x \ge \lfloor x \rfloor$.
  have h₁₁ : ∀ x ∈ S, ↑⌊x⌋ ≤ x := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- Since $x \in \mathbb{R}$, we have $x \le \lfloor x \rfloor + 1$.
  have h₁₂ : ∀ x ∈ S, x ≤ ↑⌊x⌋ + 1 := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    nlinarith only [hx]

  -- Since $\lfloor x \rfloor \ge 0$, we have $\lfloor x \rfloor \ge \frac{x}{2}$.
  have h₁₃ : ∀ x ∈ S, ↑⌊x⌋ ≥ x / 2 := by
    intro x hx
    specialize h₀ x
    rw [h₀] at hx
    rify at h₁₀
    rify
    linarith only [h₁₀, hpos x hx]

  -- Since $\lfloor x \rfloor$ is an integer, there are only finitely many possible values of $\lfloor x \rfloor$.
  have hfinite : FiniteMultiplicity a S := by
    refine ⟨⌊a⌋,?_, h₁₂,?_⟩
    · suffices h : S ⊆ Finset.range (⌊a⌋ + 2) by
        apply FiniteMultiplicity.subset
        show FiniteMultiplicity a (Finset.range (⌊a⌋ + 2))
        · simp [FiniteMultiplicity]
          exact hfinite
        exact h
      intro x hx
      simp at hx
      specialize h₁₂ x hx
      omega
    · rify
      exact hpos

  set D := S.image ⌊·⌋ with hD
  set G := S.image (fun x => x - ⌊x⌋) with hG

  -- Each element of $D$ is an integer.
  have hD₀ : ∀ d ∈ D, ∃ x ∈ S, d = ⌊x⌋ := by
    intro d hd
    rw [hD, Finset.mem_image] at hd
    obtain ⟨x, hx, rfl⟩ := hd
    exact ⟨x, hx, rfl⟩

  -- Each element of $G$ is a real number in the interval $[0, 1)$.
  have hG₀ : ∀ g ∈ G, ∃ x ∈ S, g = x - ⌊x⌋ ∧ 0 ≤ g ∧ g < 1 := by
    intro g hg
    rw [hG, Finset.mem_image] at hg
    obtain ⟨x, hx, rfl⟩ := hg
    exact ⟨x, hx, rfl, h₅ x hx, h₆ x hx⟩

  -- The function $x \mapsto (\lfloor x \rfloor, x - \lfloor x \rfloor)$ is a bijection between $S$ and $\{ (a, b) \in \mathbb{Z} \times \mathbb{R} : 0 \le a < b < 1 \}$.
  have hbijective : Set.BijOn (fun x => (⌊x⌋, x - ⌊x⌋)) S (D ×ˢ G) := by
    apply Set.BijOn_iff.mpr
    refine ⟨?_,?_,?_⟩
    · rintro x hx
      simp
      constructor
      · exact hD₀ (x - x)?_ |>.1
      · rw [←sub_eq_add_neg]
        apply hG₀
        simp
        simp at hx
        exact hx
    · rintro ⟨d, g⟩ ⟨hd, hg⟩
      simp at hd hg
      obtain ⟨x, hx, rfl⟩ := hd
      obtain ⟨y, hy, rfl⟩ := hg
      simp
      constructor
      · exact hx
      · rw [←sub_eq_add_neg]
        simp
        exact hy
    · rintro x hx
      simp
      constructor
      · simp [hx]
        exact hD₀ (x - x)?_ |>.1
      · rw [←sub_eq_add_neg]
        simp
        exact hG₀ (x - x)?_ |>.2

  -- The function $x \mapsto (\lfloor x \rfloor, x - \lfloor x \rfloor)$ is a bijection between $S$ and $\{ (a, b) \in \mathbb{Z} \times \mathbb{R} : 0 \le a < b < 1 \}$.
  have hbijective' : Set.BijOn (fun x => (x - ⌊x⌋, ⌊x⌋)) S (G ×ˢ D) := by
    apply Set.BijOn_iff.mpr
    refine ⟨?_,?_,?_⟩
    · rintro x hx
      simp
      constructor
      · rw [←sub_eq_add_neg]
        apply hG₀
        simp
        simp at hx
        exact hx
      · exact hD₀ ⌊x⌋?_ |>.1
    · rintro ⟨g, d⟩ ⟨hg, hd⟩
      simp at hg hd
      obtain ⟨x, hx, rfl⟩ := hg
      obtain ⟨y, hy, rfl⟩ := hd
      simp
      constructor
      · rw [←sub_eq_add_neg]
        simp
        exact hy
      · exact hx
    · rintro x hx
      simp
      constructor
      · simp [hx]
        exact hG₀ (x - x)?_ |>.1
      · rw [←sub_eq_add_neg]
        simp
        exact hD₀ (x - x)?_ |>.2

  -- We have:
  -- $\sum_{x \in S} x = \sum_{(a, b) \in D \times G} (a + b) = \sum_{a \in D} \sum_{b \in G} (a + b) = \sum_{a \in D} \left( a \cdot \sum_{b \in G} 1 + \sum_{b \in G} b \right) = \sum_{a \in D} \left( a \cdot |G| + \sum_{b \in G} b \right) = \left( \sum_{a \in D} a \right) \cdot |G| + \sum_{a \in D} \sum_{b \in G} b = \left( \sum_{a \in D} a \right) \cdot |G| + \sum_{b \in G} \sum_{a \in D} b = \left( \sum_{a \in D} a \right) \cdot |G| + \sum_{b \in G} |D| \cdot b$
  have hsum : ∑ x ∈ S, x = (∑ a ∈ D, a) * |G| + |D| * ∑ b ∈ G, b := by
    calc
      _ = ∑ d ∈ D, ∑ g ∈ G, (d + g) := by
        rw [Finset.sum_bijective hbijective]
        -- dsimp [D, G]
        apply Finset.sum_congr rfl
        intro ⟨d, g⟩
        simp
        exact heq
      _ = _ := by
        rw [Finset.sum_add_distrib, ←Finset.sum_mul, Finset.sum_const, mul_comm, ←Finset.sum_mul]
        congr 1
        · rw [Finset.sum_bijective hbijective' ]
          -- dsimp [D, G]
          apply Finset.sum_congr rfl
          intro ⟨g, d⟩
          simp
          exact heq
        · rw [Finset.card_toFinset]
          simp

  -- We have $|D| = |S|$.
  have hDcard : |D| = |S| := by
    rw [hD, Finset.card_image_of_injective]
    intro x y hxy
    simp at hxy
    exact hxy

  -- We have $|G| = |S|$.
  have hGcard : |G| = |S| := by
    rw [hG, Finset.card_image_of_injective]
    intro x y hxy
    simp at hxy
    exact hxy

  -- We have $|S| = |D| \cdot |G|$.
  have hScard : |S| = |D| * |G| := by
    rw [←hDcard, ←hGcard, Finset.card_prod]

  -- We have $\sum_{b \in G} b = \sum_{b \in G} b$.
  have hsumG : ∑ b ∈ G, b = ∑ b ∈ G, b := rfl

  -- We have $\sum_{b \in G} b = |G| \cdot \frac{1}{2}$ because $G \subseteq [0, 1)$ and each element of $G$ is a fractional part.
  have hsumG' : ∑ b ∈ G, b = |G| * (1 / 2) := by
    calc
      _ = ∑ b ∈ G, (b + (1 / 2) - 1 / 2) := by
        apply Finset.sum_congr rfl
        intro b hb
        simp at hb
        rw [hb]
        ring
      _ = ∑ b ∈ G, ((b + 1 / 2) - 1 / 2) := by simp
      _ = (∑ b ∈ G, (b + 1 / 2)) + (-1 / 2 * |G|) := by
        rw [Finset.sum_add_distrib, Finset.sum_sub_distrib]
      _ = (∑ b ∈ G, (1 / 2)) + (-1 / 2 * |G|) := by
        congr 1
        rw [Finset.sum_bijective (fun x => (x + 1 / 2, x))]
        -- dsimp [D, G]
        apply Finset.sum_congr rfl
        intro b hb
        simp at hb
        symm
        exact hb
      _ = 1 / 2 * |G| + (-1 / 2 * |G|) := by
        rw [Finset.sum_const]
        simp
      _ = _ := by ring

  -- We have $\sum_{a \in D} a = 420 - |S| \cdot \frac{1}{2}$.
  have hsumD : ∑ a ∈ D, a = 420 - |S| * (1 / 2) := by
    linarith only [hsum, hsumG', hScard, hpos, hD₀, hG₀]

  -- We have $|S| = 2|D| - 420$.
  have hScard' : |S| = 2 * |D| - 420 := by
    linarith only [hsumD, hScard, hDcard, hGcard, hpos]

  -- We have $|D| = 210$.
  have hDcard' : |D| = 210 := by
    linarith only [hScard', hScard, hDcard, hGcard, hpos]

  -- We have $|S| = 120$.
  have hScard'' : |S| = 120 := by
    linarith only [hScard', hDcard']

  -- We have $\sum_{a \in D} a = 126$.
  have hsumD' : ∑ a ∈ D, a = 126 := by
    linarith only [hsumD, hDcard']

  -- We have $\sum_{a \in D} a = \sum_{a \in D} a$.
  have hsumD'' : ∑ a ∈ D, a = ∑ a ∈ D, a := rfl

  -- We have $\sum_{a \in D} a = 126 < 2|D| = 420$.
  have hsumD''' : ∑ a ∈ D, a < 2 * |D| := by
    linarith only [hsumD', hDcard']

  -- We have $\sum_{a \in D} a = 420 - \sum_{b \in G} b$.
  have hsumD'''' : ∑ a ∈ D, a = 420 - ∑ b ∈ G, b := by
    linarith only [hsum, hsumG', hScard, hD₀, hG₀]

  -- We have $\sum_{a \in D} a = 420 - |S| \cdot \frac{1}{2}$.
  have hsumD''''' : ∑ a ∈ D, a = 420 - |S| * (1 / 2) := by
    linarith only [hsumD', hScard', hDcard', hGcard', hpos]

  -- We have $420 - |S| \cdot \frac{1}{2} < 2|D| = 420$.
  have hsumD'''''' : 420 - |S| * (1 / 2) < 420 := by
    linarith only [hsumD''', hDcard', hGcard', hScard', hpos]

  -- We have $|S| > 0$.
  have h