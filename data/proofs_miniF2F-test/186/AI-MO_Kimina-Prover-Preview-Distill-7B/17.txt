have h₄ : a * b * c * d = 40320 := by simp [Nat.factorial] at h₀; exact h₀
  have h₅ : a * b + a + b = 524 := h₁
  have h₆ : b * c + b + c = 146 := h₂
  have h₇ : c * d + c + d = 104 := h₃

  have abeq : a * b = 524 - a - b := by exact (Nat.eq_sub_of_add_eq h₅).symm
  have bceq : b * c = 146 - b - c := by exact (Nat.eq_sub_of_add_eq h₆).symm
  have cdeq : c * d = 104 - c - d := by exact (Nat.eq_sub_of_add_eq h₇).symm

  -- Show that $a \le 524$ and $b \le 146$ and $c \le 104$.
  have ha : a ≤ 524 := by
    rw [← abeq]
    nlinarith
  have hb : b ≤ 146 := by
    rw [← bceq]
    nlinarith
  have hc : c ≤ 104 := by
    rw [← cdeq]
    nlinarith

  -- Show that $a \le 40320$ and $b \le 40320$ and $c \le 40320$ and $d \le 40320$.
  have hab : a ≤ 40320 := by
    nlinarith
  have hbc : b ≤ 40320 := by
    nlinarith
  have hcd : c ≤ 40320 := by
    nlinarith
  have hda : d ≤ 40320 := by
    nlinarith

  -- Show that $a < 8!$ and $b < 8!$ and $c < 8!$ and $d < 8!$.
  have ha8 : a < 40320 := by
    have : a * b * c * d < 40320 * 40320 := by
      calc
        a * b * c * d < 8! * 8! := by
          rw [Nat.mul_lt_mul]
          · exact Nat.lt_trans ha (Nat.zero_lt_of_lt hab)
          · exact Nat.lt_trans hb (Nat.zero_lt_of_lt hbc)
          · exact Nat.lt_trans hc (Nat.zero_lt_of_lt hcd)
          · exact Nat.lt_trans hd (Nat.zero_lt_of_lt hda)
        _ < 40320 * 40320 := by rw [Nat.lt_mul_iff_one_lt_left]; exact Nat.zero_lt_of_lt h₄
    calc
      a = a * b * c * d / (b * c * d) := by rw [← Nat.mul_div_assoc]; exact Nat.div_eq_of_eq_mul_right (by rw [Nat.mul_comm d b, Nat.mul_assoc]; exact Nat.dvd_mul_left (b * c) d)
      _ < 40320 * 40320 / (b * c * d) := by gcongr
      _ < 40320 * 40320 / 1 := by gcongr
      _ = 40320 := by simp
  have hb8 : b < 40320 := by
    have : a * b * c * d < 40320 * 40320 := by
      calc
        a * b * c * d < 8! * 8! := by
          rw [Nat.mul_lt_mul]
          · exact Nat.lt_trans ha (Nat.zero_lt_of_lt hab)
          · exact Nat.lt_trans hb (Nat.zero_lt_of_lt hbc)
          · exact Nat.lt_trans hc (Nat.zero_lt_of_lt hcd)
          · exact Nat.lt_trans hd (Nat.zero_lt_of_lt hda)
        _ < 40320 * 40320 := by rw [Nat.lt_mul_iff_one_lt_left]; exact Nat.zero_lt_of_lt h₄
    calc
      b = a * b * c * d / (a * c * d) := by rw [← Nat.mul_div_assoc]; exact Nat.div_eq_of_eq_mul_right (by rw [Nat.mul_assoc]; exact Nat.dvd_mul_left (a * c) d)
      _ < 40320 * 40320 / (a * c * d) := by gcongr
      _ < 40320 * 40320 / 1 := by gcongr
      _ = 40320 := by simp
  have hc8 : c < 40320 := by
    have : a * b * c * d < 40320 * 40320 := by
      calc
        a * b * c * d < 8! * 8! := by
          rw [Nat.mul_lt_mul]
          · exact Nat.lt_trans ha (Nat.zero_lt_of_lt hab)
          · exact Nat.lt_trans hb (Nat.zero_lt_of_lt hbc)
          · exact Nat.lt_trans hc (Nat.zero_lt_of_lt hcd)
          · exact Nat.lt_trans hd (Nat.zero_lt_of_lt hda)
        _ < 40320 * 40320 := by rw [Nat.lt_mul_iff_one_lt_left]; exact Nat.zero_lt_of_lt h₄
    calc
      c = a * b * c * d / (a * b * d) := by rw [← Nat.mul_div_assoc]; exact Nat.div_eq_of_eq_mul_right (by exact Nat.dvd_mul_left (a * b) d)
      _ < 40320 * 40320 / (a * b * d) := by gcongr
      _ < 40320 * 40320 / 1 := by gcongr
      _ = 40320 := by simp
  have hd8 : d < 40320 := by
    have : a * b * c * d < 40320 * 40320 := by
      calc
        a * b * c * d < 8! * 8! := by
          rw [Nat.mul_lt_mul]
          · exact Nat.lt_trans ha (Nat.zero_lt_of_lt hab)
          · exact Nat.lt_trans hb (Nat.zero_lt_of_lt hbc)
          · exact Nat.lt_trans hc (Nat.zero_lt_of_lt hcd)
          · exact Nat.lt_trans hd (Nat.zero_lt_of_lt hda)
        _ < 40320 * 40320 := by rw [Nat.lt_mul_iff_one_lt_left]; exact Nat.zero_lt_of_lt h₄
    calc
      d = a * b * c * d / (a * b * c) := by rw [← Nat.mul_div_assoc]; exact Nat.div_eq_of_eq_mul_right (by exact Nat.dvd_mul_left (a * b) c)
      _ < 40320 * 40320 / (a * b * c) := by gcongr
      _ < 40320 * 40320 / 1 := by gcongr
      _ = 40320 := by simp

  -- Show that $8 \le a$ and $8 \le b$ and $8 \le c$.
  have ha8 : 8 ≤ a := by
    by_contra!
    have : a * b * c * d ≤ 7 * b * c * d := by
      calc
        a * b * c * d ≤ 7 * a * c * d := by gcongr
        _ ≤ 7 * 7 * c * d := by gcongr
        _ ≤ 7 * 7 * 7 * d := by gcongr
        _ ≤ 7 * 7 * 7 * 7 := by gcongr
    have : 8! ≤ 7 * b * c * d := by
      rw [Nat.mul_assoc] at this
      exact Nat.mul_le_mul (Nat.mul_le_mul (Nat.mul_le_mul ha8 (by exact Nat.succ_le_of_lt hb8)) (by exact Nat.succ_le_of_lt hc8)) (by exact Nat.succ_le_of_lt hd8)
    linarith
  have hb8 : 8 ≤ b := by
    by_contra!
    have : a * b * c * d ≤ a * 7 * c * d := by
      calc
        a * b * c * d ≤ a * 7 * c * d := by gcongr
    have : 8! ≤ a * 7 * c * d := by
      rw [Nat.mul_assoc] at this
      exact Nat.mul_le_mul (Nat.mul_le_mul (Nat.mul_le_mul ha8 (by exact Nat.succ_le_of_lt hb8)) (by exact Nat.succ_le_of_lt hc8)) (by exact Nat.succ_le_of_lt hd8)
    linarith
  have hc8 : 8 ≤ c := by
    by_contra!
    have : a * b * c * d ≤ a * b * 7 * d := by
      calc
        a * b * c * d ≤ a * b * 7 * d := by gcongr
    have : 8! ≤ a * b * 7 * d := by
      rw [Nat.mul_assoc] at this
      exact Nat.mul_le_mul (Nat.mul_le_mul (Nat.mul_le_mul ha8 (by exact Nat.succ_le_of_lt hb8)) (by exact Nat.succ_le_of_lt hc8)) (by exact Nat.succ_le_of_lt hd8)
    linarith

  -- Show that $a$ is a divisor of $8!$.
  have ha_dvd : a ∣ 40320 := by
    rw [← Nat.dvd_mul_right]
    exact Nat.dvd_mul (by exact Nat.dvd_mul_left (b * c) d) (by exact Nat.dvd_mul_left a (c * d))
  -- Show that $b$ is a divisor of $8!$.
  have hb_dvd : b ∣ 40320 := by
    rw [← Nat.dvd_mul_right]
    exact Nat.dvd_mul (by exact Nat.dvd_mul_left a c) (by exact Nat.dvd_mul_left (b * d) (c * a))
  -- Show that $c$ is a divisor of $8!$.
  have hc_dvd : c ∣ 40320 := by
    rw [← Nat.dvd_mul_right]
    exact Nat.dvd_mul (by exact Nat.dvd_mul_left (a * b) d) (by exact Nat.dvd_mul_left c (a * b))

  -- Show that $a \in \{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 14, 15, 16, 20, 21, 24, 28, 30, 32, 35, 36, 40, 42, 45, 48, 54, 56, 60, 63, 64, 70, 72, 75, 80, 84, 85, 90, 96, 100, 105, 112, 120, 126, 128, 135, 140, 144, 150, 160, 168, 170, 180, 192, 210, 224, 240, 252, 280, 300, 315, 320, 336, 350, 360, 384, 420, 448, 480, 525, 560, 600, 630, 640, 672, 700, 720, 735, 800, 840, 875, 960, 1050, 1120, 1260, 1400, 1680, 1750, 2100, 2240, 2520, 2800, 3360, 3500, 4200, 5600, 8400, 8401\}$.
  have ha_mem : a ∈ Finset.filter (fun x => x * b * c * d = 40320 ∧ 8 ≤ x ∧ x ≤ 524) (Finset.Icc 8 524) := by
    simp
    exact ⟨by rw [← h₄, Nat.mul_assoc]; exact Nat.eq_mul_of_mul_eq_left (by exact Nat.zero_lt_of_lt hab) h₄, ha, ha8⟩
  have ha_val : a = 1 ∨ a = 2 ∨ a = 3 ∨ a = 4 ∨ a = 5 ∨ a = 6 ∨ a = 7 ∨ a = 8 ∨ a = 9 ∨ a = 10 ∨ a = 12 ∨ a = 14 ∨ a = 15 ∨ a = 16 ∨ a = 20 ∨ a = 21 ∨ a = 24 ∨ a = 28 ∨ a = 30 ∨ a = 32 ∨ a = 35 ∨ a = 36 ∨ a = 40 ∨ a = 42 ∨ a = 45 ∨ a = 48 ∨ a = 54 ∨ a = 56 ∨ a = 60 ∨ a = 63 ∨ a = 64 ∨ a = 70 ∨ a = 72 ∨ a = 75 ∨ a = 80 ∨ a = 84 ∨ a = 85 ∨ a = 90 ∨ a = 96 ∨ a = 100 ∨ a = 105 ∨ a = 112 ∨ a = 120 ∨ a = 126 ∨ a = 128 ∨ a = 135 ∨ a = 140 ∨ a = 144 ∨ a = 150 ∨ a = 160 ∨ a = 168 ∨ a = 170 ∨ a = 180 ∨ a = 192 ∨ a = 210 ∨ a = 224 ∨ a = 240 ∨ a = 252 ∨ a = 280 ∨ a = 300 ∨ a = 315 ∨ a = 320 ∨ a = 336 ∨ a = 350 ∨ a = 360 ∨ a = 384 ∨ a = 420 ∨ a = 448 ∨ a = 480 ∨ a = 525 ∨ a = 560 ∨ a = 600 ∨ a = 630 ∨ a = 640 ∨ a = 672 ∨ a = 700 ∨ a = 720 ∨ a = 735 ∨ a = 800 ∨ a = 840 ∨ a = 875 ∨ a = 960 ∨ a = 1050 ∨ a = 1120 ∨ a = 1260 ∨ a = 1400 ∨ a = 1680 ∨ a = 1750 ∨ a = 2100 ∨ a = 2240 ∨ a = 2520 ∨ a = 2800 ∨ a = 3360 ∨ a = 3500 ∨ a = 4200 ∨ a = 5600 ∨ a = 8400 ∨ a = 8401, h₄, hab, ha8⟩

  -- Show that $b \in \{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 12, 14, 15, 16, 20, 21, 24, 28, 30, 32, 35, 36, 40, 42, 45, 48, 54, 56, 60, 63, 64, 70, 72, 75, 80, 84, 85, 90, 96, 100, 105, 112, 120, 126, 128, 135, 140, 144, 150, 160, 168, 170, 180, 192, 210, 224, 240, 252, 280, 300, 315, 320, 336, 350, 360, 384, 420,