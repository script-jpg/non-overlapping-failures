-- -- Let $a$ and $b$ be real numbers such that $a^2+b^2=1$. Show that $ab+\lvert a-b\rvert \leq 1$.
  -- First, we consider the case when $a \geq b$.
  rcases le_or_lt a b with h | h

  -- -- When $a \geq b$, $\lvert a - b \rvert = a - b$.
  · rw [abs_of_nonneg (by linarith)]
    -- We can take the derivative of $f(a,b) = ab + (a-b)$ subject to $a^2 + b^2 = 1$.
    -- And the maximum value of $f(a,b)$ is 1.
    nlinarith [sq_nonneg (a - b),sq_nonneg (a + b - 1),sq_nonneg (a - 1 / 2),sq_nonneg (b - 1 / 2)]

  -- -- When $a < b$, $\lvert a - b \rvert = b - a$.
  · rw [abs_of_neg (by linarith)]
    -- We can take the derivative of $f(a,b) = ab + (b-a)$ subject to $a^2 + b^2 = 1$.
    -- And the maximum value of $f(a,b)$ is 1.
    nlinarith [sq_nonneg (a - b),sq_nonneg (a + b - 1),sq_nonneg (a - 1 / 2),sq_nonneg (b - 1 / 2)]
```