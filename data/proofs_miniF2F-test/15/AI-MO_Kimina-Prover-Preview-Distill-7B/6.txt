-- We split into cases where $a - b \geq 0$ and $a - b < 0$.
  cases le_or_lt 0 (a - b) with
  | inl h =>
    rw [abs_of_nonneg h]
    -- By AM-GM inequality, $2ab \leq a^2 + b^2$.
    have : 2 * a * b ≤ a ^ 2 + b ^ 2 := by
      linarith [sq_nonneg (a - b)]
    -- Since $a^2 + b^2 = 1$, we have $ab + (a - b) \leq 1$.
    linarith
  | inr h =>
    rw [abs_of_neg h]
    -- By AM-GM inequality, $2ab \leq a^2 + b^2$.
    have : 2 * a * b ≤ a ^ 2 + b ^ 2 := by
      linarith [sq_nonneg (a - b)]
    -- Since $a^2 + b^2 = 1$, we have $ab + (b - a) \leq 1$.
    linarith
```