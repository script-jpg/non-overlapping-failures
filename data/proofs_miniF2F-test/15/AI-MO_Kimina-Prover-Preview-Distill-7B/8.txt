-- We have $\lvert a \rvert \leq \sqrt{a^2+b^2}=1$ and $\lvert b \rvert \leq \sqrt{a^2+b^2}=1$.
  have h₁ : abs a ≤ 1 := by
    calc
      abs a ≤ sqrt (a ^ 2 + b ^ 2) := by
        apply Real.abs_le_sqrt_add
        have : 0 ≤ b ^ 2 := by apply sq_nonneg
        linarith
      _ = sqrt 1 := by rw [h₀]; norm_num
      _ = 1 := by rw [Real.sqrt_one]
  have h₂ : abs b ≤ 1 := by
    calc
      abs b ≤ sqrt (a ^ 2 + b ^ 2) := by
        apply Real.abs_le_sqrt_add
        have : 0 ≤ a ^ 2 := by apply sq_nonneg
        linarith
      _ = sqrt 1 := by rw [h₀]; norm_num
      _ = 1 := by rw [Real.sqrt_one]

  -- We have $(a+b)^2 \leq 2(a^2+b^2)$.
  have h₃ : (a + b) ^ 2 ≤ 2 := by
    calc
      (a + b) ^ 2 = (a ^ 2 + 2 * a * b + b ^ 2) := by ring
      _ ≤ (a ^ 2 + b ^ 2) + 2 * (a ^ 2 + b ^ 2) := by
        have : 0 ≤ (a - b) ^ 2 := by apply sq_nonneg
        linarith
      _ = 3 := by rw [h₀]; norm_num

  -- We have $(a-b)^2 \leq 2(a^2+b^2)$.
  have h₄ : (a - b) ^ 2 ≤ 2 := by
    calc
      (a - b) ^ 2 = (a ^ 2 - 2 * a * b + b ^ 2) := by ring
      _ ≤ (a ^ 2 + b ^ 2) + 2 * (a ^ 2 + b ^ 2) := by
        have : 0 ≤ (a + b) ^ 2 := by apply sq_nonneg
        linarith
      _ = 3 := by rw [h₀]; norm_num

  -- We have $|ab| \leq 1$.
  have h₅ : abs (a * b) ≤ 1 := by
    calc
      abs (a * b) ≤ (abs a) * (abs b) := by
        apply abs_mul
      _ ≤ 1 := by
        apply mul_le_of_le_of_le
        all_goals
        apply h₁
        apply h₂

  by_cases h : a - b ≥ 0
  -- If $a \geq b$, then $ab + |a-b| = ab + a - b \leq 1$.
  · calc
      a * b + abs (a - b) = a * b + (a - b) := by
        rw [abs_of_nonneg]
        exact h
      _ = (a - b) * (1 - a * b) := by ring
      _ ≤ 1 := by
        apply mul_nonneg
        · linarith
        · apply h₅
  -- If $a < b$, then $ab + |a-b| = ab + b - a \leq 1$.
  · calc
      a * b + abs (a - b) = a * b + -(a - b) := by
        rw [abs_of_neg]
        linarith
      _ = (a - b) * (a * b - 1) := by ring
      _ ≤ 1 := by
        apply mul_nonpos_of_nonpos_of_nonneg
        · linarith
        · apply h₅

```