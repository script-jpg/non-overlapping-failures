-- We have $\lvert a \rvert \leq 1$ and $\lvert b \rvert \leq 1$.

  have h₁ : abs a ≤ 1 := by

    -- We have $\lvert a \rvert ^ 2 \leq a^2 + b^2 = 1$.

    have : (abs a) ^ 2 ≤ a ^ 2 + b ^ 2 := by

      -- Use the fact that $x^2 + y^2 \geq 2xy$.

      have : a ^ 2 + b ^ 2 - (abs a) ^ 2 ≥ 0 := by
        calc

          a ^ 2 + b ^ 2 - (abs a) ^ 2 = a ^ 2 + b ^ 2 - (a ^ 2 + b ^ 2 - 2 * (a * b)) := by
            apply eq_sub_of_add_eq
            rw [←sq_abs (a - b)]
            ring
          _ = 2 * (a * b) := by ring
          _ ≥ 0 := by
            apply mul_nonneg
            norm_num
            apply abs_nonneg

    -- So $\lvert a \rvert \leq 1$.

    have := le_trans (this.trans (by rw [h₀]; simp)) (by simp)
    rw [sq_abs a] at this
    apply abs_le_of_sq_le this

  have h₂ : abs b ≤ 1 := by

    -- We have $\lvert b \rvert ^ 2 \leq a^2 + b^2 = 1$.

    have : (abs b) ^ 2 ≤ a ^ 2 + b ^ 2 := by

      -- Use the fact that $x^2 + y^2 \geq 2xy$.

      have : a ^ 2 + b ^ 2 - (abs b) ^ 2 ≥ 0 := by
        calc

          a ^ 2 + b ^ 2 - (abs b) ^ 2 = a ^ 2 + b ^ 2 - (b ^ 2 + a ^ 2 - 2 * (a * b)) := by
            apply eq_sub_of_add_eq
            rw [←sq_abs (a - b)]
            ring
          _ = 2 * (a * b) := by ring
          _ ≥ 0 := by
            apply mul_nonneg
            norm_num
            apply abs_nonneg

    -- So $\lvert b \rvert \leq 1$.

    have := le_trans (this.trans (by rw [h₀]; simp)) (by simp)
    rw [sq_abs b] at this
    apply abs_le_of_sq_le this

  -- We have $(a - b)^2 \geq 0$.

  have h₃ : 0 ≤ (a - b) ^ 2 := by apply sq_nonneg

  -- We have $2ab \leq a^2 + b^2$.

  have h₄ : 2 * a * b ≤ a ^ 2 + b ^ 2 := by

    -- Use the fact that $(a-b)^2 \geq 0$.

    have : (a - b) ^ 2 ≥ 0 := by
      apply sq_nonneg

    -- So $a^2 + b^2 - 2ab \geq 0$.

    have : a ^ 2 + b ^ 2 - 2 * a * b ≥ 0 := by
      calc

        a ^ 2 + b ^ 2 - 2 * a * b = (a - b) ^ 2 := by ring
                                _ ≥ 0 := by linarith

    -- So $2ab \leq a^2 + b^2$.

    linarith

  -- Consider whether $a \geq b$ or $a \leq b$.

  by_cases h₅ : a ≥ b

  -- If $a \geq b$, then $\lvert a - b \rvert = a - b$.

  · rw [abs_of_nonneg (by linarith)]

    -- We have $ab + a - b \leq 1$.

    calc

      a * b + a - b ≤ a ^ 2 + b ^ 2 + a - b := by linarith
                  _ = 1 + a - b := by rw [h₀]
                  _ ≤ 1 := by linarith

  -- If $a \leq b$, then $\lvert a - b \rvert = b - a$.

  · rw [abs_of_nonpos (by linarith)]

    -- We have $ab + b - a \leq 1$.

    calc

      a * b + b - a ≤ a ^ 2 + b ^ 2 + b - a := by linarith
                  _ = 1 + b - a := by rw [h₀]
                  _ ≤ 1 := by linarith
```