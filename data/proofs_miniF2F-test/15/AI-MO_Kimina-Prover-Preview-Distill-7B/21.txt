-- We split into cases where $a \geq b$ or $a < b$.
  obtain h | h := le_or_lt a b <;> simp_all [abs_of_nonneg (by linarith : a - b ≥ 0)]

  -- Case 1: $a \geq b$.
  · -- It suffices to show that $ab + (a-b) \leq 1$.
    rw [show a * b + (a - b) = (a + b) * a - b ^ 2 - b by ring] at *
    rw [show (1 : ℝ) = 1 ^ 2 by norm_num] at h₀
    -- We have $a^2 + b^2 = 1 \leq (a+b)^2 = a^2 + 2ab + b^2 \Rightarrow 2ab \geq -1$.
    have h₁ : -1 ≤ 2 * a * b := by linarith [sq_nonneg (a + b)]

    -- We have $a^2 + b^2 = 1 \leq (a-b)^2 = a^2 - 2ab + b^2 \Rightarrow -2ab \leq 1$ or $ab \geq -\frac{1}{2}$.
    have h₂ : a * b ≥ -1 / 2 := by linarith [sq_nonneg (a - b)]

    -- We have $ab \leq \frac{1}{2}(a^2 + b^2) = \frac{1}{2}$.
    have h₃ : a * b ≤ 1 / 2 := by
      suffices h₃ : 2 * a * b ≤ 1 by linarith
      linarith [sq_nonneg (a - b)]

    -- Now we can show that $(a+b)a - b^2 - b = ab + (a-b) \leq 1$.
    linarith

  -- Case 2: $a < b$.
  · -- It suffices to show that $ab + (b-a) \leq 1$.
    rw [show a * b + (b - a) = (a + b) * b - a ^ 2 - a by ring] at *
    rw [show (1 : ℝ) = 1 ^ 2 by norm_num] at h₀
    -- We have $a^2 + b^2 = 1 \leq (a+b)^2 = a^2 + 2ab + b^2 \Rightarrow 2ab \geq -1$.
    have h₁ : -1 ≤ 2 * a * b := by linarith [sq_nonneg (a + b)]

    -- We have $a^2 + b^2 = 1 \leq (a-b)^2 = a^2 - 2ab + b^2 \Rightarrow -2ab \leq 1$ or $ab \geq -\frac{1}{2}$.
    have h₂ : a * b ≥ -1 / 2 := by linarith [sq_nonneg (a - b)]

    -- We have $ab \leq \frac{1}{2}(a^2 + b^2) = \frac{1}{2}$.
    have h₃ : a * b ≤ 1 / 2 := by
      suffices h₃ : 2 * a * b ≤ 1 by linarith
      linarith [sq_nonneg (a - b)]

    -- Now we can show that $(a+b)b - a^2 - a = ab + (b-a) \leq 1$.
    linarith
```