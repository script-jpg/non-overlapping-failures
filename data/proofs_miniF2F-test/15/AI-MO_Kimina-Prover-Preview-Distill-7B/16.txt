-- We divide into cases whether $a \geq b$ or $a < b$.
  cases' le_or_lt a b with h₁ h₁

  -- If $a \geq b$, then $\lvert a - b \rvert = a - b$.
  · rw [abs_of_nonneg (by linarith)]
    -- Our goal becomes $ab + a - b \leq 1$.
    suffices a * b + (a - b) ≤ 1 by linarith

    -- We have $a^2 + b^2 = 1$ and $a \geq b$.
    -- Multiply both sides of $a \geq b$ by $a$ to get $a^2 \geq ab$.
    have h₂ : a * b ≤ a ^ 2 := by
      have : a ≥ 0 := by nlinarith
      nlinarith

    -- Multiply both sides of $a \geq b$ by $b$ to get $ab \geq b^2$.
    have h₃ : a * b ≥ b ^ 2 := by
      have : b ≥ 0 := by nlinarith
      nlinarith

    -- It suffices to show that $2ab + a - b \leq a^2 + b^2 + 1$.
    suffices 2 * (a * b) + (a - b) ≤ a ^ 2 + b ^ 2 + 1 by linarith
    -- The last inequality can be rewritten as $(a - 1)^2 + (b - 1)^2 \leq 2$.
    suffices (a - 1) ^ 2 + (b - 1) ^ 2 ≤ 2 by linarith

    -- We have $a^2 + b^2 = 1$.
    -- It suffices to show that $(a - 1)^2 + (b - 1)^2 - 2 \leq 0$.
    suffices (a - 1) ^ 2 + (b - 1) ^ 2 - 2 ≤ 0 by linarith

    -- This can be rewritten as $a^2 - 2a + b^2 - 2b \leq 0$.
    suffices a ^ 2 - 2 * a + b ^ 2 - 2 * b ≤ 0 by linarith

    -- This follows from $a^2 + b^2 = 1$ and $a \geq b$.
    nlinarith

  -- If $a < b$, then $\lvert a - b \rvert = b - a$.
  · rw [abs_of_neg (by linarith)]
    -- Our goal becomes $ab + b - a \leq 1$.
    suffices a * b + (b - a) ≤ 1 by linarith

    -- We have $a^2 + b^2 = 1$ and $a < b$.
    -- Multiply both sides of $a < b$ by $a$ to get $a^2 < ab$.
    have h₂ : a ^ 2 < a * b := by
      have : a < 0 := by nlinarith
      nlinarith

    -- Multiply both sides of $a < b$ by $b$ to get $ab < b^2$.
    have h₃ : a * b < b ^ 2 := by
      have : b > 0 := by nlinarith
      nlinarith

    -- It suffices to show that $2ab + b - a \leq a^2 + b^2 + 1$.
    suffices 2 * (a * b) + (b - a) ≤ a ^ 2 + b ^ 2 + 1 by linarith
    -- The last inequality can be rewritten as $(a + 1)^2 + (b - 1)^2 \leq 2$.
    suffices (a + 1) ^ 2 + (b - 1) ^ 2 ≤ 2 by linarith

    -- We have $a^2 + b^2 = 1$.
    -- It suffices to show that $(a + 1)^2 + (b - 1)^2 - 2 \leq 0$.
    suffices (a + 1) ^ 2 + (b - 1) ^ 2 - 2 ≤ 0 by linarith

    -- This can be rewritten as $a^2 + 2a + b^2 - 2b \leq 0$.
    suffices a ^ 2 + 2 * a + b ^ 2 - 2 * b ≤ 0 by linarith

    -- This follows from $a^2 + b^2 = 1$ and $a < b$.
    nlinarith

```