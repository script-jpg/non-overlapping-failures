-- We divided the problem into 2 cases $a\geq b$ and $a < b$
  cases' le_or_lt b a with h₁ h₁
  · -- In the case $a \geq b$, we have $|a-b| = a-b$.
    rw [abs_of_nonneg (sub_nonneg_of_le h₁)]
    have h : a * b + (a - b) ≤ 1 := by
      -- We can get $2ab + (a-b)^2 \leq 1$ from $a^2 + b^2 = 1$.
      nlinarith [sq_nonneg (a - b), sq_nonneg (a + b), h₀]
      -- So $(a+b)^2 + (a-b)^2 \leq 2$, $2ab + (a-b)^2 \leq 1$,
      -- $ (a+b)^2 \leq 1$, $a+b \leq 1$.
      -- Then $a \leq 1 - b \leq 1 - |a-b|$.
      have hab : a * b + (a - b) ≤ 1 := by nlinarith
      exact h
    linarith
  · -- In the case $a < b$, we have $|a-b| = b-a$.
    rw [abs_of_neg (sub_neg_of_lt h₁)]
    have h : a * b + (b - a) ≤ 1 := by
      -- We can get $2ab + (b-a)^2 \leq 1$ from $a^2 + b^2 = 1$.
      nlinarith [sq_nonneg (a - b), sq_nonneg (a + b), h₀]
      -- So $(a+b)^2 + (b-a)^2 \leq 2$, $2ab + (b-a)^2 \leq 1$,
      -- $ (b+a)^2 \leq 1$, $b+a \leq 1$.
      -- Then $b \leq 1 - a \leq 1 - |a-b|$.
      have hba : a * b + (b - a) ≤ 1 := by nlinarith
      exact hba
    linarith
```