-- prove the Cauchy-Schwarz inequality
  have CS_ineq (a b c : ℝ) (h : 0 < a) : (a + b + c) ^ 2 ≤ (1 ^ 2 + 1 ^ 2 + 1 ^ 2) * (a ^ 2 + b ^ 2 + c ^ 2) := by
    have h1 : 0 < (1:ℝ) ^ 2 + 1 ^ 2 + 1 ^ 2 := by norm_num
    have h2 : 0 < a ^ 2 + b ^ 2 + c ^ 2 := by
      have : 0 ≤ a ^ 2 + b ^ 2 + c ^ 2 := by
        apply add_nonneg
        apply add_nonneg
        · apply sq_nonneg
        · apply sq_nonneg
        · apply sq_nonneg
      linarith
    have h3 : 0 < (a + b + c) ^ 2 := by
      apply sq_pos_of_ne_zero
      by_contra!
      linarith
    -- apply the Cauchy-Schwarz inequality
    have h4 : |(1:ℝ) * a + 1 * b + 1 * c| ≤ √((1 ^ 2 + 1 ^ 2 + 1 ^ 2) * (a ^ 2 + b ^ 2 + c ^ 2)) := by
      apply abs_le_sqrt_mul_sqrt
      · apply add_nonneg
        apply add_nonneg
        · apply sq_nonneg
        · apply sq_nonneg
        · apply sq_nonneg
      · apply add_nonneg
        apply add_nonneg
        · apply sq_nonneg
        · apply sq_nonneg
        · apply sq_nonneg
    -- square both sides
    apply sq_le_sq'
    · apply abs_le_abs
      · linarith
      · linarith
    · norm_num
      ring_nf
      simp only [Real.sqrt_sq]
      rw [abs_of_pos]
      linarith
      linarith
      linarith

  -- prove the inequality of the problem
  calc
    _ = (3 / (x + y + z)) * 3 := by field_simp; ring_nf
    _ ≤ (3 / (x + y + z)) * (1 / 3 / 3 * (1 / 3 * (x + y) + 1 / 3 * (y + z) + 1 / 3 * (z + x)))⁻¹ := by
      -- apply the Cauchy-Schwarz inequality
      apply (div_le_div_iff_of_pos_left (by norm_num) (by norm_num)).mpr
      apply CS_ineq
      · apply add_pos
        apply add_pos
        · apply div_pos
          · apply mul_pos
            · norm_num
            · apply add_pos
              · apply mul_pos
                · norm_num
                · linarith
              · apply mul_pos
                · norm_num
                · linarith
          · apply div_pos
            · apply mul_pos
              · norm_num
              · linarith
            · linarith
        · apply div_pos
          · apply mul_pos
            · norm_num
            · apply add_pos
              · apply mul_pos
                · norm_num
                · linarith
              · apply mul_pos
                · norm_num
                · linarith
          · apply div_pos
            · apply mul_pos
              · norm_num
              · linarith
            · linarith
      · norm_num
    _ = (1 / (x + y) + 1 / (y + z) + 1 / (z + x)) * (9 / (x + y + z)) := by field_simp; ring_nf
    _ ≤ (1 / (x + y) + 1 / (y + z) + 1 / (z + x)) * ((2 / (x + y) + 2 / (y + z) + 2 / (z + x)) / 3)⁻¹ := by
      -- apply the inequality x + y + z ≤ 3/2 * (1/(x+y) + 1/(y+z) + 1/(z+x)) (x, y, z > 0)
      -- the inequality can be rewritten as (x + y + z) * (1/(x+y) + 1/(y+z) + 1/(z+x)) ≥ 9/2
      -- then we can get the upper bound of 9/(x+y+z)
      have h1 : (x + y + z) * (1 / (x + y) + 1 / (y + z) + 1 / (z + x)) ≥ 9 / 2 := by
        -- prove the inequality by Cauchy-Schwarz inequality
        have h1 : 9 / 2 = (3 / 2) ^ 2 := by norm_num
        have h2 : (x + y + z) * (1 / (x + y) + 1 / (y + z) + 1 / (z + x)) ≥ (3 / 2) ^ 2 := by
          have h3 : 0 < 3 / 2 := by norm_num
          have h4 : 0 < (x + y + z) := by
            apply add_pos
            apply add_pos
            · apply linarith
            · apply linarith
            · apply linarith
          have h5 : 0 < 1 / (x + y) + 1 / (y + z) + 1 / (z + x) := by
            have : 0 ≤ 1 / (x + y) + 1 / (y + z) + 1 / (z + x) := by
              apply add_nonneg
              apply add_nonneg
              · apply div_nonneg
                · norm_num
                · linarith
              · apply div_nonneg
                · linarith
                · linarith
              · apply div_nonneg
                · linarith
                · linarith
            linarith
          -- apply the Cauchy-Schwarz inequality
          have h6 : |(√(3 / 2) * √(1 / (x + y)) + √(3 / 2) * √(1 / (y + z)) + √(3 / 2) * √(1 / (z + x)))| ≤ √((3 / 2) * (1 / (x + y) + 1 / (y + z) + 1 / (z + x))) := by
            apply abs_le_sqrt_mul_sqrt
            · apply add_nonneg
              apply add_nonneg
              · apply div_nonneg
                · norm_num
                · linarith
              · apply div_nonneg
                · linarith
                · linarith
              · apply div_nonneg
                · linarith
                · linarith
            · apply add_nonneg
              apply add_nonneg
              · apply div_nonneg
                · norm_num
                · linarith
              · apply div_nonneg
                · linarith
                · linarith
              · apply div_nonneg
                · linarith
                · linarith
          -- square both sides
          apply sq_le_sq'
          · apply abs_le_abs
            · apply le_of_lt
              apply lt_trans h3
              apply sq_lt_sq'
              · apply add_pos
                apply div_pos
                · apply mul_pos
                  · norm_num
                  · linarith
                · apply div_pos
                  · apply mul_pos
                    · norm_num
                    · linarith
                  · apply div_pos
                    · apply mul_pos
                      · norm_num
                      · linarith
                · linarith
            · linarith
          · norm_num
            rw [abs_of_pos]
            apply mul_pos
            · apply div_pos
              · apply mul_pos
                · norm_num
                · linarith
              · apply div_pos
                · apply mul_pos
                  · norm_num
                  · linarith
                · apply div_pos
                  · apply mul_pos
                      · norm_num
                      · linarith
                  · linarith
            · linarith
          · norm_num
        linarith
      -- get the upper bound of 9/(x+y+z)
      apply (div_le_div_iff_of_pos_right (by apply add_pos; apply add_pos; apply add_pos; linarith) (by linarith)).mpr
      linarith
    _ = 2 / (x + y) + 2 / (y + z) + 2 / (z + x) := by field_simp; ring_nf
```