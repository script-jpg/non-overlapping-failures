-- prove the Cauchy-Schwarz inequality

  have CS_ineq (a b c : ℝ) (ha : a > 0) (hb : b > 0) (hc : c > 0) :
      (a + b + c) ^ 2 ≤ 3 * (a ^ 2 + b ^ 2 + c ^ 2) := by

    have h1 : (a + b + c) ^ 2 = a ^ 2 + b ^ 2 + c ^ 2 + 2 * (a * b + b * c + c * a) := by ring

    have h2 : a * b + b * c + c * a ≤ a ^ 2 + b ^ 2 + c ^ 2 := by

      have h2_1 : a * b ≤ 1 / 2 * (a ^ 2 + b ^ 2) := by
        have : 0 ≤ (a - b) ^ 2 := sq_nonneg (a - b)
        linarith

      have h2_2 : b * c ≤ 1 / 2 * (b ^ 2 + c ^ 2) := by
        have : 0 ≤ (b - c) ^ 2 := sq_nonneg (b - c)
        linarith

      have h2_3 : c * a ≤ 1 / 2 * (c ^ 2 + a ^ 2) := by
        have : 0 ≤ (c - a) ^ 2 := sq_nonneg (c - a)
        linarith

      linarith

    linarith

  -- apply the Cauchy-Schwarz inequality and simplify the terms

  have h1 := CS_ineq (x + y) (y + z) (z + x) (by linarith) (by linarith) (by linarith)

  field_simp at h1 ⊢

  rw [show 3 * (2 * x + 2 * y + 2 * z) ^ 2 = 9 * (x + y + z) ^ 2 by ring] at h1

  field_simp at h1 ⊢

  -- prove the final result

  calc

    9 / (x + y + z) = (9 / (x + y + z)) * ((x + y) + (y + z) + (z + x)) / 3 := by field_simp; ring

    _ ≤ ((x + y) * (y + z) + (y + z) * (z + x) + (z + x) * (x + y)) / 3 := by
      apply (div_le_div_iff_of_pos_right (by linarith)).mpr
      linarith only [h1]

    _ = 2 / (x + y) + 2 / (y + z) + 2 / (z + x) := by field_simp; ring
```