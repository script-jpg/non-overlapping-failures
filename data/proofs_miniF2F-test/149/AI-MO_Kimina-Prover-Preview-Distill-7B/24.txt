-- prepare some simple facts for later use
  have one_le_n : 1 ≤ (n : ℝ) := by simp
  have nne0 : (n : ℝ) ≠ 0 := by simp
  have nge1 : 1 ≤ n := by simp
  have idmul : id (↑n) * id (↑n) = id (↑n) * id (↑n) := rfl

  -- let us recall the well-known inequality $e^x \geq 1 + x$ for any real $x$
  have h1 : ∀ x : ℝ, exp x ≥ 1 + x := by
    intro x
    have h1 : deriv (fun x ↦ exp x) 0 = exp 0 = 1 := by simp
    have h2 : deriv (fun x ↦ exp x) x = exp x := by simp
    have h3 : (fun x ↦ exp x) 0 = exp 0 = 1 := by simp
    have := Taylor.exp_eq_iff_le derivatives_idMul_id (by simp) h1 h2 h3
    specialize this (x - 1)
    simp at this
    exact this

  -- A direct corollary of $e^x \geq 1 + x$ is that $e^x - 1 \geq x$
  have h2 : ∀ x : ℝ, exp x - 1 ≥ x := by
    intro x
    have := h1 x
    linarith

  -- another direct corollary of $e^x \geq 1 + x$ is $e^x - 1 > 0$ for any $x > 0$
  have h3 : ∀ x : ℝ, x > 0 → exp x - 1 > 0 := by
    intro x hx
    have h3 : exp x > exp (0 : ℝ) := by
      have h3 : (exp x).deriv = exp x := by simp
      have h4 : exp x - exp 0 > 0 := by
        have h4 : (exp x - exp 0).deriv = exp x := by simp [h3]
        have h5 : x > 0 := by assumption
        have h6 : (exp x - exp 0) 0 = exp 0 - exp 0 := by simp
        nth_rw 1 [h6]
        rw [exp_zero]
        simp
        exact h5
      specialize h2 (x - 0)
      simp at h2
      exact h2
    have h4 : exp x > 1 := by
      have h4 : exp (0 : ℝ) = 1 := by simp
      rw [← h4] at h3
      exact h3
    linarith

  -- Let $f(x) = -x / (1 + x)$ for $x > 0$. Then it is not hard to see that $f$ is strictly increasing
  let f (x : ℝ) := -x / (1 + x)
  have h4 : StrictMonoOn f (Ioi 0) := by
    intro x hx y hy hxy
    simp [f]
    have h4 : 1 + x > 0 := by
      have h4 : x > 0 := by assumption
      linarith
    have h5 : 1 + y > 0 := by
      have h5 : y > 0 := by assumption
      linarith
    have h6 : (1 + x)⁻¹ > 0 := by
      apply inv_pos_of_pos
      linarith
    have h7 : (1 + y)⁻¹ > 0 := by
      apply inv_pos_of_pos
      linarith
    have h8 : (1 + x)⁻¹ > (1 + y)⁻¹ := by
      apply inv_lt_inv
      all_goals linarith
    linarith

  -- Let $g(x) = e^{-x} - 1 + x$ for $x > 0$. Then it is not hard to see that $g$ is strictly increasing
  let g (x : ℝ) := exp (-x) - 1 + x
  have h5 : StrictMonoOn g (Ioi 0) := by
    intro x hx y hy hxy
    simp [g]
    have h5 : -x ≥ -y := by
      linarith
    have h6 : exp (-x) > exp (-y) := by
      apply Real.exp_strictMono
      linarith
    linarith

  -- We claim that $n^{1/n} \leq 2 - 1/n$ for any $n \geq 1$
  suffices h : ((n : ℝ) ^ ((1 : ℝ) / n)) < 2 - 1 / n by
    simp at h
    exact h

  -- if $n = 1$, then $n^{1/n} = 1$ and $2 - 1/n = 1$, so the inequality does not hold
  by_cases hn : n = 1
  · simp [hn]
  -- if $n \geq 2$, then $1/n \leq 1 / 2$
  replace nge1 : 2 ≤ n := by
    omega
  replace one_le_n : 1 / n ≤ 1 / 2 := by
    refine one_div_le_one_div_of_le?_?_ <;> linarith
  -- let $x = 1 / n$, then $x \leq 1 / 2$
  let x := 1 / n
  have hx : x = 1 / n := rfl
  have xle : x ≤ 1 / 2 := by
    simp [x]
    exact one_le_n
  -- $f(x) = -x / (1 + x)$ is strictly increasing on $[0, \infty)$
  have hfx : f_strictMonoOn := by
    exact StrictMonoOn.mono h4 (Set.Icc 0 (1 / 2))
    simp [f]
    have hfx : ∀ x ∈ Set.Icc 0 (1 / 2), 0 < 1 + x := by
      intro x hx
      have hx : x ≤ 1 / 2 := by
        have hx : x ∈ Set.Icc (0 : ℝ) (1 / 2) := by
          exact hx
        exact hx.2
      linarith
    exact MonotoneOn.inv_strictMonoOn (convex_Icc 0 (1 / 2)) (ContinuousOn.div (continuousOn_id' (a := 1)) (ContinuousOn.add (continuousOn_const 1) (continuousOn_id' (a := 1))) hfx)

  -- $g(x) = e^{-x} - 1 + x$ is strictly increasing on $[0, \infty)$
  have hgx : g_strictMonoOn := by
    exact StrictMonoOn.mono h5 (Set.Icc 0 (1 / 2))
    simp [g]
    have gx : ∀ x ∈ Set.Icc 0 (1 / 2), 0 < -x := by
      intro x hx
      have hx : 0 ≤ x := by
        have hx : x ∈ Set.Icc (0 : ℝ) (1 / 2) := by
          exact hx
        exact hx.1
      linarith
    have hgx : ContinuousOn (fun x : ℝ ↦ exp (-x)) (Set.Icc 0 (1 / 2)) := by
      apply ContinuousOn.exp
      apply ContinuousOn.neg
      apply ContinuousOn_const
    exact StrictMonoOn.add (ContinuousOn.exp_neg) (ContinuousOn.add (continuousOn_const 1) (continuousOn_id' (a := 1))) gx hgx

  -- $f(1/2) < 1/2$
  have hfle : f (1 / 2) < 1 / 2 := by
    simp [f]
    norm_num
  -- $g(1/2) < 1/2$
  have hglt : g (1 / 2) < 1 / 2 := by
    simp [g]
    norm_num
  -- $f(1/2) = g(1/2)$
  have hfg : f (1 / 2) = g (1 / 2) := by
    simp [f, g]
    norm_num
  -- $f(x) < 1/2$
  have hfxlt : f x < 1 / 2 := by
    rw [hfg] at hfle
    have h6 : x ≤ 1 / 2 := by
      exact this
    have h7 : f x ≤ f (1 / 2) := by
      apply hfx.monotoneOn
      simp
      exact h6
    linarith
  -- $g(x) < 1/2$
  have hgxlt : g x < 1 / 2 := by
    have h6 : x ≤ 1 / 2 := by
      exact this
    have h7 : g x ≤ g (1 / 2) := by
      apply hgx.monotoneOn
      simp
      exact h6
    linarith
  -- $f(x) = -x / (1 + x) < x$
  have hfxeq : f x = -x / (1 + x) := by
    simp [f]
  -- $f(x) < x$
  have hfxltx : f x < x := by
    rw [hfxeq]
    have one_lt_n : 1 < n := by
      omega
    have xne0 : 1 + x ≠ 0 := by
      have xne0 : 1 + x > 0 := by
        have xne0 : x > 0 := by assumption
        linarith
      linarith
    have h1 : -x * (1 + x) < (1 + x) * x := by
      have h1 : (1 + x) * x > 0 := by
        apply mul_pos
        all_goals linarith
      have h2 : 1 + x > 0 := by
        have h2 : x > 0 := by assumption
        linarith
      have h3 : -x * (1 + x) / (1 + x) = -x := by
        field_simp [h2]
      have h4 : (1 + x) * x / (1 + x) = x := by
        field_simp [h2]
      rw [h3, h4]
      linarith
    have h2 : (1 + x) / (1 + x) = 1 := by
      field_simp [xne0]
    have h3 : -x / (1 + x) < ((1 + x) * x) / (1 + x) := by
      apply div_lt_div_of_pos_right h1 (by linarith)
    have h4 : ((1 + x) * x) / (1 + x) = x := by
      field_simp [xne0]
    rw [h4] at h3
    exact h3
  -- $g(x) < x$
  have hgxltx : g x < x := by
    have hxlt : x < 1 / 2 + x := by
      linarith
    have h1 : exp (-x) < 1 := by
      have h1 : -x < 0 := by
        linarith
      have h2 : exp (-x) < exp 0 := by
        apply Real.exp_strictMono
        linarith
      have h3 : exp 0 = 1 := by simp
      rw [h3] at h2
      exact h2
    have h2 : -1 + x < exp (-x) - 1 + x := by
      linarith
    linarith
  -- since $f(x) < x$ and $g(x) < x$, we claim that $f(x) + 1 / 2 < 2 - x$
  have hfxaddgx : f x + 1 / 2 < 2 - x := by
    linarith
  -- since $f(x) < 1 / 2$ and $g(x) < 1 / 2$, we claim that $f(x) + g(x) < 1$
  have hfxaddgxlt : f x + g x < 1 := by
    linarith
  -- however, we will show that $f(x) + g(x) = 1$, which is a contradiction
  have hfgx : f x + g x = 1 := by
    simp [f, g]
    calc
      _ = -x / (1 + x) + (exp (-x) - 1 + x) := by ring
      _ = 1 := by
        have idmul : id (↑n) * id (↑n) = id (↑n) * id (↑n) := rfl
        simp [exp_neg, exp_zero]
        field_simp
        rw [← mul_add, mul_assoc, idmul, sub_add_cancel, ← exp_neg]
        ring
  -- the above claims forms a contradiction
  linarith
```