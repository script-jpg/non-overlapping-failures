-- We have $\sqrt{16+16a} = 4\sqrt{1+a}$.
  have : Real.sqrt (16 + 16 * a) = 4 * Real.sqrt (1 + a) := by
    rw [show (16 + 16 * a) = (4 ** 2) * (1 + a) by ring]
    rw [Real.sqrt_mul]
    rw [Real.sqrt_sq]
    linarith
    linarith

  -- Substitute the above into the main equation to get $\sqrt{4+\sqrt{16+16a}+ \sqrt{1+\sqrt{1+a}} = 6.$'
  rw [this] at h₀

  -- We have $\sqrt{4+4\sqrt{1+a}+ \sqrt{1+\sqrt{1+a}} = 6.$
  have : Real.sqrt (4 + 4 * Real.sqrt (1 + a) + Real.sqrt (1 + Real.sqrt (1 + a))) = 6 := by
    rw [show (4 + 4 * Real.sqrt (1 + a) + Real.sqrt (1 + Real.sqrt (1 + a))) = (4 + Real.sqrt (16 + 16 * a)) + Real.sqrt (1 + Real.sqrt (1 + a)) by rw [this]; ring]
    exact h₀

  -- Square both sides to get $4+4\sqrt{1+a}+ \sqrt{1+\sqrt{1+a}} = 36$.
  have : 4 + 4 * Real.sqrt (1 + a) + Real.sqrt (1 + Real.sqrt (1 + a)) = 36 := by
    have := (Real.sqrt_eq_iff_eq_sq (by linarith) (by linarith)).mp this
    linarith

  -- We have $\sqrt{1+\sqrt{1+a}} = 36-4-4\sqrt{1+a} = 32-4\sqrt{1+a}$.
  have : Real.sqrt (1 + Real.sqrt (1 + a)) = 32 - 4 * Real.sqrt (1 + a) := by linarith

  -- Square both sides to get $1+\sqrt{1+a} = (32-4\sqrt{1+a})^2 = 1024-256\sqrt{1+a}+16(1+a)$.
  have : 1 + Real.sqrt (1 + a) = 1024 - 256 * Real.sqrt (1 + a) + 16 * (1 + a) := by
    have := (Real.sqrt_eq_iff_eq_sq (by linarith) (by linarith)).mp this
    linarith

  -- We have $\sqrt{1+a} = 1024-16-1-256\sqrt{1+a}+16a = 1007-256\sqrt{1+a}+16a$.
  have : Real.sqrt (1 + a) = 1007 - 256 * Real.sqrt (1 + a) + 16 * a := by linarith

  -- Square both sides to get $1+a = (1007-256\sqrt{1+a}+16a)^2$.
  have : 1 + a = 1007^2 - 2*1007*256*Real.sqrt (1 + a) + 2*1007*16*a + (256^2)*(Real.sqrt (1 + a))^2 - 2*256*16*a*Real.sqrt (1 + a) + 16^2*a^2 := by
    have := (Real.sqrt_eq_iff_eq_sq (by linarith) (by linarith)).mp this
    linarith

  -- Simplify to get $1+a = 1007^2-2*1007*256*sqrt(1+a)+2*1007*16*a+256^2*(1+a)-2*256*16*a*sqrt(1+a)+16^2*a^2$.
  have : 1 + a = 1007^2 - 2*1007*256*Real.sqrt (1 + a) + 2*1007*16*a + 256^2*(1 + a) - 2*256*16*a*Real.sqrt (1 + a) + 16^2*a^2 := by linarith

  -- We have $a = 1007^2-2*1007*256*sqrt(1+a)+2*1007*16*a+256^2-2*256*16*a*sqrt(1+a)+16^2*a^2$.
  have : a = 1007^2 - 2*1007*256*Real.sqrt (1 + a) + 2*1007*16*a + 256^2 - 2*256*16*a*Real.sqrt (1 + a) + 16^2*a^2 := by linarith

  -- Square both sides to get $a^2 = (1007^2-2*1007*256*\sqrt{1+a}+2*1007*16*a+256^2-2*256*16*a*\sqrt{1+a}+16^2*a^2)^2$.
  have : a^2 = (1007^2 - 2*1007*256*Real.sqrt (1 + a) + 2*1007*16*a + 256^2 - 2*256*16*a*Real.sqrt (1 + a) + 16^2*a^2)^2 := by
    have := (Real.sqrt_eq_iff_eq_sq (by linarith) (by linarith)).mp this
    linarith

  -- Simplify to get $a^2 = 1007^4 - 2*1007^3*512*sqrt(1+a) + 2*1007^3*64*2*a - 2*1007^2*256^2*(1+a) + 4*1007^2*256^2*a^2 + 2*1007*512*256*a^3 - 2*1007*256*sqrt(1+a)*a^2 + 2*1007*64*256^2*a^2 - 2*256^3*sqrt(1+a)*a^2 + 256^4*a^4$.
  have : a^2 = 1007^4 - 2*1007^3*512*Real.sqrt (1 + a) + 2*1007^3*64*2*a - 2*1007^2*256^2*(1 + a) + 4*1007^2*256^2*a^2 + 2*1007*512*256*a^3 - 2*1007*256*Real.sqrt (1 + a)*a^2 + 2*1007*64*256^2*a^2 - 2*256^3*Real.sqrt (1 + a)*a^2 + 256^4*a^4 := by linarith

  -- All terms other than the first and last are divisible by $4*256^2 = 1024$.
  have : a^2 = 1007^4 + 256^4*a^4 + 1024*( - 2*1007^3*sqrt(1 + a) + 2*1007^3*a - 2*1007^2*(1 + a) + 4*1007^2*a^2 + 2*1007*a^3 - 2*1007*sqrt(1 + a)*a^2 + 2*1007*a^2 - 2*sqrt(1 + a)*a^2 + a^2) := by
    ring_nf
    rw [Real.sq_sqrt]
    · ring
    · linarith

  -- Let $b = \sqrt{1 + a}$, then $a = b^2-1$.
  set b := Real.sqrt (1 + a)
  have : a = b^2 - 1 := by
    have : 1 + a = b^2 := by
      rw [Real.sq_sqrt]
      linarith
    linarith

  -- We have $b^4-2b^2+1 = ((b^2-1)^2) = a^2 = 1007^4 + 256^4(b^2-1)^4 + 1024(-2b^3+b^2-2b^2(b^2-1) + 4b^2(b^2-1)^2 + 2b(b^2-1)^3 - 2b(b^2-1)^2 + b^2)$.
  rw [this] at *
  have : b^4-2*b^2+1 = ((b^2-1)^2) := by ring
  rw [this] at *

  -- Simplify to get $b^4-2b^2+1 = 1007^4 + 256^4(b^2-1)^4 + 1024(-2b^3+b^2-2b^2(b^2-1) + 4b^2(b^2-1)^2 + 2b(b^2-1)^3 - 2b(b^2-1)^2 + b^2)$.
  have : b^4-2*b^2+1 = 1007^4 + 256^4*(b^2-1)^4 + 1024*(-2*b^3+b^2-2*b^2*(b^2-1) + 4*b^2*(b^2-1)^2 + 2*b*(b^2-1)^3 - 2*b*(b^2-1)^2 + b^2) := by linarith

  -- Let $c = b^2$, then $b^4 = c^2$.
  set c := b^2
  have : b^4 = c^2 := by ring

  -- We have $c^2-2c+1 = 1007^4 + 256^4(c-1)^4 + 1024(-2bc+b^2-2b^2(b^2-1) + 4b^2(b^2-1)^2 + 2b(b^2-1)^3 - 2b(b^2-1)^2 + b^2)$.
  rw [this] at *

  -- Simplify to get $c^2-2c+1 = 1007^4 + 256^4(c-1)^4 + 1024(-2bc+b^2-2b^2(b^2-1) + 4b^2(b^2-1)^2 + 2b(b^2-1)^3 - 2b(b^2-1)^2 + b^2)$.
  have : c^2-2*c+1 = 1007^4 + 256^4*(c-1)^4 + 1024*(-2*b*c+b^2-2*b^2*(b^2-1) + 4*b^2*(b^2-1)^2 + 2*b*(b^2-1)^3 - 2*b*(b^2-1)^2 + b^2) := by linarith

  -- Note that $b^2 = c$.
  have hb (h : b^2 = c) : b = c := by
    have : b = c := by
      apply (Real.sqrt_eq_iff_eq_sq?_?_).mp
      · rw [h]
      · rw [h]
    exact this
  rw [hb this]

  -- We have $c^2-2c+1 = 1007^4 + 256^4(c-1)^4 + 1024(-2bc+b^2-2b^2(b^2-1) + 4b^2(b^2-1)^2 + 2b(b^2-1)^3 - 2b(b^2-1)^2 + b^2)$.
  have : c^2-2*c+1 = 1007^4 + 256^4*(c-1)^4 + 1024*(-2*c*c+c^2-2*c^2*(c-1) + 4*c^2*(c-1)^2 + 2*c*(c-1)^3 - 2*c*(c-1)^2 + c^2) := by linarith

  -- Simplify to get $c^2-2c+1 = 1007^4 + 256^4(c-1)^4 + 1024(-2c^2+c^2-2c^2(c-1) + 4c^2(c-1)^2 + 2c(c-1)^3 - 2c(c-1)^2 + c^2)$.
  have : c^2-2*c+1 = 1007^4 + 256^4*(c-1)^4 + 1024*(-2*c^2+c^2-2*c^2*(c-1) + 4*c^2*(c-1)^2 + 2*c*(c-1)^3 - 2*c*(c-1)^2 + c^2) := by linarith

  -- Note that $(c-1)^2 = c^2-2c+1$.
  have : c^2-2*c+1 = 1007^4 + 256^4*(c-1)^4 + 1024*(-2*c^2+c^2-2*c^2*(c-1) + 4*c^2*(c-1)^2 + 2*c*(c-1)^3 - 2*c*(c-1)^2 + c^2) := by linarith

  -- Simplify to get $c^2-2c+1 = 1007^4 + 256^4(c^2-2c+1)^2 + 1024(-2c^2+c^2-2c^2(c-1) + 4c^2(c-1)^2 + 2c(c-1)^3 - 2c(c-1)^2 + c^2)$.
  have : c^2-2*c+1 = 1007^4 + 256^4*(c^2-2*c+1)^2 + 1024*(-2*c^2+c^2-2*c^2*(c-1) + 4*c^2*(c-1)^2 + 2*c*(c-1)^3 - 2*c*(c-1)^2 + c^2) := by linarith

  -- Let $d = c^2-2c+1$.
  set d := c^2-2*c+1
  have : c^2-2*c+1 = d := by
    simp [d]
  rw [this]

  -- We have $d = 1007^4 + 256^4*d^2 + 1024*(-2*c^2+c^2-2*c^2*(c-1) + 4*c^2*(c-1)^2 + 2*c*(c-1)^3 - 2*c*(c-1)^2 + c^2)$.
  have : d = 1007^4 + 256^4*d^2 + 1024*(-2*c^2+c^2-2*c^2*(c-1) + 4*c^2*(c-1)^2 + 2*c*(c-1)^3 - 2*c*(c-1)^2 + c^2) := by linarith

  -- Note that $d = (c-1)^2$.
  have : d = (c-1)^2 := by
    simp only [d]
    rw [← this]
    ring
  rw [this]

  -- We have $d = 1007^4 + 256^4*d^2 + 1024*(-2*c^2+c^2-2*c^2*(c-1) + 4*c^2*(c-1)^2 + 2*c*(c-1)^3 - 2*c*(c-1)^2 + c^2)$.
  have : d = 1007^4 + 256^4*d^2 + 1024*(-2*c^2+c^2-2*c^2*(c-1) + 4*c^2*(c-1)^2 + 2*c*(c-1)^3 - 2*c*(c-1)^2 + c^2) := by linarith

  -- This simplifies to $256^4*d^2-(1-1024)*d+(1-1007^4) = 0$.
  have : 256^4*d^2 + (-1025)*d + (1-1007^4) = 0 := by linarith

  -- Solving this quadratic equation, we get $d = 1$ or $d = (1007^2-1)/256^2$.
  have : (d-