have h₂ : ∀ n, 997 ≤ n → n ≤ 1002 → f n = n - 3 := by
    intro n h₃ h₄
    interval_cases n
    · rfl
    · rw [h₀ 999 (by norm_num)]
      rfl
    · rw [h₀ 1000 (by norm_num)]
      rfl

  have h₃ : f 997 = 999 := by
    rw [h₁ 997 (by norm_num), h₀ 1002 (by norm_num)]
    rfl

  have h₄ : f 998 = 1000 := by
    rw [h₁ 998 (by norm_num), h₀ 1003 (by norm_num)]
    rfl

  have h₅ : f 999 = 996 := by
    rw [h₁ 999 (by norm_num), h₃]
    rw [h₁ 996 (by norm_num), h₀ 1002 (by norm_num)]
    rfl

  have h₆ : f 1000 = 997 := by
    rw [h₁ 1000 (by norm_num), h₄]
    rw [h₁ 997 (by norm_num), h₃]
    rfl

  -- Now we need to show that $f(84)=997$. We have the recursion relation $f(n+5)=\begin{cases}
  -- f^{-1}(n)&\mbox{if}\ f(n)>n\\
  -- f^{-1}(n+3)&\mbox{if}\ f(n)\le n\end{cases}$

  -- where $f^{-1}(n)$ is the inverse of $f$ at $n$.
  have h₇ (n : ℤ) : f (f n) = n + 3 := by
    cases le_or_gt (f n) n with
    | inl h =>
      have h₈ := h₁ n h
      have h₉ := h₀ (f n) (by linarith)
      rw [h₈, h₉]
      linarith
    | inr h =>
      have h₁₀ := h₁ n (by linarith)
      have h₁₁ := h₀ n (by linarith)
      rw [h₁₀, h₁₁, h, show f (f n) = f (f (f n)) by rw [h₁ n (by linarith)]]


  -- We can find $f(84)$ by simulating the recursion relation --
  -- starting with $f(84)=f(f(87))=87+3=90$ and $f(90)=f(f(93))=93+3=96$ and $f(96)=f(f(99))=99+3=102$ and $f(102)=f(f(105))=105+3=108$ and so on until we get $f(997)=999$ and $f(998)=1000$ and $f(999)=996$ and $f(1000)=997$.
  have h₈ : f 84 = 90 := by
    rw [h₁ 84 (by norm_num), h₁ 87 (by norm_num), h₁ 90 (by norm_num),
      h₁ 93 (by norm_num), h₁ 96 (by norm_num), h₁ 99 (by norm_num),
      h₁ 102 (by norm_num), h₁ 105 (by norm_num), h₁ 108 (by norm_num),
      h₁ 111 (by norm_num), h₁ 114 (by norm_num), h₁ 117 (by norm_num),
      h₁ 120 (by norm_num), h₁ 123 (by norm_num), h₁ 126 (by norm_num),
      h₁ 129 (by norm_num), h₁ 132 (by norm_num), h₁ 135 (by norm_num),
      h₁ 138 (by norm_num), h₁ 141 (by norm_num), h₁ 144 (by norm_num),
      h₁ 147 (by norm_num), h₁ 150 (by norm_num), h₁ 153 (by norm_num),
      h₁ 156 (by norm_num), h₁ 159 (by norm_num), h₁ 162 (by norm_num),
      h₁ 165 (by norm_num), h₁ 168 (by norm_num), h₁ 171 (by norm_num),
      h₁ 174 (by norm_num), h₁ 177 (by norm_num), h₁ 180 (by norm_num),
      h₁ 183 (by norm_num), h₁ 186 (by norm_num), h₁ 189 (by norm_num),
      h₁ 192 (by norm_num), h₁ 195 (by norm_num), h₁ 198 (by norm_num),
      h₁ 201 (by norm_num), h₁ 204 (by norm_num), h₁ 207 (by norm_num),
      h₁ 210 (by norm_num), h₁ 213 (by norm_num), h₁ 216 (by norm_num),
      h₁ 219 (by norm_num), h₁ 222 (by norm_num), h₁ 225 (by norm_num),
      h₁ 228 (by norm_num), h₁ 231 (by norm_num), h₁ 234 (by norm_num),
      h₁ 237 (by norm_num), h₁ 240 (by norm_num), h₁ 243 (by norm_num),
      h₁ 246 (by norm_num), h₁ 249 (by norm_num), h₁ 252 (by norm_num),
      h₁ 255 (by norm_num), h₁ 258 (by norm_num), h₁ 261 (by norm_num),
      h₁ 264 (by norm_num), h₁ 267 (by norm_num), h₁ 270 (by norm_num),
      h₁ 273 (by norm_num), h₁ 276 (by norm_num), h₁ 279 (by norm_num),
      h₁ 282 (by norm_num), h₁ 285 (by norm_num), h₁ 288 (by norm_num),
      h₁ 291 (by norm_num), h₁ 294 (by norm_num), h₁ 297 (by norm_num),
      h₁ 300 (by norm_num), h₁ 303 (by norm_num), h₁ 306 (by norm_num),
      h₁ 309 (by norm_num), h₁ 312 (by norm_num), h₁ 315 (by norm_num),
      h₁ 318 (by norm_num), h₁ 321 (by norm_num), h₁ 324 (by norm_num),
      h₁ 327 (by norm_num), h₁ 330 (by norm_num), h₁ 333 (by norm_num),
      h₁ 336 (by norm_num), h₁ 339 (by norm_num), h₁ 342 (by norm_num),
      h₁ 345 (by norm_num), h₁ 348 (by norm_num), h₁ 351 (by norm_num),
      h₁ 354 (by norm_num), h₁ 357 (by norm_num), h₁ 360 (by norm_num),
      h₁ 363 (by norm_num), h₁ 366 (by norm_num), h₁ 369 (by norm_num),
      h₁ 372 (by norm_num), h₁ 375 (by norm_num), h₁ 378 (by norm_num),
      h₁ 381 (by norm_num), h₁ 384 (by norm_num), h₁ 387 (by norm_num),
      h₁ 390 (by norm_num), h₁ 393 (by norm_num), h₁ 396 (by norm_num),
      h₁ 399 (by norm_num), h₁ 402 (by norm_num), h₁ 405 (by norm_num),
      h₁ 408 (by norm_num), h₁ 411 (by norm_num), h₁ 414 (by norm_num),
      h₁ 417 (by norm_num), h₁ 420 (by norm_num), h₁ 423 (by norm_num),
      h₁ 426 (by norm_num), h₁ 429 (by norm_num), h₁ 432 (by norm_num),
      h₁ 435 (by norm_num), h₁ 438 (by norm_num), h₁ 441 (by norm_num),
      h₁ 444 (by norm_num), h₁ 447 (by norm_num), h₁ 450 (by norm_num),
      h₁ 453 (by norm_num), h₁ 456 (by norm_num), h₁ 459 (by norm_num),
      h₁ 462 (by norm_num), h₁ 465 (by norm_num), h₁ 468 (by norm_num),
      h₁ 471 (by norm_num), h₁ 474 (by norm_num), h₁ 477 (by norm_num),
      h₁ 480 (by norm_num), h₁ 483 (by norm_num), h₁ 486 (by norm_num),
      h₁ 489 (by norm_num), h₁ 492 (by norm_num), h₁ 495 (by norm_num),
      h₁ 498 (by norm_num), h₁ 501 (by norm_num), h₁ 504 (by norm_num),
      h₁ 507 (by norm_num), h₁ 510 (by norm_num), h₁ 513 (by norm_num),
      h₁ 516 (by norm_num), h₁ 519 (by norm_num), h₁ 522 (by norm_num),
      h₁ 525 (by norm_num), h₁ 528 (by norm_num), h₁ 531 (by norm_num),
      h₁ 534 (by norm_num), h₁ 537 (by norm_num), h₁ 540 (by norm_num),
      h₁ 543 (by norm_num), h₁ 546 (by norm_num), h₁ 549 (by norm_num),
      h₁ 552 (by norm_num), h₁ 555 (by norm_num), h₁ 558 (by norm_num),
      h₁ 561 (by norm_num), h₁ 564 (by norm_num), h₁ 567 (by norm_num),
      h₁ 570 (by norm_num), h₁ 573 (by norm_num), h₁ 576 (by norm_num),
      h₁ 579 (by norm_num), h₁ 582 (by norm_num), h₁ 585 (by norm_num),
      h₁ 588 (by norm_num), h₁ 591 (by norm_num), h₁ 594 (by norm_num),
      h₁ 597 (by norm_num), h₁ 600 (by norm_num), h₁ 603 (by norm_num),
      h₁ 606 (by norm_num), h₁ 609 (by norm_num), h₁ 612 (by norm_num),
      h₁ 615 (by norm_num), h₁ 618 (by norm_num), h₁ 621 (by norm_num),
      h₁ 624 (by norm_num), h₁ 627 (by norm_num), h₁ 630 (by norm_num),
      h₁ 633 (by norm_num), h₁ 636 (by norm_num), h₁ 639 (by norm_num),
      h₁ 642 (by norm_num), h₁ 645 (by norm_num), h₁ 648 (by norm_num),
      h₁ 651 (by norm_num), h₁ 654 (by norm_num), h₁ 657 (by norm_num),
      h₁ 660 (by norm_num), h₁ 663 (by norm_num), h₁ 666 (by norm_num),
      h₁ 669 (by norm_num), h₁ 672 (by norm_num), h₁ 675 (by norm_num),
      h₁ 678 (by norm_num), h₁ 681 (by norm_num), h₁ 684 (by norm_num),
      h₁ 687 (by norm_num), h₁ 690 (by norm_num), h₁ 693 (by norm_num),
      h₁ 696 (by norm_num), h₁ 699 (by norm_num), h₁ 702 (by norm_num),
      h₁ 705 (by norm_num), h₁ 708 (by norm_num), h₁ 711 (by norm_num),
      h₁ 714 (by norm_num), h₁ 717 (by norm_num), h₁ 720 (by norm_num),
      h₁ 723 (by norm_num), h₁ 726 (by norm_num), h₁ 729 (by norm_num),
      h₁ 732 (by norm_num), h₁ 735 (by norm_num), h₁ 738 (by norm_num),
      h₁ 741 (by norm_num), h₁ 744 (by norm_num), h₁ 747 (by norm_num),
      h₁ 750 (by norm_num), h₁ 753 (by norm_num), h₁ 756 (by norm_num),
      h₁ 759 (by norm_num), h₁ 762 (by norm_num), h₁ 765 (by norm_num),
      h₁ 768 (by norm_num), h₁ 771 (by norm_num), h₁ 774 (by norm_num),
      h₁ 777 (by norm_num), h₁ 780 (by norm_num), h₁ 783 (by norm_num),
      h₁ 786 (by norm_num), h₁ 789 (by norm_num), h₁ 792 (by norm_num),
      h₁ 795 (by norm_num), h₁ 798 (by norm_num), h₁ 801 (by norm_num),
      h₁ 804 (by norm_num), h₁ 807 (by norm_num), h₁ 810 (by norm_num),
      h₁ 813 (by norm_num), h₁ 816 (by norm_num), h₁ 819 (by norm_num),
      h₁ 822 (by norm_num), h₁ 825 (by norm_num), h₁ 828 (by norm_num),
      h₁ 831 (by norm_num), h₁ 834 (by norm_num), h₁ 837 (by norm_num),
      h₁ 840 (by norm_num), h₁ 843 (by norm_num), h₁ 846 (by norm_num),
      h₁ 849 (by norm_num), h₁ 852 (by norm_num), h₁ 855 (by norm_num),
      h₁ 858 (by norm_num), h₁ 861 (by norm_num), h₁ 864 (by norm_num),
      h₁ 867 (by norm_num), h₁ 870 (by norm_num), h₁ 873 (by norm_num),
      h₁ 876 (by norm_num), h₁ 879 (by norm_num), h₁ 882 (by norm_num),
      h₁ 885 (by norm_num), h₁ 888 (by norm_num), h₁ 891 (by norm_num),
      h₁ 894 (by norm_num), h₁ 897 (by norm_num), h₁ 900 (by norm_num),
      h₁ 903 (by norm_num), h₁ 906 (by norm_num), h₁ 909 (by norm_num),
      h₁ 912 (by norm_num), h₁ 915 (by norm_num), h₁ 918 (by norm_num),
      h₁ 921 (by norm_num), h₁ 924 (by norm_num), h₁ 927 (by norm_num),
      h₁ 930 (by norm_num), h₁ 933 (by norm_num), h₁ 936 (by norm_num),
      h₁ 939 (by norm_num), h₁ 942 (by norm_num), h₁ 945 (by norm_num),
      h₁ 948 (by norm_num), h₁ 951 (by norm_num), h₁ 954 (by norm_num),
      h₁ 957 (by norm_num), h₁ 960 (by norm_num), h₁ 963 (by norm_num),
      h₁ 96