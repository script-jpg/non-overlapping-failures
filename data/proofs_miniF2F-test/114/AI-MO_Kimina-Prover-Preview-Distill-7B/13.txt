-- We have coprime conditions on $n^2-n+41$ and $n^2+n+41$.
  have h₂ : Nat.gcd (n ^ 2 - n + 41) (n ^ 2 + n + 41) = 1 := by
    calc
      _ = Nat.gcd (n ^ 2 - n + 41) (n * (n + 1) + 41) := by ring_nf
      _ = Nat.gcd (n ^ 2 - n + 41) (n * (n + 1) + 41 - (n - 1) * (n ^ 2 - n + 41)) := by
        apply Nat.gcd_sub_self
        rw [Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left]
        ring_nf
        rw [Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left]
        ring_nf
      _ = Nat.gcd (n ^ 2 - n + 41) ((n - 1) * (n + 41) + 41 - (-(n ^ 2) + 2 * n + 41 * (n - 1))) := by ring_nf
      _ = Nat.gcd (n ^ 2 - n + 41) ((n - 1) * (n + 41) + 41 - (-(n ^ 2) + 2 * n + 41 * (n - 1))) - Nat.gcd (n ^ 2 - n + 41) ((n - 1) * (n + 41) + 41 - (-(n ^ 2) + 2 * n + 41 * (n - 1))) := by
        apply Nat.gcd_sub_self
        rw [Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left]
        ring_nf
        nth_rw 2 [Nat.add_sub_assoc]
        rw [Nat.sub_sub, Nat.add_sub_cancel_left]
        ring_nf
      _ = Nat.gcd (n ^ 2 - n + 41) ((n - 1) * (n + 41) + 41 - (-(n ^ 2) + 2 * n + 41 * (n - 1))) - Nat.gcd (n ^ 2 - n + 41) ((n - 1) * (n + 41) + 41 - (-(n ^ 2) + 2 * n + 41 * (n - 1))) := by
        ring_nf
      _ = Nat.gcd (n ^ 2 - n + 41) ((n - 1) * (n + 41) + 41 - (-(n ^ 2) + 2 * n + 41 * (n - 1))) - Nat.gcd (n ^ 2 - n + 41) ((n - 1) * (n + 41) + 41 - (-(n ^ 2) + 2 * n + 41 * (n - 1))) := by
        ring_nf
      _ = 1 := by
        calc
          _ |>.symm |>.calc
            _ = Nat.gcd (n ^ 2 - n + 41 - 1 + 1) (n * (n + 1) + 41 - 1 + 1) := by
              congr
              rw [Nat.sub_add_cancel]
              ring_nf
              rw [Nat.sub_add_cancel]
              ring_nf
            _ = Nat.gcd (n * (n - 1) + 41 * (n - 1) + 1) (n * (n + 1) + 41 * 1) := by
              rw [Nat.add_assoc, Nat.add_sub_assoc, Nat.add_sub_cancel, Nat.add_comm, Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left, Nat.mul_add, Nat.add_sub_assoc, Nat.add_sub_cancel]
              ring_nf
              rw [Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left]
              ring_nf
            _ = 1 := by
              rw [Nat.gcd_comm, Nat.add_sub_cancel_left]
              rw [Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left]
              ring_nf
              rw [Nat.mul_add, Nat.add_sub_assoc, Nat.add_sub_cancel]
              ring_nf
              rw [Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left]
              ring_nf
          _ = 1 := by
            rw [Nat.gcd_comm, Nat.add_sub_cancel_left]
            rw [Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left]
            ring_nf
            rw [Nat.mul_add, Nat.add_sub_assoc, Nat.add_sub_cancel]
            ring_nf
            rw [Nat.mul_sub, Nat.sub_sub, Nat.add_sub_cancel_left]
            ring_nf
    -- The previous calculations show that it is enough to prove that
    -- $n^2-n+41$ and $n^2+n+41$ are coprime.
    _ = Nat.gcd (p n) (p (n + 1)) := by
      rw [h₀, h₀]
      ring_nf

  -- Now we show that the coprimality of $n^2-n+41$ and $n^2+n+41$ implies
  -- the coprimality of $n^2-n+41$ and $n^2+n+41$.
  have h₃ : n ^ 2 - n + 41 ∣ (n ^ 2 - n + 41) := by
    apply Nat.dvd_refl
  have h₄ : n ^ 2 + n + 41 ∣ (n ^ 2 + n + 41) := by
    apply Nat.dvd_refl
  apply Nat.Coprime.dvd_of_dvd_mul_right h₃ h₄ at h₂
  -- Since $n^2-n+41$ and $n^2+n+41$ are coprime, we have
  -- $n^2-n+41 \mid p(n)$ and $n^2+n+41 \mid p(n+1)$.
  replace h₂ : n ^ 2 + n + 41 ∣ p (n + 1) := by
    calc
      _ |>.symm |>.calc
        _ ∣ p n * p (n + 1) := by
          apply Nat.dvd_mul_left
        _ = n ^ 2 + n + 41 := by
          rw [h₀, h₀]
          ring_nf
          rw [Nat.add_mul, Nat.mul_add, Nat.mul_add, Nat.mul_one, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.sub_add_cancel, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.sub_mul, Nat.mul_sub, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.add_assoc, Nat.mul_one, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_cancel, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_cancel, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_cancel]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [h₀, h₀]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [h₀, h₀]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [h₀, h₀]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [h₀, h₀]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          rw [h₀, h₀]
          ring_nf
          rw [Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_comm, Nat.sub_add_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg, Nat.add_comm, Nat.mul_add, Nat.add_assoc, Nat.mul_one, Nat.add_sub_cancel, Nat.add_sub_cancel_left, Nat.add_sub_comm, Nat.add_sub_assoc, Nat.add_sub_neg]
          ring_nf
          ring_nf]
  -- which means that $n^2-n+41$ and $n^2+n+41$ are coprime.
  rw [h₀, h₀] at h₂
  ring_nf at h₂
  rw [show n + 1 = 1 + n by ring] at h₂
  rw [Nat.mul_add, Nat.add_mul] at h₂
  ring_nf at h₂
  -- As a corollary we have $n > 40$.
  have h₅ : n > 40 := by
    -- If $n \leq 40$ then $n$ is a witness for $\forall{n}({n^2 - n + 41} \mid p(n))$.
    by_contra! h
    interval_cases n <;> norm_num at h₂
    -- But we do not need to go this far.
    -- We do not need to prove that the coprimality condition implies $n > 40$.
    -- We can do better.
    -- We show that if $n < 41$ then the gcd of $n^2-n+41$ and $n^2+n+41$ is not 1.
    interval_cases n
    -- There are only $41$ cases.
    -- They are all impossible.
    all_goals norm_num at h₂
  -- So we have $n \geq 41$.
  exact h₅

```