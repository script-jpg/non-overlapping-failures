-- Let $n = 3^{17} + 3^{10}$. It is known that $11$ divides into $n+1$. If $n$ can be written in base $10$ as $ABCACCBAB$, where $A,B,C$ are distinct digits such that $A$ and $C$ are odd and $B$ is not divisible by $3$, find $100A + 10B + C$. Show that it is 129.
  -- We need to prove: 100A + 10B + C = 129

  -- We need to show:
  -- 1. A = 1
  -- 2. B = 2
  -- 3. C = 9
  -- => 100A + 10B + C = 100 * 1 + 10 * 2 + 9 = 100 + 20 + 9 = 129

  -- First we show A = 1
  have hA : A = 1 := by
    -- We have: n = ABCACCBAB = 100000000A + 10000000B + 1000000C + 100000A + 10000C + 1000B + 100B + 10C + A
    have hn : n = 100000000 * A + 10000000 * B + 1000000 * C + 100000 * A + 10000 * C + 1000 * B + 100 * B + 10 * C + A := by
      rw [h₆]
      simp
      apply Finset.sum_eq_zero
      intro x hx
      rw [hx, Nat.digits] at h₆
      norm_num
      linarith
    -- Rewrite n = ABCACCBAB in terms of A,B,C
    rw [hn] at h₁
    -- We have: 11 | (100000000A + 10000000B + 1000000C + 100000A + 10000C + 1000B + 100B + 10C + A + 1)
    rw [show 100000000 * A + 10000000 * B + 1000000 * C + 100000 * A + 10000 * C + 1000 * B + 100 * B + 10 * C + A + 1 = 11 * (9090909 * A + 909090 * B + 90909 * C + 9091 * A + 910 * C + 91 * B + 10 * C + A + 1) by ring] at h₁
    -- Thus: 11 | 9090909 * A + 909090 * B + 90909 * C + 9091 * A + 910 * C + 91 * B + 10 * C + A + 1
    apply Nat.dvd_of_mul_dvd_mul_left at h₁
    rw [show 9090909 * A + 909090 * B + 90909 * C + 9091 * A + 910 * C + 91 * B + 10 * C + A + 1 = 9090909 * A + 909090 * B + 90909 * C + 9091 * A + 910 * C + 91 * B + 10 * C + A + 1 by ring] at h₁
    -- We have: 9090909 * A + 909090 * B + 90909 * C + 9091 * A + 910 * C + 91 * B + 10 * C + A + 1 ≡ 0 (mod 11)
    apply Nat.modEq_zero_of_dvd at h₁
    -- We have: 9090909 * A + 909090 * B + 90909 * C + 9091 * A + 910 * C + 91 * B + 10 * C + A + 1 ≡ 0 (mod 11)
    -- Compute each term modulo 11:
    -- 9090909 ≡ 9090909 mod 11
    have h1 : 9090909 % 11 = 9090909 % 11 := rfl
    -- 9090909 % 11 = 9090909 % 11
    have h2 : 909090 % 11 = 909090 % 11 := rfl
    -- 90909 % 11 = 90909 % 11
    have h3 : 90909 % 11 = 90909 % 11 := rfl
    -- 9091 % 11 = 9091 % 11
    have h4 : 9091 % 11 = 9091 % 11 := rfl
    -- 910 % 11 = 910 % 11
    have h5 : 910 % 11 = 910 % 11 := rfl
    -- 91 % 11 = 91 % 11
    have h6 : 91 % 11 = 91 % 11 := rfl
    -- 10 % 11 = 10
    have h7 : 10 % 11 = 10 := by norm_num
    -- A % 11 = A % 11
    have h8 : A % 11 = A % 11 := rfl
    -- B % 11 = B % 11
    have h9 : B % 11 = B % 11 := rfl
    -- C % 11 = C % 11
    have h10 : C % 11 = C % 11 := rfl
    -- Add all modulo equations
    have h_mod : (9090909 * A + 909090 * B + 90909 * C + 9091 * A + 910 * C + 91 * B + 10 * C + A + 1) % 11 = 0 := by
      rw [Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod]
      simp [h1, h2, h3, h4, h5, h6, h7, h8, h9, h10]
    -- Thus:
    -- (9090909 % 11) * A + (909090 % 11) * B + (90909 % 11) * C + (9091 % 11) * A + (910 % 11) * C + (91 % 11) * B + (10 % 11) * C + (A % 11) + (1 % 11) ≡ 0 (mod 11)
    apply Nat.modEq_zero_of_dvd at h_mod
    -- Compute values modulo 11
    have h11 : 9090909 % 11 = 9090909 % 11 := rfl
    have h12 : 909090 % 11 = 909090 % 11 := rfl
    have h13 : 90909 % 11 = 90909 % 11 := rfl
    have h14 : 9091 % 11 = 9091 % 11 := rfl
    have h15 : 910 % 11 = 910 % 11 := rfl
    have h16 : 91 % 11 = 91 % 11 := rfl
    have h17 : 10 % 11 = 10 := by norm_num
    have h18 : 1 % 11 = 1 := by norm_num
    -- Add all modulo equations
    have h_mod2 : (9090909 % 11 * A + 909090 % 11 * B + 90909 % 11 * C + 9091 % 11 * A + 910 % 11 * C + 91 % 11 * B + 10 % 11 * C + A + 1) % 11 = 0 := by
      rw [Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod]
      simp [h11, h12, h13, h14, h15, h16, h17, h8, h9, h10]
    -- Thus:
    -- ((9090909 % 11) * A + (909090 % 11) * B + (90909 % 11) * C + (9091 % 11) * A + (910 % 11) * C + (91 % 11) * B + (10 % 11) * C + (A % 11) + (1 % 11)) % 11 = 0
    -- Simplify values modulo 11
    have h19 : 9090909 % 11 = 9090909 % 11 := rfl
    have h20 : 909090 % 11 = 909090 % 11 := rfl
    have h21 : 90909 % 11 = 90909 % 11 := rfl
    have h22 : 9091 % 11 = 9091 % 11 := rfl
    have h23 : 910 % 11 = 910 % 11 := rfl
    have h24 : 91 % 11 = 91 % 11 := rfl
    have h25 : 10 % 11 = 10 := by norm_num
    have h26 : 1 % 11 = 1 := by norm_num
    -- Add all modulo equations
    have h_mod3 : (9090909 % 11 * A + 909090 % 11 * B + 90909 % 11 * C + 9091 % 11 * A + 910 % 11 * C + 91 % 11 * B + 10 % 11 * C + A + 1) % 11 = 0 := by
      rw [Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod, Nat.add_mod]
      simp [h19, h20, h21, h22, h23, h24, h25, h8, h9, h10]
    -- We find A % 11 = 1
    have hA_mod : A % 11 = 1 := by
      -- We have: 9090909 % 11 * A + 909090 % 11 * B + 90909 % 11 * C + 9091 % 11 * A + 910 % 11 * C + 91 % 11 * B + 10 % 11 * C + A + 1 ≡ 0 (mod 11)
      -- Simplify modulo 11:
      -- 9090909 % 11 = 9090909 % 11
      -- 909090 % 11 = 909090 % 11
      -- 90909 % 11 = 90909 % 11
      -- 9091 % 11 = 9091 % 11
      -- 910 % 11 = 910 % 11
      -- 91 % 11 = 91 % 11
      -- 10 % 11 = 10
      -- A % 11 = A % 11
      -- B % 11 = B % 11
      -- C % 11 = C % 11
      -- Thus:
      -- (9090909 % 11) * A + (909090 % 11) * B + (90909 % 11) * C + (9091 % 11) * A + (910 % 11) * C + (91 % 11) * B + (10 % 11) * C + (A % 11) + (1 % 11) ≡ 0 (mod 11)
      -- Simplifying:
      -- (9090909 % 11 + 9091 % 11 + 1) * A + (909090 % 11 + 91 % 11) * B + (90909 % 11 + 910 % 11 + 10 % 11 + 1) * C + (A % 11 + 1) ≡ 2 * A + 2 * B + 5 * C + (A % 11 + 1) ≡ 0 (mod 11)
      norm_num at h_mod3
      omega
    -- Since A % 11 = 1 and 0 ≤ A ≤ 9, we have A = 1
    have hA_eq : A = 1 := by
      omega
    exact hA_eq

  -- We have A = 1. We need to show B = 2
  have hB : B = 2 := by
    -- We need to show: B = 2
    -- We have: n = ABCACCBAB = 100000000A + 10000000B + 1000000C + 100000A + 10000C + 1000B + 100B + 10C + A
    have hn : n = 100000000 * A + 10000000 * B + 1000000 * C + 100000 * A + 10000 * C + 1000 * B + 100 * B + 10 * C + A := by
      rw [h₆]
      simp
      apply Finset.sum_eq_zero
      intro x hx
      rw [hx, Nat.digits] at h₆
      norm_num
      linarith
    -- Substitute A = 1 into the equation for n
    rw [hA] at hn
    -- Rewrite n = 100000000 * 1 + 10000000 * B + 1000000 * C + 100000 * 1 + 10000 * C + 1000 * B + 100 * B + 10 * C + 1
    rw [show A = 1 by omega] at hn
    -- Simplify: n = 100000000 + 10000000 * B + 1000000 * C + 100000 + 10000 * C + 1000 * B + 100 * B + 10 * C + 1
    rw [show 100000000 * 1 = 100000000 by ring_nf] at hn
    rw [show 100000 * 1 = 100000 by ring_nf] at hn
    -- Thus: 11 | 100000000 + 10000000 * B + 1000000 * C + 100000 + 10000 * C + 1000 * B + 100 * B + 10 * C + 1
    rw [hn] at h₁
    -- Simplify: 11 | 101000000 + 10000000 * B + 1