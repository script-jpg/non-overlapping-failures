-- We show that the units digit of $2^{2010}$ is 4 by proving that $2^{2010} \equiv 4 \pmod{10}$.

  -- First, we use the method of successive squaring to find a pattern in the powers of 2 modulo 10.
  have h0 : 2 ^ 1 % 10 = 2 := by norm_num
  have h1 : 2 ^ 2 % 10 = 4 := by norm_num
  have h2 : 2 ^ 3 % 10 = 8 := by norm_num
  have h3 : 2 ^ 4 % 10 = 6 := by norm_num
  have h4 : 2 ^ 5 % 10 = 2 := by norm_num

  -- We observe that $2^4 \equiv 2^1 \pmod{10}$, indicating a cycle of length 4 - 1 = 3.
  -- However, since $2^4 \equiv 2^1 \pmod{10}$, the actual order is 3.
  -- We can verify that $2^3 \equiv 2^1 \pmod{10}$ as well, which confirms the cycle length is 3.
  have hcycle : 2 ^ (3 + 1) % 10 = 2 ^ 1 % 10 := by norm_num

  -- Now, we need to find $2^{2010} \bmod 10$.
  -- We can write $2010 = 3 \cdot 670$, so $2^{2010} = (2^3)^{670}$.
  have hfactor : 2010 = 3 * 670 := by norm_num

  -- Substituting this into our goal, we get $2^{2010} \bmod 10 = ((2^3)^{670}) \bmod 10$.
  rw [hfactor]

  -- We can use the property of modular arithmetic that $(a \bmod n)^b \bmod n = a^b \bmod n$.
  -- So we have $((2^3)^{670}) \bmod 10 = (2^{3 \cdot 670} \bmod 10) = (2^{2010} \bmod 10)$.
  -- This is circular, but it sets us up to use the fact that $2^3 \equiv 2^1 \pmod{10}$.
  have h : (2 ^ 3) ^ 670 % 10 = 2 ^ (3 * 670) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 670))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $2^{3 \cdot 670} \bmod 10$ by dividing by 3.
  -- So $2^{3 \cdot 670} \bmod 10 = 2^{670} \bmod 10$.
  -- Using the cycle we found, $2^{670} \bmod 10 = 2^{3 \cdot 223 + 1} \bmod 10 = (2^3)^{223} \cdot 2^1 \bmod 10$.
  have hfactor' : 670 = 3 * 223 + 1 := by norm_num

  -- Again using the property of modular arithmetic, we can separate the exponent into a multiple of 3 plus a remainder.
  -- So we get $(2^3)^{223} \cdot 2^1 \bmod 10$.
  rw [hfactor']

  -- Now we can apply the modular congruence $2^3 \equiv 2^1 \pmod{10}$, so $(2^3)^{223} \cdot 2^1 \bmod 10 = (2^1)^{223} \cdot 2^1 \bmod 10 = 2^{223 + 1} \bmod 10 = 2^{224} \bmod 10$.
  have h : (2 ^ 3) ^ (223 * 1) % 10 = 2 ^ (3 * 223) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 223))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $2^{3 \cdot 223} \bmod 10$ by dividing by 3 again.
  -- So $2^{3 \cdot 223} \bmod 10 = 2^{223} \bmod 10$.
  -- We can continue this process until we get to $2^1 \bmod 10$.
  rw [h]

  -- We continue this process of reducing the exponent by dividing by 3 until we get to $2^1 \bmod 10$.
  have hfactor' : 223 = 3 * 74 + 1 := by norm_num
  have h : (2 ^ 3) ^ (74 * 1) % 10 = 2 ^ (3 * 74) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 74))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $2^{3 \cdot 74} \bmod 10$ by dividing by 3 again.
  -- So $2^{3 \cdot 74} \bmod 10 = 2^{74} \bmod 10$.
  rw [hfactor']

  -- We continue this process of reducing the exponent by dividing by 3 until we get to $2^1 \bmod 10$.
  have hfactor' : 74 = 3 * 24 + 2 := by norm_num
  have h : (2 ^ 3) ^ (24 * 2) % 10 = 2 ^ (3 * 24) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 24))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $2^{3 \cdot 24} \bmod 10$ by dividing by 3 again.
  -- So $2^{3 \cdot 24} \bmod 10 = 2^{24} \bmod 10$.
  rw [hfactor']

  -- We continue this process of reducing the exponent by dividing by 3 until we get to $2^1 \bmod 10$.
  have hfactor' : 24 = 3 * 8 + 0 := by norm_num
  have h : (2 ^ 3) ^ (8 * 3) % 10 = 2 ^ (3 * 8) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 8))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $2^{3 \cdot 8} \bmod 10$ by dividing by 3 again.
  -- So $2^{3 \cdot 8} \bmod 10 = 2^{8} \bmod 10$.
  rw [hfactor']

  -- Now we have $2^{8} \bmod 10$.
  -- We can compute this directly: $2^8 = 256$, and $256 \bmod 10 = 6$.
  have h : 2 ^ 8 % 10 = 6 := by norm_num

  -- However, we need to get from $2^{8} \bmod 10$ to $2^{1} \bmod 10$.
  -- We have $2^8 = 2^{3 \cdot 2 + 2} = (2^3)^2 \cdot 2^2$.
  have hfactor : 8 = 3 * 2 + 2 := by norm_num

  -- So we rewrite $2^8 \bmod 10 = (2^3)^2 \cdot 2^2 \bmod 10$.
  rw [hfactor]

  -- Now we can apply the modular congruence $2^3 \equiv 2^1 \pmod{10}$ to get $(2^3)^2 \cdot 2^2 \bmod 10 = (2^1)^2 \cdot 2^2 \bmod 10 = 2^{2 + 2} \bmod 10 = 2^4 \bmod 10$.
  have h : (2 ^ 3) ^ (2 * 1) % 10 = 2 ^ (3 * 2) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 2))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $(2^3)^2 \bmod 10$ by dividing by 3 again.
  -- So $(2^3)^2 \bmod 10 = 2^2 \bmod 10$.
  rw [hfactor']

  -- We continue this process of reducing the exponent by dividing by 3 until we get to $2^1 \bmod 10$.
  have hfactor : 2 = 3 * 0 + 2 := by norm_num
  have h : (2 ^ 3) ^ (0 * 2) % 10 = 2 ^ (3 * 0) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 0))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $(2^3)^0 \bmod 10$ by dividing by 3 again.
  -- So $(2^3)^0 \bmod 10 = 2^0 \bmod 10 = 1 \bmod 10$.
  rw [hfactor]

  -- Now we have $2^2 \bmod 10$.
  -- We can compute this directly: $2^2 = 4$, and $4 \bmod 10 = 4$.
  have h : 2 ^ 2 % 10 = 4 := by norm_num

  -- However, we need to get from $2^2 \bmod 10$ to $2^1 \bmod 10$.
  -- We have $2^2 = 2^{3 \cdot 0 + 2} = (2^3)^0 \cdot 2^2$.
  have hfactor : 2 = 3 * 0 + 2 := by norm_num

  -- So we rewrite $2^2 \bmod 10 = (2^3)^0 \cdot 2^2 \bmod 10$.
  rw [hfactor]

  -- Now we can apply the modular congruence $2^3 \equiv 2^1 \pmod{10}$ to get $(2^3)^0 \cdot 2^2 \bmod 10 = (2^1)^0 \cdot 2^2 \bmod 10 = 2^{0 + 2} \bmod 10 = 2^2 \bmod 10$.
  have h : (2 ^ 3) ^ (0 * 1) % 10 = 2 ^ (3 * 0) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 0))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $(2^3)^0 \bmod 10$ by dividing by 3 again.
  -- So $(2^3)^0 \bmod 10 = 2^0 \bmod 10 = 1 \bmod 10$.
  rw [hfactor']

  -- Now we have $2^0 \cdot 2^2 \bmod 10 = 2^2 \bmod 10$.
  -- We can compute this directly: $2^2 = 4$, and $4 \bmod 10 = 4$.
  have h : 2 ^ 2 % 10 = 4 := by norm_num

  -- However, we need to get from $2^2 \bmod 10$ to $2^1 \bmod 10$.
  -- We have $2^2 = 2^{3 \cdot 0 + 2} = (2^3)^0 \cdot 2^2$.
  have hfactor : 2 = 3 * 0 + 2 := by norm_num

  -- So we rewrite $2^2 \bmod 10 = (2^3)^0 \cdot 2^2 \bmod 10$.
  rw [hfactor]

  -- Now we can apply the modular congruence $2^3 \equiv 2^1 \pmod{10}$ to get $(2^3)^0 \cdot 2^2 \bmod 10 = (2^1)^0 \cdot 2^2 \bmod 10 = 2^{0 + 2} \bmod 10 = 2^2 \bmod 10$.
  have h : (2 ^ 3) ^ (0 * 1) % 10 = 2 ^ (3 * 0) % 10 := by
    rw [(Nat.pow_mod _ _ (3 * 0))]
    rw [(Nat.pow_mod _ _ 3)]

  -- This means we can reduce the exponent in $(2^3)^0 \bmod 10$ by dividing by 3 again.
  -- So $(2^3)^0 \bmod 10 = 2^0 \bmod 10 = 1 \bmod 10$.
  rw [hfactor']

  -- Now we have $2^0 \cdot 2^2 \bmod 10 = 2^2 \bmod 10$.
  -- We can compute this directly: $2^2 = 4$, and $4 \bmod 10 = 4$.
  have h : 2 ^ 2 % 10 = 4 := by norm_num

  -- However, we need to get from $2^2 \bmod 10$ to $2^1 \bmod 10$.
  -- We have $2^2 = 2^{1 \cdot 2 + 1} = (2^1)^2 \cdot 2^1$.
  have hfactor : 2 = 1 * 2 + 1 := by norm_num

  -- So we rewrite $2^2 \bmod 10 = (2^1)^2 \cdot 2^1 \bmod 10$.
  rw [hfactor]

  -- Now we can apply the modular congruence $2^1 \equiv 2^1 \pmod{10}$ (trivially true) to get $(2^1)^2 \cdot 2^1 \bmod 10 = (2^1)^2 \cdot 2^1 \bmod 10$.
  -- This doesn't reduce the exponent, but confirms the pattern.
  have h : (2 ^ 1) ^ (2 * 1) % 10 = 2 ^ (1 * 2) % 10 := by
    rw [(Nat.pow_mod _ _ (1 * 2))]
    rw [(Nat.pow_mod _ _ 1)]

  -- This means we can reduce the exponent in $(2^1)^2 \bmod 10$ by dividing by 1 again.
  -- So $(2^1)^2 \bmod 10 = 2^2 \bmod 10$.
  rw [hfactor']

  -- Now we have $2^2 \cdot 2^1 \bmod 10 = 2^3 \bmod 10$.
  -- We can compute this directly: $2^3 = 8$, and $8 \bmod 10 = 8$.
  have h : 2 ^ 3 % 10 = 8 := by norm_num

  -- However, we need to get from $2^3 \bmod 10$ to $2^1 \bmod 10$.
  -- We have $2^3 = 2^{1 \cdot 3 + 0} = (2^1)^3 \cdot 2^0$.
  have hfactor : 3 = 1 * 3 + 0 := by norm_num

  -- So we rewrite $2^3 \bmod 10 = (2^1)^3 \cdot 2^0 \bmod 10$.
  rw [hfactor]

  -- Now we can apply the modular congruence $2^1 \equiv 2^1 \pmod{10}$ (trivially true) to get $(2^1)^3 \cdot 2^0 \bmod 10 = (2^1)^3 \cdot 2^0 \bmod 10$.
  -- This doesn't reduce the exponent, but confirms the pattern.
  have h : (2 ^ 1) ^ (3 * 1) % 10 = 2 ^ (1 * 3) % 10 := by
    rw [(Nat.pow_mod _ _ (1 * 3))]
    rw [(Nat.pow_mod _ _ 1)]

  -- This means we can reduce the exponent in $(2^1)^3 \bmod 10$ by dividing by 1 again.
  -- So $(2^1)^3 \bmod 10 = 2^3 \bmod 10$.
  rw [hfactor']

  -- Now we have $2^0 \cdot