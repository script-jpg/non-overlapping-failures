-- We shall prove that $\left( D_{2021}, D_{2022}, D_{2023} \right)$ is $\left( \text{E}, \text{O}, \text{E} \right)$.
  -- To that end, we need to analyze the parity of the terms in the sequence $\left( D_n \right)_{n \geq 0}$.
  -- Let's first establish a pattern.
  have h : ∀ n ≥ 3, d n = d (n - 1) + d (n - 3) := h₃
  have : ∀ n, (d (3 * n), d (3 * n + 1), d (3 * n + 2)) = (\[0, 0, 1\] ∘![0, 1, 2] ∘![2, 0, 1] ^ n) := by
    intro n
    induction n with
    | zero =>
      simp
      norm_num
    | succ n hn =>
      simp
      rw [add_assoc, hn]
      simp
     ext i
      -- Now, we will show that the sequence eventually has a period of 13.
      - To that end, we first show that the sequence has a period of 13 when $i \leq 3$.
      - Then, we use strong induction on $i$ to finish the proof.
      match i with
      | 0 =>
        -- For $i = 0$, the claim is trivial.
        simp
      | 1 =>
        -- For $i = 1$, the claim follows from the fact that $D_1 = 0$.
        simp [h₁]
      | 2 =>
        -- For $i = 2$, the claim follows from the fact that $D_2 = 1$.
        simp [h₂]
      | 3 =>
        -- For $i = 3$, the claim follows from the fact that $D_3 = 1$.
        simp [h 3, h₁, h₂]
      | 4 =>
        -- For $i = 4$, the claim follows from the fact that $D_4 = 1$.
        simp [h 4, h 3, h 1, h₂]
      | 5 =>
        -- For $i = 5$, the claim follows from the fact that $D_5 = 2$.
        simp [h 5, h 4, h 3, h 2, h₂]
      | 6 =>
        -- For $i = 6$, the claim follows from the fact that $D_6 = 3$.
        simp [h 6, h 5, h 4, h 3, h 2, h₁]
      | 7 =>
        -- For $i = 7$, the claim follows from the fact that $D_7 = 4$.
        simp [h 7, h 6, h 5, h 4, h 3, h 2, h₁]
      | 8 =>
        -- For $i = 8$, the claim follows from the fact that $D_8 = 6$.
        simp [h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
      | 9 =>
        -- For $i = 9$, the claim follows from the fact that $D_9 = 9$.
        simp [h 9, h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
      | 10 =>
        -- For $i = 10$, the claim follows from the fact that $D_{10} = 13$.
        simp [h 10, h 9, h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
      | 11 =>
        -- For $i = 11$, the claim follows from the fact that $D_{11} = 19$.
        simp [h 11, h 10, h 9, h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
      | 12 =>
        -- For $i = 12$, the claim follows from the fact that $D_{12} = 28$.
        simp [h 12, h 11, h 10, h 9, h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
      | m + 13 =>
        -- For $i \geq 13$, we use strong induction on $i$.
        -- We can decompose the terms corresponding to $i = m + 13$ in terms of terms of $i \leq m$.
        simp [h (m + 13), h (m + 12), h (m + 11), h (m + 10), h (m + 9), h (m + 8), h (m + 7), h (m + 6), h (m + 5), h (m + 4), h (m + 3), h (m + 2), h (m + 1), h m]
        rw [show m + 1 = m + 12 + 1 by omega, show m + 2 = m + 12 + 2 by omega, show m + 3 = m + 12 + 3 by omega]
        rw [show m + 4 = m + 12 + 4 by omega, show m + 5 = m + 12 + 5 by omega, show m + 6 = m + 12 + 6 by omega]
        rw [show m + 7 = m + 12 + 7 by omega, show m + 8 = m + 12 + 8 by omega, show m + 9 = m + 12 + 9 by omega]
        rw [show m + 10 = m + 12 + 10 by omega, show m + 11 = m + 12 + 11 by omega, show m + 12 = m + 12 + 12 by omega]
        simp [h m]
        rw [<-add_assoc]
        ring
  -- From the pattern that we just proved, we can see that the sequence $\left( D_n \right)_{n \geq 0}$ has a period of 13.
  have h₄ : ∀ n, d (3 * n) = d (3 * n + 13) := by
    intro n
    simp
    rw [this n, this (n + 1), this (n + 2), this (n + 3), this (n + 4), this (n + 5), this (n + 6), this (n + 7), this (n + 8), this (n + 9), this (n + 10), this (n + 11), this (n + 12)]
    -- Now, we use the fact that the sequence is periodic to prove the claim.
    -- We will do so by comparing the values of $D_{2021}$, $D_{2022}$ and $D_{2023}$ with the values at certain indices.
    have : d 2021 = d 2022 := by
      -- Since $D_{2021} = D_{3 \cdot 673 + 2} = D_{3 \cdot 673 + 15} = D_{2015}$ and $D_{2022} = D_{3 \cdot 674} = D_{3 \cdot 673 + 13} = D_{2015 + 13} = D_{2028}$.
      -- We know that $D_{2021} = D_{2028}$.
      -- However, $D_{2021} = D_{3 \cdot 673 + 2} = D_{3 \cdot 673 + 15} = D_{2015}$ and $D_{2022} = D_{3 \cdot 674} = D_{3 \cdot 673 + 13} = D_{2015 + 13} = D_{2028}$.
      -- So, we need to show that $D_{2015} = D_{2028}$.
      suffices d (3 * 673 + 2) = d (3 * 673 + 15) by
        simp at this
        exact this
      -- We know that $D_{3 \cdot n + 2} = D_{3 \cdot n + 15}$ by extractating the periodicity.
      have : ∀ n, d (3 * n + 2) = d (3 * n + 15) := by
        intro n
        -- Now, we use the fact that the sequence has a period of 13 to prove the claim.
        rw [show 3 * n + 15 = 3 * (n + 1) + 12 + 3 by omega]
        rw [h₄ (n + 1), h₄ (n + 2), h₄ (n + 3), h₄ (n + 4), h₄ (n + 5), h₄ (n + 6), h₄ (n + 7), h₄ (n + 8), h₄ (n + 9), h₄ (n + 10), h₄ (n + 11), h₄ (n + 12), h₄ n]
        simp
      specialize this 673
      simp at this
      exact this
    have : d 2022 = d 2023 := by
      -- Since $D_{2022} = D_{3 \cdot 674} = D_{3 \cdot 673 + 13} = D_{2015 + 13} = D_{2028}$ and $D_{2023} = D_{3 \cdot 674 + 1} = D_{3 \cdot 674 + 14} = D_{2027}$.
      -- We know that $D_{2022} = D_{2027}$.
      -- However, $D_{2022} = D_{3 \cdot 674} = D_{3 \cdot 673 + 13} = D_{2015 + 13} = D_{2028}$ and $D_{2023} = D_{3 \cdot 674 + 1} = D_{3 \cdot 674 + 14} = D_{2027}$.
      -- So, we need to show that $D_{2028} = D_{2027}$.
      suffices d (3 * 674) = d (3 * 674 + 1) by
        simp at this
        exact this
      -- We know that $D_{3 \cdot n} = D_{3 \cdot n + 1}$ by extracting the periodicity.
      have : ∀ n, d (3 * n) = d (3 * n + 1) := by
        intro n
        -- Now, we use the fact that the sequence has a period of 13 to prove the claim.
        rw [show 3 * n + 1 = 3 * n + 12 - 11 by omega, <-h₄ n]
        simp
        rw [show 3 * n + 12 = 3 * (n + 4) by omega, show 3 * n + 1 = 3 * n + 12 - 11 by omega, show 3 * (n + 4) - 11 = 3 * n + 15 - 11 by omega, h₄ (n + 4), h₄ (n + 3), h₄ (n + 2), h₄ (n + 1), h₄ n]
        simp
      specialize this 674
      simp at this
      exact this
    have : d 2021 = d 2023 := by
      -- Now, we combine the previous results to get the desired equality.
      rw [this]
      trans d 2022
      rw [this]
    rw [this]

  -- Now, we need to show that $D_{2021}$ is even, $D_{2022}$ is odd and $D_{2023}$ is even.
  -- To that end, we notice from the pattern that $D_n$ is even iff $3 \nmid n$.
  have h₅ : ∀ n, Even (d n) ↔ 3 ∣ n := by
    intro n
    suffices d n % 2 = 0 ↔ 3 ∣ n by
      simp [this]
    -- Now, we use the fact that the sequence is periodic to simplify the expression.
    have : d n % 2 = d (n % 13) % 2 := by
      calc
        _ = d (n % 13) % 2 := by
          rw [show n % 13 = n - 13 * (n / 13) by omega, Nat.modEq_iff_dvd]
          apply Nat.modEq_iff_dvd.mp
          apply Nat.modEq_iff_dvd.mpr
          exists n / 13
          omega
        _ = _ := by
          rw [<-this]
          apply Nat.mod_modEq
    rw [this]
    -- Now, we use the pattern that we just proved to simplify the expression.
    have h₅ : ∀ n, (d (3 * n), d (3 * n + 1), d (3 * n + 2)) = (\[0, 0, 1\] ∘![0, 1, 2] ∘![2, 0, 1] ^ n) := by
      intro n
      induction n with
      | zero =>
        simp
        norm_num
      | succ n hn =>
        simp
        rw [add_assoc, hn]
        simp
       ext i
        match i with
        | 0 =>
          -- For $i = 0$, the claim is trivial.
          simp
        | 1 =>
          -- For $i = 1$, the claim follows from the fact that $D_1 = 0$.
          simp [h₁]
        | 2 =>
          -- For $i = 2$, the claim follows from the fact that $D_2 = 1$.
          simp [h₂]
        | 3 =>
          -- For $i = 3$, the claim follows from the fact that $D_3 = 1$.
          simp [h 3, h₁, h₂]
        | 4 =>
          -- For $i = 4$, the claim follows from the fact that $D_4 = 1$.
          simp [h 4, h 3, h 2, h₁]
        | 5 =>
          -- For $i = 5$, the claim follows from the fact that $D_5 = 2$.
          simp [h 5, h 4, h 3, h 2, h₁]
        | 6 =>
          -- For $i = 6$, the claim follows from the fact that $D_6 = 3$.
          simp [h 6, h 5, h 4, h 3, h 2, h₁]
        | 7 =>
          -- For $i = 7$, the claim follows from the fact that $D_7 = 4$.
          simp [h 7, h 6, h 5, h 4, h 3, h 2, h₁]
        | 8 =>
          -- For $i = 8$, the claim follows from the fact that $D_8 = 6$.
          simp [h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
        | 9 =>
          -- For $i = 9$, the claim follows from the fact that $D_9 = 9$.
          simp [h 9, h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
        | 10 =>
          -- For $i = 10$, the claim follows from the fact that $D_{10} = 13$.
          simp [h 10, h 9, h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
        | 11 =>
          -- For $i = 11$, the claim follows from the fact that $D_{11} = 19$.
          simp [h 11, h 10, h 9, h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
        | 12 =>
          -- For $i = 12$, the claim follows from the fact that $D_{12} = 28$.
          simp [h 12, h 11, h 10, h 9, h 8, h 7, h 6, h 5, h 4, h 3, h 2, h₁]
        | m + 13 =>
          -- For $i \geq 13$, we use strong induction on $i$.
          -- We can decompose the terms corresponding to $i = m + 13$ in terms of terms of $i \leq m$.