-- Let $S_n = ax^n + by^n$.
  let S (n : ℕ) := a * x ^ n + b * y ^ n

  -- Then $S_1 = 3$, $S_2 = 7$, $S_3 = 16$, $S_4 = 42$, and we want to prove that $S_5 = 20$.
  have hS1 : S 1 = 3 := by rwa [S]
  have hS2 : S 2 = 7 := by rwa [S]
  have hS3 : S 3 = 16 := by rwa [S]
  have hS4 : S 4 = 42 := by rwa [S]
  rw [S]; simp

  -- $S_n$ satisfies a linear recurrence relation $S_{n+2} = (x+y)S_{n+1} - xyS_n$.
  have SRec : ∀ n, S (n + 2) = (x + y) * S (n + 1) - x * y * S n := by
    intro n
    rw [S]
    calc
      a * x ^ (n + 2) + b * y ^ (n + 2)
        = (x * y) * (a * x ^ (n + 1) + b * y ^ (n + 1)) + (x ^ (n + 2) * a + y ^ (n + 2) * b) - (x * y) * (a * x ^ (n + 1) + b * y ^ (n + 1)) := by ring
      _ = (x * y) * S (n + 1) + (x ^ (n + 2) * a + y ^ (n + 2) * b) - (x * y) * S (n + 1) := by rw [S]
      _ = (x * y) * S (n + 1) + (x ^ (n + 1) * x * a + y ^ (n + 1) * y * b) - (x * y) * S (n + 1) := by ring
      _ = (x * y) * S (n + 1) + x * a * (x ^ (n + 1)) + y * b * (y ^ (n + 1)) - (x * y) * S (n + 1) := by ring
      _ = (x * y) * S (n + 1) + a * x ^ (n + 1) * (x + y) - (x * y) * S (n + 1) := by ring
      _ = a * x ^ (n + 2) + b * y ^ (n + 2) := by rw [mul_add, S]; ring

  -- Use the recurrence relation to compute $S_5$.
  have hS5 : S 5 = (x + y) * S 4 - x * y * S 3 := by rw [SRec 3]
  rw [hS4, hS3] at hS5

  -- Now we want to compute $(x+y) * 42 - x * y * 16$.
  have h₄ : (x + y) * 42 - x * y * 16 = 20 := by
    have : x * y ≠ 0 := by
      by_contra! hxy
      rw [hxy] at hS1 hS2 hS3 hS4
      linarith only [hS1, hS2, hS3, hS4]

    have h₄ : (x + y) * (a * x ^ 3 + b * y ^ 3) = (x + y) * 16 := by rw [hS3]
    have h₅ : (x + y) * (a * x ^ 2 + b * y ^ 2) - x * y * (a * x ^ 3 + b * y ^ 3) = 42 - (x * y) * 16 := by rw [hS2, hS3, hS4]

    calc
      (x + y) * 42 - x * y * 16
        = (x + y) * (a * x ^ 2 + b * y ^ 2) - x * y * (a * x ^ 3 + b * y ^ 3) := by rw [hS2, hS3, hS4]
      _ = 42 - (x * y) * 16 := by rw [h₅]
      _ = 20 := by linarith only [h₄]

  linarith only [hS5, h₄]

```