-- Proof by contradiction
  by_contra! h

  -- Show that $n$ is not prime, i.e. it has divisors other than 1 and itself
  rw [Nat.not_prime_iff_exists_dvd_lt (by linarith)] at h

  -- Extract the divisor $d$ of $n$ that is not 1 or $n$
  obtain ⟨d, h₀, h₁, h₂, h₃⟩ := h

  -- Prove that $d$ is greater than 1
  have hd₀ : 1 < d := by

    -- Use the fact that $d$ divides $n$ and $n > 0$ to show $d > 0$
    have : 0 < d := by
      apply Nat.pos_of_dvd_pos h₀ h₀
      linarith

    -- Show that $d \geq 2$ by contradiction
    by_contra! h
    have : d = 1 := by linarith
    contradiction

  -- Prove that $d$ is less than $n$
  have hd₁ : d < n := by
    apply Nat.lt_of_dvd_of_lt h₀ (by linarith)

  -- Show that $2^d - 1$ divides $2^n - 1$
  have h₄ : 2 ^ d - 1 ∣ 2 ^ n - 1 := by

    -- Use the properties of exponents to factor $2^n - 1$ in terms of $2^d - 1$
    rw [show n = d * (n / d) by rw [Nat.mul_comm, Nat.div_mul_cancel h₀]] at h₃
    rw [Nat.pow_mul, Nat.pow_mul]

    -- Show that $(2^d - 1) \cdot (2^{n/d} + \ldots + 2^0)$ is an integer
    have : (2 ^ d - 1) * (2 ^ (n / d - 1) + 2 ^ (n / d - 2) + (2 : ℤ) ^ (n / d - 3) + (2 : ℤ) ^ (n / d - 4) + (2 : ℤ) ^ (n / d - 5) + (2 : ℤ) ^ (n / d - 6) + (2 : ℤ) ^ (n / d - 7) + (2 : ℤ) ^ (n / d - 8) + (2 : ℤ) ^ (n / d - 9) + (2 : ℤ) ^ (n / d - 10) + (2 : ℤ) ^ (n / d - 11) + (2 : ℤ) ^ (n / d - 12) + (2 : ℤ) ^ (n / d - 13) + (2 : ℤ) ^ (n / d - 14) + (2 : ℤ) ^ (n / d - 15) + (2 : ℤ) ^ (n / d - 16) + (2 : ℤ) ^ (n / d - 17) + (2 : ℤ) ^ (n / d - 18) + (2 : ℤ) ^ (n / d - 19) + (2 : ℤ) ^ (n / d - 20) + (2 : ℤ) ^ (n / d - 21) + (2 : ℤ) ^ (n / d - 22) + (2 : ℤ) ^ (n / d - 23) + (2 : ℤ) ^ (n / d - 24) + (2 : ℤ) ^ (n / d - 25) + (2 : ℤ) ^ (n / d - 26) + (2 : ℤ) ^ (n / d - 27) + (2 : ℤ) ^ (n / d - 28) + (2 : ℤ) ^ (n / d - 29) + (2 : ℤ) ^ (n / d - 30) + (2 : ℤ) ^ (n / d - 31) + (2 : ℤ) ^ (n / d - 32) + (2 : ℤ) ^ (n / d - 33) + (2 : ℤ) ^ (n / d - 34) + (2 : ℤ) ^ (n / d - 35) + (2 : ℤ) ^ (n / d - 36) + (2 : ℤ) ^ (n / d - 37) + (2 : ℤ) ^ (n / d - 38) + (2 : ℤ) ^ (n / d - 39) + (2 : ℤ) ^ (n / d - 40) + (2 : ℤ) ^ (n / d - 41) + (2 : ℤ) ^ (n / d - 42) + (2 : ℤ) ^ (n / d - 43) + (2 : ℤ) ^ (n / d - 44) + (2 : ℤ) ^ (n / d - 45) + (2 : ℤ) ^ (n / d - 46) + (2 : ℤ) ^ (n / d - 47) + (2 : ℤ) ^ (n / d - 48) + (2 : ℤ) ^ (n / d - 49) + (2 : ℤ) ^ (n / d - 50) + (2 : ℤ) ^ (n / d - 51) + (2 : ℤ) ^ (n / d - 52) + (2 : ℤ) ^ (n / d - 53) + (2 : ℤ) ^ (n / d - 54) + (2 : ℤ) ^ (n / d - 55) + (2 : ℤ) ^ (n / d - 56) + (2 : ℤ) ^ (n / d - 57) + (2 : ℤ) ^ (n / d - 58) + (2 : ℤ) ^ (n / d - 59) + (2 : ℤ) ^ (n / d - 60) + (2 : ℤ) ^ (n / d - 61) + (2 : ℤ) ^ (n / d - 62) + (2 : ℤ) ^ (n / d - 63)) = 2 ^ n - 1] at h₃
    norm_num at h₃
    have h₄ : (2 ^ d - 1) * (2 ^ (n / d - 1) + 2 ^ (n / d - 2) + (2 : ℤ) ^ (n / d - 3) + (2 : ℤ) ^ (n / d - 4) + (2 : ℤ) ^ (n / d - 5) + (2 : ℤ) ^ (n / d - 6) + (2 : ℤ) ^ (n / d - 7) + (2 : ℤ) ^ (n / d - 8) + (2 : ℤ) ^ (n / d - 9) + (2 : ℤ) ^ (n / d - 10) + (2 : ℤ) ^ (n / d - 11) + (2 : ℤ) ^ (n / d - 12) + (2 : ℤ) ^ (n / d - 13) + (2 : ℤ) ^ (n / d - 14) + (2 : ℤ) ^ (n / d - 15) + (2 : ℤ) ^ (n / d - 16) + (2 : ℤ) ^ (n / d - 17) + (2 : ℤ) ^ (n / d - 18) + (2 : ℤ) ^ (n / d - 19) + (2 : ℤ) ^ (n / d - 20) + (2 : ℤ) ^ (n / d - 21) + (2 : ℤ) ^ (n / d - 22) + (2 : ℤ) ^ (n / d - 23) + (2 : ℤ) ^ (n / d - 24) + (2 : ℤ) ^ (n / d - 25) + (2 : ℤ) ^ (n / d - 26) + (2 : ℤ) ^ (n / d - 27) + (2 : ℤ) ^ (n / d - 28) + (2 : ℤ) ^ (n / d - 29) + (2 : ℤ) ^ (n / d - 30) + (2 : ℤ) ^ (n / d - 31) + (2 : ℤ) ^ (n / d - 32) + (2 : ℤ) ^ (n / d - 33) + (2 : ℤ) ^ (n / d - 34) + (2 : ℤ) ^ (n / d - 35) + (2 : ℤ) ^ (n / d - 36) + (2 : ℤ) ^ (n / d - 37) + (2 : ℤ) ^ (n / d - 38) + (2 : ℤ) ^ (n / d - 39) + (2 : ℤ) ^ (n / d - 40) + (2 : ℤ) ^ (n / d - 41) + (2 : ℤ) ^ (n / d - 42) + (2 : ℤ) ^ (n / d - 43) + (2 : ℤ) ^ (n / d - 44) + (2 : ℤ) ^ (n / d - 45) + (2 : ℤ) ^ (n / d - 46) + (2 : ℤ) ^ (n / d - 47) + (2 : ℤ) ^ (n / d - 48) + (2 : ℤ) ^ (n / d - 49) + (2 : ℤ) ^ (n / d - 50) + (2 : ℤ) ^ (n / d - 51) + (2 : ℤ) ^ (n / d - 52) + (2 : ℤ) ^ (n / d - 53) + (2 : ℤ) ^ (n / d - 54) + (2 : ℤ) ^ (n / d - 55) + (2 : ℤ) ^ (n / d - 56) + (2 : ℤ) ^ (n / d - 57) + (2 : ℤ) ^ (n / d - 58) + (2 : ℤ) ^ (n / d - 59) + (2 : ℤ) ^ (n / d - 60) + (2 : ℤ) ^ (n / d - 61) + (2 : ℤ) ^ (n / d - 62) + (2 : ℤ) ^ (n / d - 63)) = 2 ^ n - 1] at h₃
    rw [←h₄] at h₃
    norm_cast at h₃

  -- Prove that $2^d - 1$ is less than $2^n - 1$
  have h₅ : 2 ^ d - 1 < 2 ^ n - 1 := by
    have h₆ : 2 ^ d < 2 ^ n := by
      apply Nat.pow_lt_pow_left
      linarith
      linarith
    omega

  -- Use the minimality of $2^n - 1$ as a prime divisor
  have h₆ : ∀ k > 1, k ∣ 2 ^ n - 1 → k ≥ 2 ^ n - 1 := by
    intro k hk₀ hk₁
    have h₇ : 2 ^ n - 1 ≥ 2 ^ n - 1 := by rfl
    by_contra! h
    have h₈ : 2 ^ n - 1 > 2 ^ n - 1 := by omega
    linarith

  -- Show that $2^d - 1$ is a prime divisor of $2^n - 1$ that is smaller than $2^n - 1$, a contradiction
  have h₇ := h₆ (2 ^ d - 1) (by linarith) h₄
  linarith
```