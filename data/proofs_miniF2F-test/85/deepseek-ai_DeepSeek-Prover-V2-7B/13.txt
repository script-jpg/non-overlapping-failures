by_contra h
  -- We use proof by contradiction. Assume n is not prime.
  have h₂ : n = 0 ∨ n = 1 ∨ ∃ a b : ℕ, 1 < a ∧ 1 < b ∧ n = a * b := by
    -- We consider the cases where n is 0, 1, or a product of two integers greater than 1.
    rw [Nat.prime_iff] at h
    by_cases h₃ : n = 0 <;> by_cases h₄ : n = 1 <;>
    by_cases h₅ : ∃ a b : ℕ, 1 < a ∧ 1 < b ∧ n = a * b <;>
    simp_all [Nat.prime_iff]
    <;>
    (try omega) <;>
    (try aesop) <;>
    (try
      {
        obtain ⟨a, b, h₆, h₇, h₈⟩ := h₅
        exact ⟨a, b, h₆, h₇, h₈⟩
      }) <;>
    (try
      {
        omega
      }) <;>
    (try
      {
        aesop
      })
  -- We now consider the cases for n.
  rcases h₂ with (rfl | rfl | ⟨a, b, h₃, h₄, rfl⟩)
  -- Case 1: n = 0 (which contradicts h₀).
  <;> norm_num at h₁
  -- Case 2: n = 1 (which contradicts h₀).
  <;> simp_all [Nat.Prime]
  -- Case 3: n = a * b where a, b > 1.
  <;>
  (try omega) <;>
  (try aesop) <;>
  (try
    {
      have h₆ : 2 ^ (a * b) - 1 = (2 ^ a - 1) * ∑ i in Finset.range b, 2 ^ (a * i) := by
        cases b with
        | zero => simp_all
        | succ b' =>
          simp_all [Finset.sum_range_succ, pow_add, pow_mul, Nat.mul_sub_left_distrib, Nat.mul_sub_right_distrib]
          <;> ring_nf
          <;> omega
      rw [h₆] at h₁
      apply Nat.not_prime_mul
      <;> simp_all [Nat.Prime, Nat.succ_le_iff, Nat.zero_lt_one]
      <;> omega
    }) <;>
  (try
    {
      have h₆ : 2 ^ (a * b) - 1 = (2 ^ a - 1) * ∑ i in Finset.range b, 2 ^ (a * i) := by
        cases b with
        | zero => simp_all
        | succ b' =>
          simp_all [Finset.sum_range_succ, pow_add, pow_mul, Nat.mul_sub_left_distrib, Nat.mul_sub_right_distrib]
          <;> ring_nf
          <;> omega
      rw [h₆] at h₁
      apply Nat.not_prime_mul
      <;> simp_all [Nat.Prime, Nat.succ_le_iff, Nat.zero_lt_one]
      <;> omega
    })
  <;>
  omega
  <;>
  aesop
  <;>
  omega
  <;>
  aesop
  <;>
  omega
  <;>
  aesop
  <;>
  omega
  <;>
  aesop
  <;>
  omega
  <;>
  aesop
  <;>
  omega
  <;>
  aesop
  <;>
  omega
  <;>
  aesop
  <;>
  omega
  <;>
  aesop
  <;>
  omega
  <;>
  aesop
  <;>