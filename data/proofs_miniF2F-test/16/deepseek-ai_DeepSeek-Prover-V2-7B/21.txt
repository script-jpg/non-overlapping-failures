have step₁ : ∀ n, 0 < n → f n = n := by
    intro n hn
    induction n using Nat.strong_induction_on with
    | h n ih =>
      cases n with
      | zero => contradiction
      | succ n =>
        by_cases h : f (n + 1) ≤ n
        · have h₂ : f (n + 1) ≤ n := h
          have h₃ : f (n + 1) < f (n + 1 + 1) := h₁ (n + 1) (by linarith)
          have h₄ : f (n + 1) ≤ n := by linarith
          have h₅ : f (n + 1) ≥ 1 := by linarith [h₀ (n + 1)]
          have h₆ : f (n + 1) = n + 1 := by
            omega
          have h₇ : f (n + 1) = n + 1 := by
            omega
          simp_all
          <;> omega
        · have h₂ : n + 1 < f (n + 1) := by
            omega
          have h₃ : f (f (n + 1)) < f (n + 1 + 1) := h₁ (n + 1) (by linarith)
          have h₄ : f (n + 1) ≥ n + 1 := by
            linarith
          have h₅ : f (n + 1) = n + 1 := by
            have h₆ := ih (f (n + 1)) (by linarith)
            have h₇ : f (n + 1) < f (n + 1 + 1) := h₁ (n + 1) (by linarith)
            have h₈ : f (n + 1) ≤ n + 1 := by
              omega
            omega
          simp_all
          <;> omega
  
  exact step₁


theorem imo_1977_p6_2 (f : ℕ → ℕ) (h₀ : ∀ n, 0 < f n) (h₁ : ∀ n, 0 < n → f (f n) < f (n + 1)) :
    ∀ n, 0 < n → f n = n := by
  have h₂ : ∀ n, 0 < n → f n = n := by
    intro n hn
    exact step₁ n hn
  exact h₂