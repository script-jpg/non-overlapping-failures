have step₁ : ∀ n, 0 < n → f n = n := by
    intro n hn
    induction n using Nat.strong_induction_on with
    | h n ih =>
      cases n with
      | zero => contradiction
      | succ n =>
        cases n with
        | zero =>
          have h₂ := h₁ 1 (by norm_num)
          have h₃ := h₁ 1 (by norm_num)
          have h₄ := h₀ 0
          have h₅ := h₀ 1
          have h₆ := h₀ (f 1)
          have h₇ := h₀ (f 0)
          simp at *
          <;> omega
        | succ n =>
          have h₂ := h₁ (n + 1) (by linarith)
          have h₃ := ih (f (n + 1)) (by
            have h₄ := h₀ (n + 1)
            have h₅ : f (n + 1) > 0 := by linarith
            omega)
          have h₄ := h₀ (n + 1)
          have h₅ : f (n + 1) > 0 := by linarith
          have h₆ : f (f (n + 1)) < f (n + 1 + 1) := by simpa using h₁ (n + 1) (by linarith)
          have h₇ : f (n + 1) ≤ n + 1 := by
            by_contra h
            have h₈ : f (n + 1) > n + 1 := by linarith
            have h₉ : f (f (n + 1)) ≥ f (n + 1) := by
              apply Nat.le_refl
            have h₁₀ : f (n + 1) > f (f (n + 1)) := by linarith
            nlinarith
          interval_cases f (n + 1) <;> simp_all (config := {decide := true}) <;> omega
  intro n hn
  exact step₁ n hn

theorem imo_1977_p6_improved (f : ℕ → ℕ) (h₀ : ∀ n, 0 < f n) (h₁ : ∀ n, 0 < n → f (f n) < f (n + 1)) :
    ∀ n, 0 < n → f n = n := by
  intro n hn
  have h₂ : ∀ n, 0 < n → f n = n := by
    intro n hn
    induction n using Nat.strong_induction_on with
    | h n ih =>
      cases n with
      | zero => contradiction
      | succ n =>
        cases n with
        | zero =>
          have h₃ := h₁ 1 (by norm_num)
          have h₄ := h₀ 0
          have h₅ := h₀ 1
          have h₆ := h₀ (f 1)
          have h₇ := h₀ (f 0)
          simp at *
          <;> omega
        | succ n =>
          have h₃ := h₁ (n + 1) (by linarith)
          have h₄ := ih (f (n + 1)) (by
            have h₅ := h₀ (n + 1)
            have h₆ : f (n + 1) > 0 := by linarith
            omega
          )
          have h₅ := h₀ (n + 1)
          have h₆ : f (n + 1) > 0 := by linarith
          have h₇ : f (f (n + 1)) < f (n + 1 + 1) := by simpa using h₁ (n + 1) (by linarith)
          have h₈ : f (n + 1) ≤ n + 1 := by
            by_contra h
            have h₉ : f (n + 1) > n + 1 := by linarith
            have h₁₀ : f (f (n + 1)) ≥ f (n +