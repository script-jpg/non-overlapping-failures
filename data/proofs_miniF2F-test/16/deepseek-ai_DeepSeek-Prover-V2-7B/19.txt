have step₁ : ∀ n, 0 < n → f n = n := by
    intro n hn
    induction n using Nat.strong_induction_on with
    | h n ih =>
      match n with
      | 0 => contradiction
      | 1 =>
        have h2 := h₁ 1 (by norm_num)
        have h3 := h₁ 0
        have h4 := h₀ 0
        have h5 := h₀ 1
        have h6 := h₀ (f 1)
        have h7 := h₁ (f 1)
        have h8 := h₀ (f 1 + 1)
        simp at * <;>
        (try omega) <;>
        (try
          (try
            nlinarith)) <;>
        (try
          {
            have h9 := h₁ 1 (by norm_num)
            simp_all [Nat.succ_le_iff] <;> omega
          }) <;>
        (try
          {
            have h9 := h₁ 1 (by norm_num)
            simp_all [Nat.succ_le_iff] <;> omega
          })
      | n + 2 =>
        have h2 := h₁ (n + 2) (by linarith)
        have h3 := ih (f (n + 2)) (by
          have h4 : f (n + 2) < n + 2 + 1 := by
            omega
          omega)
        have h4 := h₁ (n + 1) (by linarith)
        have h5 := h₀ (n + 1)
        have h6 := h₀ (f (n + 1))
        have h7 := h₀ (f (n + 2))
        have h8 := h₁ (f (n + 2))
        have h9 := h₁ (n + 1)
        have h10 := h₁ 0
        have h11 := h₀ 0
        have h12 := h₀ (n + 1)
        have h13 := h₀ (n + 2)
        have h14 := h₁ (n + 2)
        simp at *
        <;> omega
  
  have step₂ : ∀ n, 0 < n → f n = n := step₁
  exact step₂


theorem imo_1977_p6_general (f : ℕ → ℕ) (h₀ : ∀ n, 0 < f n) (h₁ : ∀ n, 0 < n → f (f n) < f (n + 1)) :
    ∀ n, 0 < n → f n = n := by
  have h₂ : ∀ n, 0 < n → f n = n := by
    intro n hn
    induction n using Nat.strong_induction_on with
    | h n ih =>
      match n with
      | 0 => contradiction
      | 1 =>
        have h2 := h₁ 1 (by norm_num)
        have h3 := h₀ 0
        have h4 := h₀ 1
        have h5 := h₀ (f 1)
        have h6 := h₁ (f 1)
        have h7 := h₀ (f 1 + 1)
        simp at * <;>
        (try omega) <;>
        (try
          (try
            nlinarith)) <;>
        (try
          {
            have h8 := h₁ 1 (by norm_num)
            simp_all [Nat.succ_le_iff] <;> omega
          }) <;>
        (try
          {
            have h8 := h₁ 1 (by norm_num)
            simp_all [Nat.succ_le_iff] <;> omega
          })
      | n + 2 =>
        have h2 := h₁ (n + 2) (by linarith)
        have h3 := ih (f (n + 2)) (by
          have h4 : f (n + 2) < n +