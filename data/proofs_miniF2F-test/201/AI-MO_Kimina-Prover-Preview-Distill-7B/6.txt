-- Define $(x_{n+1}, y_{n+1}) = (\sqrt{3}x_n - y_n, \sqrt{3}y_n + x_n)$.
  let f : ℝ × ℝ → ℝ × ℝ := fun ⟨x, y⟩ => (Real.sqrt 3 * x - y, Real.sqrt 3 * y + x)
  -- Apply the function to $(x_n, y_n)$ to get $(x_{n+1}, y_{n+1})$.
  let x (n : ℕ) : ℝ × ℝ := (a (n + 1), b (n + 1))
  have h (n : ℕ) : x (n + 1) = f (x n) := by
    simp [x, f, h₀, h₁]
  -- Apply the function 99 times to $(x_{100}, y_{100})$ to get $(x_1, y_1)$.
  have h' (n : ℕ) (m : ℕ) : x (n + m) = f^[m] (x n) := by
    induction m with
    | zero => simp
    | succ m ih =>
      rw [Nat.add_succ, ← ih, Nat.add_succ, h, Function.iterate_succ_apply]
  have h'' : x 100 = f^[99] (x 1) := := h' 1 99
  rw [← h'', h₂, h₃] at h'
  clear h'' h'

  -- We can linearly solve $(u_1, v_1)$ from $(u_{100}, v_{100})$ where
  -- $(u_{n+1}, v_{n+1}) = (\sqrt{3}u_n - v_n, \sqrt{3}v_n + u_n)$.
  let u (n : ℕ) : ℝ × ℝ := (a (n + 1), b (n + 1))
  let p : ℝ × ℝ := (2, 4)
  have g (n : ℕ) : u (n + 1) = f (u n) := by
    simp [u, f, h₀, h₁]
  have g' (n : ℕ) (m : ℕ) : u (n + m) = f^[m] (u n) := by
      induction m with
      | zero => simp
      | succ m ih =>
        rw [Nat.add_succ, ← ih, Nat.add_succ, g, Function.iterate_succ_apply]
  have g'' : u 100 = f^[99] (u 1) := := g' 1 99
  rw [g''] at h'

  -- Consider the matrix $M = \begin{bmatrix} x_1 & y_1 \\ z_1 & w_1 \end{bmatrix}$
  -- such that $(u_{100}, v_{100}) = M (u_1, v_1)$.
  set M : Matrix ℝ 2 2 :=!![↑(f^[99].1), ↑(f^[99].2), ↑(f^[99].2), ↑(f^[99].1)] with hM
  -- We need the determinant of $M$.
  have det_M : M.det = -4 ^ 99 := by
    simp [hM, Matrix.det_fin_two]
    rw [← @sub_eq_zero Real.sqrt 3 1 2 2]
    conv => rhs; simp [← pow_mul, mul_pow]
    rw [← pow_add, ← pow_mul, pow_one]
    rw [← sq_sub_sq, Real.sq_sqrt, ← pow_two]
    norm_num
    all_goals positivity
  -- We have
  -- $\begin{bmatrix} u_{100} \\ v_{100} \end{bmatrix} =
  -- \begin{bmatrix} x_1 & y_1 \\ z_1 & w_1 \end{bmatrix}
  -- \begin{bmatrix} u_1 \\ v_1 \end{bmatrix}$.
  have hM' : u 100 = M * u 1 := by
    rw [g'']
    simp [M]
    rw [← h]
    simp
  -- Hence $(u_1, v_1) = M^{-1} (u_{100}, v_{100})$.
  rw [hM', ge_iff_le_not_lt, ← Matrix.mul_inv] at h'
  simp at h'
  rw [hM, ge_iff_le_not_lt, ← Matrix.inv_apply] at h'
  simp at h'
  -- The first coordinate of $(u_1, v_1)$ is $a_1$.
  have : (M.inv * p).0 = 1 / 2 ^ 98 := by
    simp [hM, p]
    rw [Matrix.inv_fin_two, Matrix.det_fin_two, ← sq_sub_sq]
    norm_num
    all_goals positivity
  rw [← h', ge_iff_le_not_lt, ← ge_iff_le]
  simp
  rw [this]
  all_goals positivity

```