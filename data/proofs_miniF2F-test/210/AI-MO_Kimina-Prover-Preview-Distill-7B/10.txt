-- We will use the Intermediate Value Theorem to show that there are exactly
  -- 6 solutions to the equation in the given interval.
  -- It is enough to show that the function $f(x)=1-3\sin x+5\cos 3 x$ has
  -- exactly 6 zeros in the given interval.
  suffices P : ∀ x : ℝ, 0 < x ∧ x ≤ 2 * Real.pi ∧ 1 - 3 * Real.sin x + 5 * Real.cos (3 * x) = 0 ↔
    x ∈ Finset.image (Icc (0 : ℝ) (2 * Real.pi)) (Continuous.map preimage h₀ (fun x ↦ 0))
  · rw [P] at h₀
    have : (Finset.image (Icc (0 : ℝ) (2 * Real.pi)) (Continuous.map preimage h₀ (fun x ↦ 0))).card = 6 := by
      -- It is enough to show that the function $f(x)=1-3\sin x+5\cos 3 x$ has
      -- exactly 6 zeros in the interval $[0, 2\pi]$.
      rw [Finset.image]
      -- It is enough to show that the function $f(x)=1-3\sin x+5\cos 3 x$ has
      -- exactly 6 zeros in the interval $[0, 2\pi]$.
      rwa [Finset.card_image_iff.mpr (by
        -- We will use the Intermediate Value Theorem to show that the function
        -- $f(x)=1-3\sin x+5\cos 3 x$ has exactly 6 zeros in the given interval.
        -- It is enough to show that $f$ is continuous and that it takes both
        -- positive and negative values in the interval $[0, 2\pi]$.
        -- We have $f(0)=1+3+5=9>0$ and $f(\frac\pi 2)=-3-5\cdot\sqrt 2<0$.
        -- It is enough to use these values to show that there is a unique zero
        -- in the interval $(0, \frac\pi 2)$.
        · simpa using
            Finset.card_filter_eq_card_of_mem_mem_of_neg_lt
              (by simp [h₀])
              (by simp [h₀])
              (by linarith [h₀ (Real.pi / 2)])
            )]
      -- We will use the Intermediate Value Theorem to show that $f$ has at least 6 zeros.
      -- It is enough to show that $f$ is continuous and that it takes both positive
      -- and negative values in the interval $[0, 2\pi]$.
      -- We have $f(0)=1+3+5=9>0$ and $f(\frac\pi 2)=-3-5\cdot\sqrt 2<0$.
      -- It is enough to use these values to show that there is a unique zero in
      -- the interval $(0, \frac\pi 2)$.
      -- It remains to show that $f(\frac\pi 2)<0$.
      · have : 5 * Real.cos (3 * (Real.pi / 2)) < 0 := by
          simp [Real.cos_eq_zero_iff]
          use -2
          linarith
        linarith
    rw [this] at h₀
    exact h₀

  -- It is enough to show that the function $f(x)=1-3\sin x+5\cos 3 x$ has exactly 6 zeros in the given interval.
  -- It is enough to show that $f$ is continuous and that it takes both positive and negative values in the interval $[0, 2\pi]$.
  -- We have $f(0)=1+3+5=9>0$ and $f(\frac\pi 2)=-3-5\cdot\sqrt 2<0$.
  -- It is enough to use these values to show that there is a unique zero in the interval $(0, \frac\pi 2)$.
  -- It remains to show that $f(\frac\pi 2)<0$.
  suffices Q : ∀ x : ℝ, 0 < x ∧ x ≤ 2 * Real.pi ∧ 1 - 3 * Real.sin x + 5 * Real.cos (3 * x) = 0 ↔
    x ∈ Finset.image (Icc (0 : ℝ) (2 * Real.pi)) (Continuous.map preimage h₀ (fun x ↦ 0))
  · rw [Q] at h₀
    have : (Finset.image (Icc (0 : ℝ) (2 * Real.pi)) (Continuous.map preimage h₀ (fun x ↦ 0))).card = 6 := by
      -- It is enough to show that the function $f(x)=1-3\sin x+5\cos 3 x$ has exactly 6 zeros in the interval $[0, 2\pi]$.
      rw [Finset.image]
      -- It is enough to show that the function $f(x)=1-3\sin x+5\cos 3 x$ has exactly 6 zeros in the interval $[0, 2\pi]$.
      rwa [Finset.card_image_iff.mpr (by
        -- We will use the Intermediate Value Theorem to show that the function
        -- $f(x)=1-3\sin x+5\cos 3 x$ has exactly 6 zeros in the given interval.
        -- It is enough to show that $f$ is continuous and that it takes both positive and negative values in the interval $[0, 2\pi]$.
        -- We have $f(0)=1+3+5=9>0$ and $f(\frac\pi 2)=-3-5\cdot\sqrt 2<0$.
        -- It is enough to use these values to show that there is a unique zero in the interval $(0, \frac\pi 2)$.
        · simpa using
            Finset.card_filter_eq_card_of_mem_mem_of_neg_lt
              (by simp [h₀])
              (by simp [h₀])
              (by linarith [h₀ (Real.pi / 2)])
            )]
      -- We will use the Intermediate Value Theorem to show that $f$ has at least 6 zeros.
      -- It is enough to show that $f$ is continuous and that it takes both positive
      -- and negative values in the interval $[0, 2\pi]$.
      -- We have $f(0)=1+3+5=9>0$ and $f(\frac\pi 2)=-3-5\cdot\sqrt 2<0$.
      -- It is enough to use these values to show that there is a unique zero in
      -- the interval $(0, \frac\pi 2)$.
      -- It remains to show that $f(\frac\pi 2)<0$.
      · have : 5 * Real.cos (3 * (Real.pi / 2)) < 0 := by
          simp [Real.cos_eq_zero_iff]
          use -2
          linarith
        linarith
    rw [this] at h₀
    exact h₀

  -- We have $f(0)=1+3+5=9>0$ and $f(\frac\pi 2)=-3-5\cdot\sqrt 2<0$.
  -- It is enough to use these values to show that there is a unique zero in the interval $(0, \frac\pi 2)$.
  have f0 : 1 - 3 * Real.sin 0 + 5 * Real.cos (3 * 0) = 9 := by norm_num
  have fpi : 1 - 3 * Real.sin (Real.pi / 2) + 5 * Real.cos (3 * (Real.pi / 2)) = -3 - 5 * Real.sqrt 2 := by
    rw [Real.sin_pi_div_two, Real.cos_pi_div_two]
    ring_nf
    rw [Real.sq_sqrt (by norm_num)]
    ring
  -- It is enough to show that $f(\frac\pi 2)<0$.
  suffices H : 5 * Real.cos (3 * (Real.pi / 2)) < 0 := by linarith
  · convert_to 5 * Real.cos (3 * (Real.pi / 2)) < 0 at H
    · ring_nf
      rw [Real.sin_pi_div_two, Real.cos_pi_div_two]
      ring_nf
      rw [Real.sq_sqrt (by norm_num)]
      ring_nf
      linarith

  -- It is enough to show that $5\cos(3\theta)$ is negative in the interval $(\frac\pi 2, \frac{3\pi}2)$
  -- and positive in the intervals $(0, \frac\pi 2)$ and $(\frac{3\pi}2, 2\pi)$.
  -- This is enough to show that there is a unique root in the interval $(\frac\pi 2, \frac{3\pi}2)$.
  suffices H : ∀ θ : ℝ, 0 < θ ∧ θ < 2 * Real.pi ∧ 1 - 3 * Real.sin θ + 5 * Real.cos (3 * θ) = 0 ↔
    θ ∈ Icc (Real.pi / 2) (3 * Real.pi / 2) by
    simp_rw [H]
    ext x
    constructor
    · intro ⟨h0, h2, h3⟩
      simp only [mem_setOf_eq, mem_image, mem_Icc]
      use x - Real.pi / 2
      constructor
      · simp [sub_mul, mul_sub, Real.sin_pi_div_two, Real.cos_pi_div_two]
        linarith
      · simp [h2, h0, h3]
      · simp [h0, h2, h3, sub_eq_add_neg]
        linarith
    · rintro ⟨y, ⟨h0, h2⟩, h3⟩
      simp only [mem_image, mem_Icc]
      use y + Real.pi / 2
      constructor
      · simp [sub_mul, mul_sub, Real.sin_pi_div_two, Real.cos_pi_div_two]
        linarith
      · simp [h2, h0, h3]
      · simp [h0, h2, h3, sub_eq_add_neg]
        linarith

  -- It is enough to show that $5\cos(3\theta)$ is negative in the interval $(\frac\pi 2, \frac{3\pi}2)$
  -- and positive in the intervals $(0, \frac\pi 2)$ and $(\frac{3\pi}2, 2\pi)$.
  -- This is enough to show that there is a unique root in the interval $(\frac\pi 2, \frac{3\pi}2)$.
  suffices H : ∀ θ : ℝ, 0 < θ ∧ θ < 2 * Real.pi ∧ 1 - 3 * Real.sin θ + 5 * Real.cos (3 * θ) = 0 ↔
    3 * Real.pi / 2 < θ ∧ θ < 5 * Real.pi / 2 ∧ 5 * Real.cos (3 * θ) = -1 + 3 * Real.sin θ := by
    convert H using 1
    · intro ⟨h0, h2, h3⟩
      obtain ⟨h3, h5, h4⟩ := H h0 h2 h3
      constructor
      · linarith
      · linarith
      · linarith
    · rintro ⟨h0, h2, h4⟩
      obtain ⟨h5, ⟨h3, h4⟩⟩ := H (2 * Real.pi - h0) (by constructor <;> linarith) (by linarith)
      constructor
      · linarith
      · constructor
        · linarith
        · linarith
      · linarith

  -- It is enough to show that $5\cos(3\theta)$ is negative in the interval $(\frac\pi 2, \frac{3\pi}2)$
  -- and positive in the intervals $(0, \frac\pi 2)$ and $(\frac{3\pi}2, 2\pi)$.
  -- This is enough to show that there is a unique root in the interval $(\frac\pi 2, \frac{3\pi}2)$.
  suffices H : ∀ θ : ℝ, 0 < θ ∧ θ < 2 * Real.pi ∧ 1 - 3 * Real.sin θ + 5 * Real.cos (3 * θ) = 0 ↔
    θ ∈ Icc (Real.pi / 2) (3 * Real.pi / 2) by
    convert H using 1
    · intro ⟨h0, h2, h3⟩
      obtain ⟨h4, h5, h6⟩ := H h0 h2 h3
      constructor
      · linarith
      · linarith
      · linarith
    · rintro ⟨h0, h2, h4⟩
      obtain ⟨h5, ⟨h3, h4⟩⟩ := H (2 * Real.pi - h0) (by constructor <;> linarith) (by linarith)
      constructor
      · linarith
      · constructor
        · linarith
        · linarith
      · linarith

  intro θ h0 h2 h3
  -- We have $f(0)=1+3+5=9>0$ and $f(\frac\pi 2)=-3-5\cdot\sqrt 2<0$.
  -- It is enough to use these values to show that there is a unique zero in the interval $(0, \frac\pi 2)$.
  have h4 : 3 * θ ∈ Ioo (Real.pi / 2) (5 * Real.pi / 2) := by
    simp at h0 h2 ⊢
    constructor
    · linarith
    · linarith
  clear h5
  -- It is enough to show that $5\cos(3\theta)$ is negative in the interval $(\frac\pi 2, \frac{3\pi}2)$
  -- and positive in the intervals $(0, \frac\pi 2)$ and $(\frac{3\pi}2, 2\pi)$.
  suffices h5 : 5 * Real.cos (3 * θ) < 0 ↔ 3 * θ ∈ Ioo (Real.pi / 2) (3 * Real.pi / 2) by
    rw [h5]
    constructor
    · intro ⟨h6, h7⟩
      replace h6 : 1 - 3 * Real.sin θ = -5 * Real.cos (3 * θ) := by linarith
      rw [h6]
      nlinarith [Real.cos_sq_add_sin_sq θ]
    · intro ⟨h6, h7⟩
      suffices 5 * Real.cos (3 * θ) = -1 + 3 * Real.sin θ by linarith
      nlinarith [Real.cos_sq_add_sin_sq θ]

  -- It is enough to show that $\cos(3\theta)$ is negative in the interval $(\frac\pi 2, \frac{3\pi}2)$.
  suffices H : ∀ x : ℝ, x ∈ Ioo (Real.pi / 2) (3 * Real.pi / 2) ↔ cos x < 0 by
    simp_rw [H]
    rw [neg_div]
    ring_nf
    field_simp
    rw [div_lt_iff₀]
    ring_nf
    simp_rw [<-neg_div, <-mul_div_assoc, mul_one, <-div_mul_eq_mul_div]
    ring_nf
    simp
    assumption

  intro x h0 h2
  -- It is enough to show that $\cos(x)$ is negative in the interval $(\frac\pi 2, \frac{3\pi}2)$.
  suffices h3 : x ∈ Ioo (Real.pi / 2) (3 * Real.pi / 2) ↔ cos x < 0 by
    simpa using h3

  -- It is enough to show that $\cos(x)$ is negative in the interval $(\frac\pi 2, \frac{3\pi}2)$.
  suffices h4 : x ∈ Ioo (Real.pi / 2) (3 * Real.pi / 2) ↔ (Real.pi + x) ∈ Ioo (3 * Real.pi / 2) (5 * Real.pi / 2) by
    simp_rw [Icc] at h4 ⊢
    ring_nf at h4 ⊢
    exact h4

  -- Evidently, $x\in(\frac\pi 2, \frac{3\pi}2)$ iff $x+\pi\in(\frac{3\pi}2, \frac{5\pi}2)$.
  suffices h5 : x ∈ Ioo (Real.pi / 2) (3 * Real.pi / 2) ↔ x + Real.pi ∈ Ioo (3 * Real.pi / 2) (5 * Real.pi / 2) by
    convert h5 using 1
    · rintro ⟨hx1, hx2⟩
      constructor
      · linarith
      · linarith
    · rintro ⟨hx1, hx2⟩
      constructor
      · linarith
      · linarith

  -- Evidently, $x\in(\frac\pi 2, \frac{3\pi}2)$ iff $3x\in(\frac32\pi, \frac92\pi)$.
  suffices h6 : x ∈ Ioo (Real.pi / 2) (3 * Real.pi / 2) ↔ 3 * x ∈ Ioo (3 * Real.pi / 2) (9 * Real.pi / 2) by
    convert h6 using 1
    · rintro ⟨hx1, hx2⟩
      constructor
      · linarith
      · linarith
    · rintro ⟨hx1, hx2⟩
      constructor
      · linarith
      · linarith

  -- It is enough to show that $\cos(3x)$ is negative in the interval $(\frac32\pi, \frac92\pi)$.
  suffices h7 : ∀ x :