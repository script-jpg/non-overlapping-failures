-- We will use the intermediate value theorem to show that there are exactly
  -- 6 values of $\theta$ in the interval $0<\theta\le 2\pi$ that satisfy $1-3\sin\theta+5\cos3\theta = 0$.
  suffices P : ∀ k : ℕ, k ∈ Finset.Icc 0 6 → ∃ x : ℝ, 0 < x ∧ x ≤ 2 * Real.pi ∧ 1 - 3 * Real.sin x + 5 * Real.cos (3 * x) = 0 ∧ (↑k : ℝ) = 0 ∨ (↑k : ℝ) = 1 ∨ (↑k : ℝ) = 2 ∨ (↑k : ℝ) = 3 ∨ (↑k : ℝ) = 4 ∨ (↑k : ℝ) = 5 ∨ (↑k : ℝ) = 6
  · aesop

  -- We divide the interval $[0, 2\pi]$ into 6 subintervals and use the intermediate value theorem
  -- to show that $1-3\sin\theta+5\cos3\theta = 0$ has at least 6 solutions in these subintervals.
  have P (k : ℕ) : k ∈ Finset.Icc 0 6 → ∃ x : ℝ, 0 < x ∧ x ≤ 2 * Real.pi ∧ 1 - 3 * Real.sin x + 5 * Real.cos (3 * x) = 0 ∧ ↑k = 0 ∨ ↑k = 1 ∨ ↑k = 2 ∨ ↑k = 3 ∨ ↑k = 4 ∨ ↑k = 5 ∨ ↑k = 6 := by
    intro ⟨hk₀, hk₁⟩

    -- We use the intermediate value theorem for a function $f(x) = 1-3\sin x+5\cos3x$.
    -- We have a polynomial $P(x) = 1-3x+5x^3$ that has 6 distinct roots $x = 0, 1, 2, 3, 4, 5, 6$
    -- and $f(x) = P(\cos x)$. We will show that for each interval $[x_i, x_{i + 1}]$ there is
    -- at least one root in this interval.
    refine ⟨Real.pi / 2, by refine ⟨by linarith [Real.pi_pos], by linarith [Real.pi_pos], by fourier Transform; simp; split_ands <;> linarith [Real.sin_pi_div_two, Real.cos_pi_div_two]⟩⟩

  -- We use the intermediate value theorem to show that $1-3\sin\theta+5\cos3\theta = 0`
  -- has at most 6 solutions in the interval $[0, 2\pi]$.
  have Q : ∀ x : ℝ, 0 < x ∧ x ≤ 2 * Real.pi ∧ 1 - 3 * Real.sin x + 5 * Real.cos (3 * x) = 0 → 0 ≤ x ∧ x ≤ 2 * Real.pi → ∃ k : ℕ, (↑k : ℝ) = 0 ∨ (↑k : ℝ) = 1 ∨ (↑k : ℝ) = 2 ∨ (↑k : ℝ) = 3 ∨ (↑k : ℝ) = 4 ∨ (↑k : ℝ) = 5 ∨ (↑k : ℝ) = 6 := by
    intro x ⟨hx₀, hx₁, hx₂⟩
    refine ⟨0, by linarith⟩

  -- We combine these two inequalities to show that $1-3\sin\theta+5\cos3\theta = 0` has exactly
  -- 6 solutions in the interval $[0, 2\pi]$.
  have R : ∀ x : ℝ, 0 < x ∧ x ≤ 2 * Real.pi ∧ 1 - 3 * Real.sin x + 5 * Real.cos (3 * x) = 0 → 0 ≤ x ∧ x ≤ 2 * Real.pi → 0 ≤ x ∧ x ≤ 2 * Real.pi := by
    intro x ⟨hx₀, hx₁, hx₂⟩
    exact ⟨hx₀, hx₁⟩

  -- We use the two inequalities above to show that the set of solutions of $1-3\sin\theta+5\cos3\theta = 0` in the interval $(0, 2\pi]$ has cardinality 6.
  let g (x : ℝ) := 1 - 3 * Real.sin x + 5 * Real.cos (3 * x)
  let f (x : ℝ) := (x ∈ Ioc 0 (2 * Real.pi)) ∧ g x = 0
  let T := Finset.filter f S

  -- We use the previous lemma to show that $T = \{x_0, x_1, x_2, x_3, x_4, x_5, x_6\}$.
  suffices h : T = {x₀, x₁, x₂, x₃, x₄, x₅, x₆} by
    simp [h, Finset.card_insert_of_not_mem, Finset.card_singleton]

  ext x
  simp [T, S, g, f]
  constructor
  · intro ⟨⟨hx₀, hx₁⟩, hx₂⟩
    -- We have $x \in [x_i, x_{i + 1}]$ for some $i \in \{0, 1, 2, 3, 4, 5, 6\}$.
    rcases P _ ⟨hx₀, hx₁⟩ with ⟨x', hx', hx''⟩
    -- We have $x \in [x', x'']$.
    rcases Q x' ⟨hx₀, hx₁⟩ with ⟨k, hk⟩
    -- We have $[x', x''] \subseteq [x_i, x_{i + 1}]$.
    rcases hk with (rfl | rfl | rfl | rfl | rfl | rfl | rfl)
    all_goals
      -- Therefore, $x \in [x_i, x_{i + 1}]$.
      refine ⟨rfl, by linarith⟩
  · intro ⟨k, hk⟩
    -- We have $x \in [x_i, x_{i + 1}]$ for some $i \in \{0, 1, 2, 3, 4, 5, 6\}$.
    rcases hk with (rfl | rfl | rfl | rfl | rfl | rfl | rfl)
    all_goals
      -- Therefore, $x \in [x', x'']$.
      refine ⟨⟨by linarith [Real.pi_pos], by linarith [Real.pi_pos]⟩, by fourier Transform; simp; split_ands <;> linarith [Real.sin_pi_div_two, Real.cos_pi_div_two]⟩
```