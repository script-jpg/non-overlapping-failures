-- We will use the intermediate value theorem to show that there are exactly
  -- 6 solutions to the equation.
  suffices P : ∀ d : ℕ, 0 < d → d < 6 → (∀ θ : ℝ, 0 < θ ∧ θ ≤ 2 * Real.pi ∧
    (1 - 3 * Real.sin θ + 5 * Real.cos (3 * θ) = 0) → θ = d * Real.pi / 3) ∧
    (∃ θ : ℝ, 0 < θ ∧ θ ≤ 2 * Real.pi ∧ (1 - 3 * Real.sin θ + 5 * Real.cos (3 * θ) = 0) ∧
      θ ≠ d * Real.pi / 3) by
    -- It suffices to prove that the set is actually $\{\pi/3, 2\pi/3, 3\pi/3, 4\pi/3, 5\pi/3, 6\pi/3\}$.
    replace P : S = {Real.pi / 3, Real.pi / 3 + Real.pi, Real.pi / 3 + 2 * Real.pi,
        Real.pi / 3 + 3 * Real.pi, Real.pi / 3 + 4 * Real.pi, Real.pi / 3 + 5 * Real.pi} := by
      ext x
      constructor
      · intro hx
        simp [← Finset.mem_insert, ← Finset.mem_singleton] at hx
        rcases hx with ⟨i, hi⟩
        fin_cases i
        · -- $\left(\frac{1}{3}, \frac{2}{3}\right)$
          left
          ext
          · -- $\frac{\pi}{3} > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\frac{\pi}{3} \leq 2\pi \land 1 - 3\sin\left(\frac{\pi}{3}\right) + 5\cos\left(3 \cdot \frac{\pi}{3}\right) = 0$
            simp
            ring_nf
            rw [Real.sin_pi_div_three, Real.cos_pi]
            norm_num
        · -- $\left(\frac{2}{3}, \frac{3}{3}\right)$
          right
          left
          ext
          · -- $\frac{2\pi}{3} > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\frac{2\pi}{3} \leq 2\pi \land 1 - 3\sin\left(\frac{2\pi}{3}\right) + 5\cos\left(3 \cdot \frac{2\pi}{3}\right) = 0$
            simp
            ring_nf
            rw [Real.sin_pi_sub, Real.cos_two_mul, ← Real.cos_pi_div_three]
            norm_num
        · -- $\left(\frac{3}{3}, \frac{4}{3}\right)$
          right
          right
          left
          ext
          · -- $\pi > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\pi \leq 2\pi \land 1 - 3\sin(\pi) + 5\cos(3\pi) = 0$
            simp
            norm_num
        · -- $\left(\frac{4}{3}, \frac{5}{3}\right)$
          right
          right
          right
          left
          ext
          · -- $\frac{4\pi}{3} > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\frac{4\pi}{3} \leq 2\pi \land 1 - 3\sin\left(\frac{4\pi}{3}\right) + 5\cos\left(3 \cdot \frac{4\pi}{3}\right) = 0$
            simp
            ring_nf
            rw [Real.sin_sub, Real.cos_two_mul, Real.cos_pi_div_three, show 2 * (2 * Real.pi / 3) = Real.pi + Real.pi / 3 by ring, Real.cos_add, Real.cos_pi, Real.sin_pi, pow_two, Real.sin_pi_div_three, Real.cos_pi]
            norm_num
        · -- $\left(\frac{5}{3}, \frac{6}{3}\right)$
          right
          right
          right
          right
          left
          ext
          · -- $\frac{5\pi}{3} > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\frac{5\pi}{3} \leq 2\pi \land 1 - 3\sin\left(\frac{5\pi}{3}\right) + 5\cos\left(3 \cdot \frac{5\pi}{3}\right) = 0$
            simp
            ring_nf
            rw [Real.sin_sub, Real.cos_two_mul, show 3 * (5 * Real.pi / 3) = 4 * Real.pi + Real.pi / 3 by ring, Real.cos_add, Real.cos_four_mul, Real.sin_four_mul, Real.cos_pi_div_three, Real.sin_pi_div_three]
            norm_num
        · -- The interval $\left(\frac{6}{3}, 2\pi\right]$
          right
          right
          right
          right
          right
          ext
          · -- $2\pi > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $2\pi \leq 2\pi \land 1 - 3\sin(2\pi) + 5\cos(3 \cdot 2\pi) = 0$
            simp
            norm_num
      · -- Show that $\{\pi/3, 2\pi/3, 3\pi/3, 4\pi/3, 5\pi/3, 6\pi/3\} \subseteq S$.
        intro hx
        simp [← Finset.mem_insert, ← Finset.mem_singleton]
        rcases hx with (rfl | rfl | rfl | rfl | rfl | rfl)
        · -- $\frac{\pi}{3} \in S$
          apply h₀
          ext
          · -- $\frac{\pi}{3} > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\frac{\pi}{3} \leq 2\pi \land 1 - 3\sin\left(\frac{\pi}{3}\right) + 5\cos\left(3 \cdot \frac{\pi}{3}\right) = 0$
            simp
            ring_nf
            rw [Real.sin_pi_div_three, Real.cos_pi]
            norm_num
        · -- $\frac{2\pi}{3} \in S$
          apply h₀
          ext
          · -- $\frac{2\pi}{3} > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\frac{2\pi}{3} \leq 2\pi \land 1 - 3\sin\left(\frac{2\pi}{3}\right) + 5\cos\left(3 \cdot \frac{2\pi}{3}\right) = 0$
            simp
            ring_nf
            rw [Real.sin_pi_sub, Real.cos_two_mul, ← Real.cos_pi_div_three]
            norm_num
        · -- $\pi \in S$
          apply h₀
          ext
          · -- $\pi > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\pi \leq 2\pi \land 1 - 3\sin(\pi) + 5\cos(3\pi) = 0$
            simp
            norm_num
        · -- $\frac{4\pi}{3} \in S$
          apply h₀
          ext
          · -- $\frac{4\pi}{3} > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\frac{4\pi}{3} \leq 2\pi \land 1 - 3\sin\left(\frac{4\pi}{3}\right) + 5\cos\left(3 \cdot \frac{4\pi}{3}\right) = 0$
            simp
            ring_nf
            rw [Real.sin_sub, Real.cos_two_mul, Real.cos_pi_div_three, show 2 * (2 * Real.pi / 3) = Real.pi + Real.pi / 3 by ring, Real.cos_add, Real.cos_pi, Real.sin_pi, pow_two, Real.sin_pi_div_three, Real.cos_pi]
            norm_num
        · -- $\frac{5\pi}{3} \in S$
          apply h₀
          ext
          · -- $\frac{5\pi}{3} > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $\frac{5\pi}{3} \leq 2\pi \land 1 - 3\sin\left(\frac{5\pi}{3}\right) + 5\cos\left(3 \cdot \frac{5\pi}{3}\right) = 0$
            simp
            ring_nf
            rw [Real.sin_sub, Real.cos_two_mul, show 3 * (5 * Real.pi / 3) = 4 * Real.pi + Real.pi / 3 by ring, Real.cos_add, Real.cos_four_mul, Real.sin_four_mul, Real.cos_pi_div_three, Real.sin_pi_div_three]
            norm_num
        · -- $2\pi \in S$
          apply h₀
          ext
          · -- $2\pi > 0$
            exact lt_trans (by linarith [Real.pi_pos]) (by linarith)
          · -- $2\pi \leq 2\pi \land 1 - 3\sin(2\pi) + 5\cos(3 \cdot 2\pi) = 0$
            simp
            norm_num

    -- We need to prove that for all natural numbers $d$, if $0 < d < 6$, then
    -- every $\theta$ in the interval $0 < \theta \leq 2\pi$ that satisfies
    -- $1 - 3\sin\theta + 5\cos3\theta = 0$ must be equal to $\frac{d\pi}{3}$
    -- and there exists a $\theta$ in the interval $0 < \theta \leq 2\pi$ that satisfies
    -- $1 - 3\sin\theta + 5\cos3\theta = 0$ but is not equal to $\frac{d\pi}{3}$.
    -- This is enough to show that the set is exactly
    -- $\{\frac{\pi}{3}, \frac{2\pi}{3}, \pi, \frac{4\pi}{3}, \frac{5\pi}{3}, 2\pi\}$.
    replace P : ∀ d : ℕ, 0 < d → d < 6 → ((∃ θ : ℝ, 0 < θ ∧ θ ≤ 2 * Real.pi ∧
        (1 - 3 * Real.sin θ + 5 * Real.cos (3 * θ) = 0) ∧
        θ ≠ d * Real.pi / 3) ∧
       (∀ θ : ℝ, 0 < θ ∧ θ ≤ 2 * Real.pi ∧ (1 - 3 * Real.sin θ + 5 * Real.cos (3 * θ) = 0) →
        θ = d * Real.pi / 3)) := by
      intro d hd₁ hd₂
      -- Show that the equation is solvable in the interval
      -- $(3d\pi/3 - \pi/2, 3d\pi/3 + \pi/2)$.
      have (h : 3 * d ≠ 0) : ∃ θ : ℝ, θ ∈ Set.Ioo (3 * d * Real.pi / 3 - Real.pi / 2) (3 * d * Real.pi / 3 + Real.pi / 2) ∧ Real.cos θ = Real.sin (Real.pi / 2 - θ) := by
        -- Change of variables to simplify the equation.
        let f (x : ℝ) := x - Real.pi / 4 - Real.arcsin (Real.sin (x - Real.pi / 4))
        let g (x : ℝ) := x - Real.pi / 4 + Real.arcsin (Real.sin (x - Real.pi / 4))
        have f_mono : StrictMonoOn f (Set.Ioo (Real.pi / 2 - Real.pi / 2) (3 * Real.pi / 2 - Real.pi / 2)) := by
          intro x hx y hy hxy
          simp at hx hy
          simp [f]
          -- Show that $x \mapto x - \pi/4 - \arcsin(\sin(x - \pi/4))$ is strictly monotone on $(0, \pi)$.
          apply sub_lt_sub
          apply sub_lt_sub
          apply Real.arcsin_lt_arcsin
          apply Real.sin_lt_sin_of_lt_of_le_pi_div_two
          linarith
          linarith
          linarith
          -- $\sin(x - \pi / 4)$ is positive when $x \in (\pi / 2, 3\pi / 2)$.
          apply Real.sin_pos_of_pos_of_lt_pi
          linarith
          linarith
          apply lt_trans
          apply sub_lt_sub_left
          apply Real.arcsin_lt_pi_div_two
          rw [show Real.pi / 2 - Real.pi / 4 = Real.pi / 4 by ring]
          apply Real.arcsin_lt_pi_div_two
          simp
          linarith
        have g_mono : StrictMonoOn g (Set.Ioo (3 * Real.pi / 2 - Real.pi / 2) (5 * Real.pi / 2 - Real.pi / 2)) := by
          intro x hx y hy hxy
          simp at hx hy
          simp [g]
          -- Show that $x \mapto x - \pi/4 + \arcsin(\sin(x - \pi/4))$ is strictly monotone on $(\pi, 2\pi)$.
          apply sub_lt_sub
          apply sub_lt_sub
          apply Real.arcsin_lt_arcsin
          apply Real.sin_lt_sin_of_lt_of_le_pi_div_two
          linarith
          linarith
          linarith
          -- $\sin(x - \pi / 4)$ is positive when $x \in (\pi / 2, 3\pi / 2)$.
          apply Real.sin_pos_of_pos_of_lt_pi
          linarith
          linarith
          apply lt_trans
          apply sub_lt_sub_left
          apply Real.arcsin_lt_pi_div_two
          simp
          linarith
        -- By the intermediate value theorem, the equation $\cos(\theta) = \sin(\pi/2 - \theta)$ has a solution in the interval $(3d\pi/3 - \pi/2, 3d\pi/3 + \pi/2)$.
        have hf : f (3 * d * Real.pi / 3 - Real.pi / 2) < 0 := by
          simp [f]
          rw [show 3 * d * Real.pi / 3 - Real.pi / 2 = (3 * d - 1) * (Real.pi / 2) by ring]
          nth_rw 2 [show 3 * d - 1 = 3 * d - 1 - 1 + 1 by norm_num]
          rw [← mul_add]
          nth_rw 2 [← mul_one (Real.pi / 2)]
          -- $\arcsin(\sin(x - \pi/4)) = x - \pi/4$ when $x \in (\pi/2, 3\pi/2)$.
          have h₀ := Real.arcsin_sin_sub_pi_div_two (by linarith) (by linarith)
          rw [show (3 * d - 1 - 1 + 1) * (Real.pi / 2) - Real.pi / 4 = (3 * d - 2) * (Real.pi / 4) by ring]
          rw [show (3 * d - 2) * (Real.pi / 4) - Real.pi / 4 = (3 * d - 3) * (Real.pi / 4) by ring]
          rw [show 3 * d - 3 = 3 * (d - 1) by ring]
          rw [show (3 * (d - 1)) * (Real.pi / 4) = 3 * (Real.pi / 4) * (d - 1) by ring]
          -- We have $\pi/2 < \pi$.
          apply Real.arcsin_lt_arcsin
          apply Real.sin_lt_sin_of_lt_of_le_pi_div_two
          linarith
          linarith
          -- $3\pi/4 < \pi/2 + \pi/4$.
          nth_rw 2 [← Real.arcsin_sin_sub_pi_div_two (by linarith) (by linarith)]
          rw [show Real.pi / 2 - Real.pi / 4 = Real.pi / 4 by ring]
          -- Simplify the equation.
          rw [show (3 * (d - 1) + 1) * (Real.pi / 4) - Real.pi / 4 = (3 * (d - 1)) * (Real.pi / 4) by ring]
          rw [show 3 * (d - 1) * (Real.pi / 4) + (Real.pi / 4 - Real.pi / 4) = 3 * (d - 1) * (Real.pi / 4) by ring]
          apply lt_of_le_of_lt
          apply mul_le_mul_of_nonneg_left
          norm_num
          -- $d \neq 0 \Rightarrow d > 0$.
          omega
          -- $\pi > 0$.
          exact Real.pi_pos
        have hg