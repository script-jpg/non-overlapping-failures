-- We prove that for any two integers $x$ and $y$, $x^5 \ne y^2 + 4$.
  -- Use proof by contradiction
  by_contra h
  -- Rewrite the equation in terms of modular arithmetic
  rw [← ZMod.intCast_eq_intCast_iff (by rw [← zero_add 4, add_zero, Int.modEq_iff_dvd]; exact Int.dvd_sub (pow_two y) (pow_five x)), Nat.cast_sub (pow_two y) (pow_five x)] at h
  simp [ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd] at h
  -- Factorize $x^5 - y^2 - 4$ as $(x - 2) * (x^2 + 2*x + 4) - y^2$
  rw [show x ^ 5 - (y ^ 2 + 4) = (x - 2) * (x ^ 2 + 2 * x + 4) - y ^ 2 by ring] at h
  -- Prove that neither $x - 2$ nor $x^2 + 2*x + 4$ is divisible by $11$
  have h1 : ¬(11 : ZMod) ∣ x - 2 := by
    -- Use proof by contradiction
    by_contra hx
    -- For any $x$, $x - 2$ is either divisible by $11$ or it is not
    rw [show (11 : ZMod) = (11 : ℤ) by rfl, dvd_iff_exists_eq_mul_right] at hx
    -- If $x - 2$ is divisible by $11$, then $x \equiv 2 \pmod{11}$
    rcases hx with ⟨k, hk⟩
    rw [ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd] at hk
    -- If $x \equiv 2 \pmod{11}$, then $x^5 \equiv 2^5 \equiv 32 \equiv 10 \pmod{11}$
    have h2 : (x ^ 5 : ZMod) = 10 := by
      rw [show (10 : ZMod) = (10 : ℤ) by rfl, ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd]
      use k * 11
      rw [pow_succ, pow_succ, pow_succ, pow_succ, pow_one]
      rw [Int.ModEq.eq_1]
      exact Int.modEq_of_dvd hk
    -- If $x \equiv 2 \pmod{11}$, then $x^5 - (y^2 + 4) \equiv 10 - (y^2 + 4) \equiv 6 - y^2 \pmod{11}$
    rw [show (x ^ 5 - (y ^ 2 + 4) : ZMod) = (x ^ 5 - y ^ 2 - 4 : ℤ) by rfl, h2, Int.modEq_iff_dvd] at h
    -- Prove that $6 - y^2$ is not divisible by $11$
    have h3 : ¬(11 : ℤ) ∣ 6 - y ^ 2 := by
      -- Use proof by contradiction
      by_contra hy
      -- For any $y$, $y^2$ is either divisible by $11$ or it is not
      rw [show (11 : ℤ) = (11 : ℕ) by rfl, dvd_iff_exists_eq_mul_right] at hy
      -- If $y^2$ is divisible by $11$, then $y$ is divisible by $11$
      rcases hy with ⟨c, hc⟩
      rw [Int.reducePow] at hc
      -- If $y$ is divisible by $11$, then $y^2 \equiv 0 \pmod{11}$
      have h4 : y ^ 2 % 11 = 0 := by
        rw [pow_two, Nat.mul_mod]
        rw [hc]
        norm_num
      -- Then $6 - y^2 \equiv 6 \pmod{11}$
      have h5 : (6 - y ^ 2) % 11 = 6 := by
        rw [Nat.sub_mod, h4]
        norm_num
      -- $6$ is not divisible by $11$
      rw [Int.dvd_iff_emod_eq_zero, Int.reducePow] at h3
      rw [h5] at h3
      norm_num at h3
    -- If $x - 2$ is not divisible by $11$, then we consider the polynomial $x^2 + 2*x + 4$
    -- If $x^2 + 2*x + 4$ is divisible by $11$, then $x^2 + 2*x + 4 \equiv 0 \pmod{11}$
    have h2 : ¬(11 : ZMod) ∣ x ^ 2 + 2 * x + 4 := by
      -- Use proof by contradiction
      by_contra hx
      -- For any $x$, $x^2 + 2*x + 4$ is either divisible by $11$ or it is not
      rw [show (11 : ZMod) = (11 : ℤ) by rfl, dvd_iff_exists_eq_mul_right] at hx
      -- If $x^2 + 2*x + 4$ is divisible by $11$, then $x \not\equiv 2 \pmod{11}$, but we have already shown that $x \equiv 2 \pmod{11}$
      rcases hx with ⟨c, hc⟩
      -- If $x^2 + 2*x + 4$ is divisible by $11$, then $x^5 - (y^2 + 4) = (x - 2) * (x^2 + 2*x + 4) - y^2 \equiv 0 - y^2 \equiv -y^2 \pmod{11}$
      rw [show (x ^ 5 - (y ^ 2 + 4) : ZMod) = (x ^ 5 - y ^ 2 - 4 : ℤ) by rfl, h] at hc
      rw [Int.modEq_iff_dvd] at hc
      -- We have already shown that $x \equiv 2 \pmod{11}$
      have h3 : 11 ∣ x - 2 := by
        -- If $x^2 + 2*x + 4$ is divisible by $11$, then $x \not\equiv 2 \pmod{11}$, which is a contradiction
        have h3 : (x - 2) * (x ^ 2 + 2 * x + 4) % 11 = 0 := by
          rw [← Int.dvd_iff_emod_eq_zero, Int.reducePow]
          rw [hc]
          norm_num
        -- If $11$ divides $(x - 2) * (x^2 + 2*x + 4)$, then $11$ divides $x - 2$ or $11$ divides $x^2 + 2*x + 4$
        have h4 := (Int.dvd_mul (x ^ 2 + 2 * x + 4) (x - 2)).mp h3
        -- If $11$ divides $x - 2$, then $x \equiv 2 \pmod{11}$
        rcases h4 with ⟨d, hd⟩
        rw [show (11 : ℤ) = (11 : ℕ) by rfl, dvd_iff_exists_eq_mul_right] at h4
        rcases h4 with ⟨d, hd⟩
        rw [ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd] at hd
        exact hd
      -- But we have already shown that $x \not\equiv 2 \pmod{11}$
      have h4 : ¬(11 : ℤ) ∣ x - 2 := by
        -- If $x - 2$ is divisible by $11$, then $x \equiv 2 \pmod{11}$
        by_contra hx
        rw [show (11 : ℤ) = (11 : ℕ) by rfl, dvd_iff_exists_eq_mul_right] at hx
        rcases hx with ⟨k, hk⟩
        rw [ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd] at hk
        exact hk
      -- A contradiction is reached
      contradiction
    -- Consider the cases when $x - 2$ is not divisible by $11$ or $x^2 + 2*x + 4$ is not divisible by $11$
    by_cases h3 : ¬(11 : ZMod) ∣ x - 2
    -- In this case, we have already shown that $x^5 - (y^2 + 4) \equiv 10 - (y^2 + 4) \equiv 6 - y^2 \pmod{11}$
    -- and $6 - y^2$ is not divisible by $11$, which is a contradiction
    · have h4 : (x - 2) * (x ^ 2 + 2 * x + 4) % 11 = 0 := by
        -- If $x - 2$ is not divisible by $11$, then $x \not\equiv 2 \pmod{11}$
        rw [Int.modEq_iff_dvd]
        simp [h3]
      -- If $x - 2$ is not divisible by $11$, then $x \not\equiv 2 \pmod{11}$
      -- and $x^5 - (y^2 + 4) \equiv 0 - (y^2 + 4) \equiv -y^2 - 4 \pmod{11}$
      rw [show (x ^ 5 - (y ^ 2 + 4) : ZMod) = (x ^ 5 - y ^ 2 - 4 : ℤ) by rfl, h] at h4
      rw [Int.modEq_iff_dvd] at h4
      -- Prove that $-y^2 - 4$ is not divisible by $11$
      have h5 : ¬(11 : ℤ) ∣ 4 + -y ^ 2 := by
        -- Use proof by contradiction
        by_contra hy
        -- For any $y$, $y^2$ is either divisible by $11$ or it is not
        rw [show (11 : ℤ) = (11 : ℕ) by rfl, dvd_iff_exists_eq_mul_right] at hy
        -- If $y^2$ is divisible by $11$, then $y$ is divisible by $11$
        rcases hy with ⟨c, hc⟩
        rw [Int.reducePow] at hc
        -- If $y$ is divisible by $11$, then $y^2 \equiv 0 \pmod{11}$
        have h6 : y ^ 2 % 11 = 0 := by
          rw [pow_two, Nat.mul_mod]
          rw [hc]
          norm_num
        -- Then $4 + (-y^2) \equiv 4 \pmod{11}$
        have h7 : (4 + -y ^ 2) % 11 = 4 := by
          rw [Nat.add_mod, h6]
          norm_num
        -- $4$ is not divisible by $11$
        rw [Int.dvd_iff_emod_eq_zero, Int.reducePow] at h5
        rw [h7] at h5
        norm_num at h5
      -- If $x - 2$ is not divisible by $11$, then $x^2 + 2*x + 4$ must be divisible by $11$
      -- but $x^2 + 2*x + 4 \equiv 0 \pmod{11}$ implies that $x \equiv -1 \pm 2*sqrt(3) \pmod{11}$
      -- which is impossible since $11 \equiv 3 \pmod{4}$
      have h4 : (x ^ 2 + 2 * x + 4) % 11 = 0 := by
        -- If $x^2 + 2*x + 4$ is not divisible by $11$, then $x \not\equiv -1 \pm 2*sqrt(3) \pmod{11}$
        -- and $x^5 - (y^2 + 4) \equiv (-4) - (y^2 + 4) \equiv -y^2 - 8 \pmod{11}$
        rw [show (x ^ 2 + 2 * x + 4 : ZMod) = (x ^ 2 + 2 * x + 4 : ℤ) by rfl, Int.modEq_iff_dvd] at h4
        simp [h4]
      -- but $x \equiv -1 \pm 2*sqrt(3) \pmod{11}$ is impossible since $11 \equiv 3 \pmod{4}$
      have h5 : ¬(11 : ZMod) ∣ x ^ 2 + 2 * x + 4 := by
        -- If $x^2 + 2*x + 4$ is divisible by $11$, then $x \equiv -1 \pm 2*sqrt(3) \pmod{11}$
        by_contra hx
        rw [show (11 : ZMod) = (11 : ℤ) by rfl, dvd_iff_exists_eq_mul_right] at hx
        rcases hx with ⟨c, hc⟩
        rw [ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd] at hc
        have h6 : (∃ b : ℤ, x = b) := by
          -- For any $x$, $x$ is either equal to $-1 + 2*sqrt(3)$ or it is not
          by_cases h7 : ∃ (b : ℤ), x = b
          · tauto
          · push_neg at h7
            -- If $x \not\equiv -1 + 2*sqrt(3) \pmod{11}$, then $x^2 + 2*x + 4 \not\equiv 0 \pmod{11}$
            have h6 : (x ^ 2 + 2 * x + 4) % 11 ≠ 0 := by
              -- We have already shown that $x^2 + 2*x + 4 \equiv 0 \pmod{11}$
              -- and $x \not\equiv -1 + 2*sqrt(3) \pmod{11}$
              rw [Int.modEq_iff_dvd]
              simp [h4]
            -- A contradiction is reached
            tauto
        rcases h6 with ⟨b, hb⟩
        rw [hb] at h3
        -- If $x = b$, then $b \equiv 2 \pmod{11}$
        rw [show (11 : ℤ) = (11 : ℕ) by rfl, dvd_iff_exists_eq_mul_right] at h3
        rcases h3 with ⟨k, hk⟩
        rw [ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd] at hk
        -- If $b \equiv 2 \pmod{11}$, then $b^5 \equiv 2^5 \equiv 32 \equiv 10 \pmod{11}$
        have h7 : (b ^ 5 : ZMod) = 10 := by
          rw [show (10 : ZMod) = (10 : ℤ) by rfl, ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd]
          use k * 11
          rw [pow_succ, pow_succ, pow_succ, pow_succ, pow_one]
          rw [Int.ModEq.eq_1]
          exact Int.modEq_of_dvd hk
        -- But we have already shown that $b^5 \equiv -4 \pmod{11}$
        -- $-4 \equiv 7 \pmod{11}$, which is a contradiction
        have h8 : (b ^ 5 : ZMod) = 7 := by
          rw [show (7 : ZMod) = (7 : ℤ) by rfl, ZMod.intCast_eq_intCast_iff, Int.modEq_iff_dvd]
          use (k * 11 + 2)
          rw [pow_succ, pow_succ, pow_succ, pow_succ, pow_one]
          rw [Int.ModEq.eq_1]
          exact Int.modEq_of_dvd h4
        -- $10 \equiv 7 \pmod{11}$ is false
        rw [h7, h8] at h4
        tauto
      -- A contradiction is reached
      contradiction
    -- If $x^2 + 2*x + 4$ is not divisible by $11$, then $x \not\equiv -1 \pm 2*sqrt(3) \pmod{11}$
    -- and $x^5 - (y^2 + 4) \equiv (-4) - (y^2 + 4) \equiv -y^2 - 8 \pmod{11}$
    have h3 : (x ^ 2 + 2 * x + 4) * (x - 2) % 11 = 0 := by
      -- If $x^2 + 2*x + 4$ is not divisible by $11$, then $x \not\equiv -1 \pm 2*sqrt(3) \pmod{11}$
      rw [Int.modEq_iff_dvd]
      simp [h2]
    -- If $x^2 + 2*x + 4$ is not divisible by $11$, then $x \not\equiv -1 \pm 2*sqrt(3) \pmod{11}$
    -- and $x^5 - (y^2 + 4