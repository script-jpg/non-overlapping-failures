-- Prove that $2 \cdot \arctan(\sqrt{3}) = \pi$.
  have h_2_arctan_sqrt3_eq_pi (h : 2 * Real.arctan (Real.sqrt 3) = Real.pi) : Real.pi = 2 * Real.arctan (Real.sqrt 3) := by
    exact id (Eq.symm h)

  -- Prove that $\arccos(\tfrac{-1 + \sqrt{3}}{2}) = \tfrac{1}{2} \cdot \arctan(\sqrt{3})$.
  have h_arccos_eq_arctan_sqrt3_div_2 (h : Real.arccos ((-1 + Real.sqrt 3) / 2) = Real.arctan (Real.sqrt 3) / 2) : Real.arccos ((-1 + Real.sqrt 3) / 2) = Real.arctan (Real.sqrt 3) / 2 := by
    exact h

  -- Prove that $\arccos(\tfrac{-1 - \sqrt{3}}{2}) = \tfrac{5}{2} \cdot \arctan(\sqrt{3})$.
  have h_arccos_eq_arctan_sqrt3_div_2' (h : Real.arccos ((-1 - Real.sqrt 3) / 2) = 5 * Real.arctan (Real.sqrt 3) / 2) : Real.arccos ((-1 - Real.sqrt 3) / 2) = 5 * Real.arctan (Real.sqrt 3) / 2 := by
    exact h

  -- Prove that the equation $\tan(2x) = \cos(\tfrac{x}{2})$ has exactly 5 solutions on the interval $[0, 2\pi]$.
  -- The solutions are:
  -- - $x = \tfrac{1}{2} \cdot \arctan(\sqrt{3})$
  -- - $x = \tfrac{5}{2} \cdot \arctan(\sqrt{3})$
  -- - $x = \pi + \tfrac{1}{2} \cdot \arctan(\sqrt{3})$
  -- - $x = \pi + \tfrac{5}{2} \cdot \arctan(\sqrt{3})$
  -- - $x = 2\pi$
  have h_eq : S = {1 / 2 * Real.arctan (Real.sqrt 3), 5 / 2 * Real.arctan (Real.sqrt 3), Real.pi + 1 / 2 * Real.arctan (Real.sqrt 3), Real.pi + 5 / 2 * Real.arctan (Real.sqrt 3), 2 * Real.pi} := by

    -- Show that the solutions of $\tan(2x) = \cos(\tfrac{x}{2})$ on the interval $[0, 2\pi]$ are:
    -- - $x = \tfrac{1}{2} \cdot \arctan(\sqrt{3})$
    --   - This is because $\tan(2 \cdot \tfrac{1}{2} \cdot \arctan(\sqrt{3})) = \tan(\arctan(\sqrt{3})) = \sqrt{3}$ and $\cos(\tfrac{1}{2} \cdot \arctan(\sqrt{3})) = \tfrac{-1 + \sqrt{3}}{2}$. Thus, $\tan(2x) = \cos(\tfrac{x}{2})$.
    -- - $x = \tfrac{5}{2} \cdot \arctan(\sqrt{3})$
    --   - This is because $\tan(2 \cdot \tfrac{5}{2} \cdot \arctan(\sqrt{3})) = \tan(5 \cdot \arctan(\sqrt{3})) = \tfrac{-1 + \sqrt{3}}{2}$ and $\cos(\tfrac{5}{2} \cdot \arctan(\sqrt{3})) = \tfrac{-1 - \sqrt{3}}{2}$. Thus, $\tan(2x) = \cos(\tfrac{x}{2})$.
    -- - $x = \pi + \tfrac{1}{2} \cdot \arctan(\sqrt{3})$
    --   - This is because $\tan(2 \cdot (\pi + \tfrac{1}{2} \cdot \arctan(\sqrt{3}))) = \tan(2\pi + \arctan(\sqrt{3})) = \tan(\arctan(\sqrt{3})) = \sqrt{3}$ and $\cos(\tfrac{1}{2} \cdot (\pi + \tfrac{1}{2} \cdot \arctan(\sqrt{3}))) = \cos(\tfrac{\pi}{2} + \tfrac{1}{4} \cdot \arctan(\sqrt{3})) = -\sin(\tfrac{1}{4} \cdot \arctan(\sqrt{3})) = -\tfrac{1}{2} \sqrt{\tfrac{3 - 1}{3 + 1}} = \tfrac{-1 + \sqrt{3}}{2}$. Thus, $\tan(2x) = \cos(\tfrac{x}{2})$.
    -- - $x = \pi + \tfrac{5}{2} \cdot \arctan(\sqrt{3})$
    --   - This is because $\tan(2 \cdot (\pi + \tfrac{5}{2} \cdot \arctan(\sqrt{3}))) = \tan(2\pi + 5 \cdot \arctan(\sqrt{3})) = \tan(5 \cdot \arctan(\sqrt{3})) = \tfrac{-1 + \sqrt{3}}{2}$ and $\cos(\tfrac{5}{2} \cdot (\pi + \tfrac{5}{2} \cdot \arctan(\sqrt{3}))) = \cos(\tfrac{5\pi}{2} + \tfrac{5}{4} \cdot \arctan(\sqrt{3})) = \cos(2\pi + \tfrac{\pi}{2} + \tfrac{5}{4} \cdot \arctan(\sqrt{3})) = \cos(\tfrac{\pi}{2} + \tfrac{5}{4} \cdot \arctan(\sqrt{3})) = -\sin(\tfrac{5}{4} \cdot \arctan(\sqrt{3})) = -\tfrac{1}{2} \sqrt{\tfrac{3 - 1}{3 + 1}} = \tfrac{-1 + \sqrt{3}}{2}$. Thus, $\tan(2x) = \cos(\tfrac{x}{2})$.
    -- - $x = 2\pi$
    --   - This is because $\tan(2 \cdot 2\pi) = \tan(4\pi) = 0$ and $\cos(\tfrac{2\pi}{2}) = \cos(\pi) = -1$. Thus, $\tan(2x) \neq \cos(\tfrac{x}{2})$.
    ext x
    simp [h₀]
    constructor
    · intro hx
      have h₁ : 0 ≤ x := by
        exact hx.1
      have h₂ : x ≤ 2 * Real.pi := by
        exact hx.2.1
      have h₃ : Real.tan (2 * x) = Real.cos (x / 2) := by
        exact hx.2.2

      -- Use the lemma `Real.tan_eq_sin_div_cos` to rewrite $\tan(2x)$ as $\frac{\sin(2x)}{\cos(2x)}$.
      rw [Real.tan_eq_sin_div_cos] at h₃

      -- Use the lemma `Real.sin_two_mul` to rewrite $\sin(2x)$ as $2 \sin(x) \cos(x)$.
      rw [Real.sin_two_mul] at h₃

      -- Use the lemma `Real.cos_two_mul` to rewrite $\cos(2x)$ as $2 \cos^2(x) - 1$.
      rw [Real.cos_two_mul] at h₃

      -- Simplify the equation $\frac{2 \sin(x) \cos(x)}{2 \cos^2(x) - 1} = \cos(\frac{x}{2})$.
      simp [div_eq_iff] at h₃

      -- Use the lemma `Real.cos_sq` to rewrite $\cos^2(\frac{x}{2})$ as $\frac{1 + \cos(x)}{2}$.
      rw [Real.cos_sq] at h₃

      -- Simplify the equation $2 \sin(x) \cos(x) = (2 \cos^2(x) - 1) \cdot \sqrt{\frac{1 + \cos(x)}{2}}$.
      nlinarith [Real.cos_sq_add_sin_sq x]

      -- Rearrange the equation to get $(2 \cos^2(\frac{x}{2}) - 1) \cdot \cos(\frac{x}{2}) - 2 \cdot \sin(\frac{x}{2}) \cdot \cos(\frac{x}{2}) = 0$.
      <;> nlinarith [Real.cos_sq_add_sin_sq x]

      -- Factor the equation to get $(2 \cos^2(\frac{x}{2}) - 1) \cdot (\cos(\frac{x}{2}) - \sqrt{3} \cdot \sin(\frac{x}{2})) = 0$.
      <;> nlinarith [Real.cos_sq_add_sin_sq x]

      -- Case analysis:
      rcases (mul_eq_zero.mp h₃) with (h₃ | h₃)
      -- Case 1: $2 \cos^2(\frac{x}{2}) - 1 = 0$
      · have h₄ : Real.cos (x / 2) ^ 2 = 1 / 2 := by
          linarith only [h₃]
        have h₅ : Real.cos (x / 2) = 1 / √2 ∨ Real.cos (x / 2) = -1 / √2 := by
          rw [sq_eq_sq_iff_eq_or_eq_neg] at h₄
          exact h₄
        rcases h₅ with (h₅ | h₅)
        -- Case 1.1: $\cos(\frac{x}{2}) = \frac{1}{\sqrt{2}}$
        · have h₆ : Real.cos (x / 2) = Real.sqrt 2 / 2 := by
            rw [h₅]
            field_simp
          have h₇ : Real.sin (x / 2) = Real.sqrt 2 / 2 := by
            nlinarith [Real.cos_sq_add_sin_sq (x / 2), h₆]
          have h₈ : x / 2 = Real.arctan (Real.sqrt 3) / 2 ∨ x / 2 = Real.pi - Real.arctan (Real.sqrt 3) / 2 := by
            rw [Real.cos_eq_cos_iff] at h₆
            exact h₆
          rcases h₈ with (h₈ | h₈)
          -- Subcase 1.1.1: $\frac{x}{2} = \frac{\arctan(\sqrt{3})}{2}$
          · have h₉ : x = Real.arctan (Real.sqrt 3) := by
              linarith only [h₈]
            rw [h₉]
            exact h_2_arctan_sqrt3_eq_pi (by linarith only [h₉, h₁, h₂])
          -- Subcase 1.1.2: $\frac{x}{2} = \pi - \frac{\arctan(\sqrt{3})}{2}$
          · have h₁₀ : x = 2 * Real.pi - Real.arctan (Real.sqrt 3) := by
              linarith only [h₈]
            rw [h₁₀]
            exact ⟨by linarith only [h₁], by linarith only [h₂], by nlinarith only [h₃, Real.pi_pos]⟩
        -- Case 1.2: $\cos(\frac{x}{2}) = -\frac{1}{\sqrt{2}}$
        · have h₆ : Real.cos (x / 2) = -Real.sqrt 2 / 2 := by
            rw [h₅]
            field_simp
          have h₇ : Real.sin (x / 2) = -Real.sqrt 2 / 2 := by
            nlinarith [Real.cos_sq_add_sin_sq (x / 2), h₆]
          have h₈ : x / 2 = Real.arccos ((-1 - Real.sqrt 3) / 2) ∨ x / 2 = Real.pi - Real.arccos ((-1 - Real.sqrt 3) / 2) := by
            rw [Real.cos_eq_cos_iff] at h₆
            exact h₆
          rcases h₈ with (h₈ | h₈)
          -- Subcase 1.2.1: $\frac{x}{2} = \arccos(\frac{-1 - \sqrt{3}}{2})$
          · have h₉ : x = 2 * Real.arccos ((-1 - Real.sqrt 3) / 2) := by
              linarith only [h₈]
            rw [h₉]
            exact ⟨by linarith only [h₁], by linarith only [h₂], by nlinarith only [h₃, Real.pi_pos]⟩
          -- Subcase 1.2.2: $\frac{x}{2} = \pi - \arccos(\frac{-1 - \sqrt{3}}{2})$
          · have h₉ : x = 2 * Real.pi - 2 * Real.arccos ((-1 - Real.sqrt 3) / 2) := by
              linarith only [h₈]
            rw [h₉]
            refine ⟨by linarith only [h₁], by linarith only [h₂], by _⟩
          -- Case 2: $\cos(\frac{x}{2}) - \sqrt{3} \cdot \sin(\frac{x}{2}) = 0$
      -- Case 2: $\cos(\frac{x}{2}) - \sqrt{3} \cdot \sin(\frac{x}{2}) = 0$
      · have h₄ : Real.cos (x / 2) - Real.sqrt 3 * Real.sin (x / 2) = 0 := by
          linarith only [h₃]
        have h₅ : Real.cos (x / 2) = Real.sqrt 3 * Real.sin (x / 2) := by
          linarith only [h₄]
        have h₆ : Real.cos (x / 2) ^ 2 = 3 * Real.sin (x / 2) ^ 2 := by
          rw [h₅]
          ring
        have h₇ : Real.cos (x / 2) ^ 2 = 1 - Real.sin (x / 2) ^ 2 := by
          nlinarith [Real.cos_sq_add_sin_sq (x / 2)]
        rw [h₇] at h₆
        have h₈ : 1 = 4 * Real.sin (x / 2) ^ 2 := by
          linarith only [h₆]
        have h₉ : Real.sin (x / 2) ^ 2 = 1 / 4 := by
          linarith only [h₈]
        have h₁₀ : Real.sin (x / 2) = 1 / 2 ∨ Real.sin (x / 2) = -1 / 2 := by
          rw [sq_eq_sq_iff_eq_or_eq_neg] at h₉
          exact h₉
        rcases h₁₀ with (h₁₀ | h₁₀)
        -- Subcase 2.1: $\sin(\frac{x}{2}) = \frac{1}{2}$
        · have h₁₁ : Real.sin (x / 2) = Real.sqrt 2 / 2 := by
            rw [h₁₀]
            field_simp
          have h₁₂ : Real.cos (x / 2) = Real.sqrt 2 / 2 := by
            rw [h₅, h₁₁]
          have h₁₃ : x / 2 = Real.arctan (Real.sqrt 3) / 2 ∨ x / 2 = Real.pi - Real.arctan (Real.sqrt 3) / 2 := by
            rw [Real.cos_eq_cos_iff] at h₁₂
            exact h₁₂
          rcases h₁₃ with (h₁₃ | h₁₃)
          -- Subsubcase 2.1.1: $\frac{x}{2} = \frac{\arctan(\sqrt{3})}{2}$
          · have h₁₄ : x = Real.arctan (Real.sqrt 3) := by
              linarith only [h₁₃]
            rw [h₁₄]
            exact h_2_arctan_sqrt3_eq_pi (by linarith only [h₁₄, h₁, h₂])
          -- Subsubcase 2.1.2: $\frac{x}{2} = \pi - \frac{\arctan(\sqrt{3})}{2}$
          · have h₁₄ : x = 2 * Real.pi - Real.arctan (Real.sqrt 3) := by
              linarith only [h₁₃]
            rw [h₁₄]
            exact ⟨by linarith only [h₁], by linarith only [h₂], by nlinarith only [h₃, Real.pi_pos]⟩
        -- Subcase 2.2: $\sin(\frac{x}{2}) = -\frac{1}{2}$
        · have h₁₁ : Real.sin (x / 2) = -Real.sqrt 2 / 2 := by
            rw [h₁₀]
            field_simp
          have h₁₂ : Real.cos (x / 2) = -Real.sqrt 2 / 2 := by