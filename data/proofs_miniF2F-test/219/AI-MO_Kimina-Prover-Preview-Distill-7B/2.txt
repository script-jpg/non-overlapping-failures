-- set $p = 5$
  set p : ℕ := 5 with hp

  -- obviously, $p$ is a prime number
  have hp_prime : p.Prime := by norm_num

  -- set $f(n) = \sum_{k=0}^{n} \binom{2n+1}{2k+1} 2^{3k}$
  let f : ℕ → ℕ := fun n => ∑ k in Finset.range (n + 1), Nat.choose (2 * n + 1) (2 * k + 1) * 2 ^ (3 * k)

  -- some properties about $f(n)$
  -- $f(0) = 1$
  have hf0 : f 0 = 1 := by
    simp [f]

  -- $f(1) = 11$
  have hf1 : f 1 = 11 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(2) = 231$
  have hf2 : f 2 = 231 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(3) = 5461$
  have hf3 : f 3 = 5461 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(4) = 269211$
  have hf4 : f 4 = 269211 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(5) = 1318611$
  have hf5 : f 5 = 1318611 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(6) = 62561501$
  have hf6 : f 6 = 62561501 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(7) = 3069065371$
  have hf7 : f 7 = 3069065371 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(8) = 1511198454111$
  have hf8 : f 8 = 1511198454111 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(9) = 73551075103981$
  have hf9 : f 9 = 73551075103981 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(10) = 3606608435881311$
  have hf10 : f 10 = 3606608435881311 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(11) = 176408279994986111$
  have hf11 : f 11 = 176408279994986111 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(12) = 8528897845240786101$
  have hf12 : f 12 = 8528897845240786101 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(13) = 416702669704021000811$
  have hf13 : f 13 = 416702669704021000811 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(14) = 204959604366714124494211$
  have hf14 : f 14 = 204959604366714124494211 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(15) = 100290138305474862456335211$
  have hf15 : f 15 = 100290138305474862456335211 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(16) = 49110717003402908830142487011$
  have hf16 : f 16 = 49110717003402908830142487011 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(17) = 24028292729080406508478887498211$
  have hf17 : f 17 = 24028292729080406508478887498211 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(18) = 1162284842827903584624582983903811$
  have hf18 : f 18 = 1162284842827903584624582983903811 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(19) = 560289834827390472987621614800178211$
  have hf19 : f 19 = 560289834827390472987621614800178211 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- $f(20) = 27102324477383242486209460907437046611$
  have hf20 : f 20 = 27102324477383242486209460907437046611 := by
    simp [f, Finset.sum_range_succ, Nat.choose]

  -- lemma 1 : $\binom{2n+1}{2k+1} \equiv (-1)^k \binom{2n-k}{k} \pmod{5}$
  have lem1 (n k : ℕ) : Nat.choose (2 * n + 1) (2 * k + 1) ≡ (-1) ^ k * Nat.choose (n - k) k [MOD p] := by
    -- set $x = 2 * n - 2 * k$
    set x : ℕ := 2 * n - 2 * k with hx

    -- we have
    -- $\binom{2n+1}{2k+1} = \binom{x + 2k + 1}{2k + 1}$
    have h1 : Nat.choose (2 * n + 1) (2 * k + 1) = Nat.choose (x + 2 * k + 1) (2 * k + 1) := by
      rw [show 2 * n + 1 = x + 2 * k + 1 by omega]

    -- $\binom{x + 2k + 1}{2k + 1} = \binom{x + 2k + 1}{x}$
    have h2 : Nat.choose (x + 2 * k + 1) (2 * k + 1) = Nat.choose (x + 2 * k + 1) x := by
      rw [Nat.choose_symm]

    -- $\binom{x + 2k + 1}{x} = \binom{2n - k}{k}$
    have h3 : Nat.choose (x + 2 * k + 1) x = Nat.choose (2 * n - k) k := by
      have : x + 2 * k + 1 = 2 * n - k + 2 * k + 1 := by omega
      rw [this]
      have : 2 * n - k + 2 * k + 1 = 2 * n + k + 1 := by omega
      rw [this]
      have : 2 * n + k + 1 = 2 * n + 1 + k := by omega
      rw [this]
      exact Nat.choose_add_right_eq (2 * n + 1) k

    -- $\binom{2n-k}{k} \equiv (-1)^k \binom{2n-k}{k} \pmod{5}$
    have h4 : Nat.choose (2 * n - k) k ≡ (-1) ^ k * Nat.choose (2 * n - k) k [MOD p] := by
      apply Nat.ModEq.mul_left
      apply Nat.ModEq.pow_right
      native_decide -- decide $5 \equiv 0 \pmod{5}$

    -- transitivity
    rw [h1, h2, h3]
    apply Nat.ModEq.trans h4
    apply Nat.ModEq.trans (Nat.ModEq.pow_right k (by apply Nat.Prime.modEq_iff; exact hp_prime))
    rw [←Nat.ModEq]
    native_decide -- decide $(-1)^k \cdot \binom{2n-k}{k} \equiv (-1)^k \cdot \binom{2n-k}{k} \pmod{5}$
  -- end of lemma 1

  -- lemma 2: $\binom{2n+1}{2k} \equiv (-1)^k \binom{2n-2k+1}{k} \binom{2n-2k+1}{k} \pmod{5}$
  have lem2 (n k : ℕ) : Nat.choose (2 * n + 1) (2 * k) ≡ (-1) ^ k * Nat.choose (2 * n - 2 * k + 1) k * Nat.choose (2 * n - 2 * k + 1) k [MOD p] := by
    -- set $x = 2n - 2k$
    set x : ℕ := 2 * n - 2 * k with hx

    -- we have
    -- $\binom{2n+1}{2k} = \binom{x + 2k + 1}{2k}$
    have h1 : Nat.choose (2 * n + 1) (2 * k) = Nat.choose (x + 2 * k + 1) (2 * k) := by
      rw [show 2 * n + 1 = x + 2 * k + 1 by omega]

    -- $\binom{x + 2k + 1}{2k} = \binom{x + 2k + 1}{x + k + 1}$
    have h2 : Nat.choose (x + 2 * k + 1) (2 * k) = Nat.choose (x + 2 * k + 1) (x + k + 1) := by
      rw [Nat.choose_eq_choose_pred_add]
      rw [show x + 2 * k + 1 - 2 * k = x + k + 1 by omega]

    -- $\binom{x + 2k + 1}{x + k + 1} = \binom{x + k + 1 + k + 1}{x + k + 1}$
    have h3 : Nat.choose (x + 2 * k + 1) (x + k + 1) = Nat.choose (x + k + 1 + k + 1) (x + k + 1) := by
      congr
      rw [show x + 2 * k + 1 = x + k + 1 + k + 1 by omega]

    -- $\binom{x + k + 1 + k + 1}{x + k + 1} = \binom{2n-k+1}{k}$
    have h4 : Nat.choose (x + k + 1 + k + 1) (x + k + 1) = Nat.choose (2 * n - k + 1) k := by
      have : x + k + 1 + k + 1 = 2 * n - k + 1 + 2 * k + 1 := by omega
      rw [this]
      have : 2 * n - k + 1 + 2 * k + 1 = 2 * n + k + 1 := by omega
      rw [this]
      have : 2 * n + k + 1 = 2 * n + 1 + k := by omega
      rw [this]
      exact Nat.choose_add_right_eq (2 * n + 1) k

    -- $\binom{2n-2k+1}{k} \equiv (-1)^k \binom{2n-2k+1}{k} \pmod{5}$
    have h5 : Nat.choose (2 * n - 2 * k + 1) k ≡ (-1) ^ k * Nat.choose (2 * n - 2 * k + 1) k [MOD p] := by
      apply Nat.ModEq.mul_left
      apply Nat.ModEq.pow_right
      native_decide -- decide $5 \equiv 0 \pmod{5}$

    -- transitivity
    rw [h1, h2, h3, h4]
    apply Nat.ModEq.trans h5
    apply Nat.ModEq.trans (Nat.ModEq.pow_right k (by apply Nat.Prime.modEq_iff; exact hp_prime))
    rw [←Nat.ModEq]
    native_decide -- decide $(-1)^k \cdot \binom{2n-2k+1}{k} \equiv (-1)^k \cdot \binom{2n-2k+1}{k} \pmod{5}$
  -- end of lemma 2

  -- lemma 3: $\binom{2n+1}{2k-1} \equiv (-1)^k \binom{2n-2k+1}{k} \binom{2n-2k+1}{k} \pmod{5}$
  have lem3 (n k : ℕ) : Nat.choose (2 * n + 1) (2 * k - 1) ≡ (-1) ^ k * Nat.choose (2 * n - 2 * k + 1) k * Nat.choose (2 * n - 2 * k + 1) k [MOD p] := by
    -- set $x = 2n - 2k$
    set x : ℕ := 2 * n - 2 * k with hx

    -- we have
    -- $\binom{2n+1}{2k-1} = \binom{x + 2k + 1}{2k - 1}$
    have h1 : Nat.choose (2 * n + 1) (2 * k - 1) = Nat.choose (x + 2 * k + 1) (2 * k - 1) := by
      rw [show 2 * n + 1 = x + 2 * k + 1 by omega]

    -- $\binom{x + 2k + 1}{2k - 1} = \binom{x + 2k + 1}{x + k + 1}$
    have h2 : Nat.choose (x + 2 * k + 1) (2 * k - 1) = Nat.choose (x + 2 * k + 1) (x + k + 1) := by
      rw [Nat.choose_eq_choose_pred_add]
      rw [show x + 2 * k + 1 - (2 * k - 1) = x + k + 1 by omega]

    -- $\binom{x + 2k + 1}{x + k + 1} = \binom{x + k + 1 + k + 1}{x + k + 1}$
    have h3 : Nat.choose (x + 2 * k + 1) (x + k + 1) = Nat.choose (x + k + 1 + k + 1) (x + k + 1) := by
      congr
      rw [show x + 2 * k + 1 = x + k + 1 + k + 1 by omega]

    -- $\binom{x + k + 1 + k + 1}{x + k + 1} = \binom{2n-k+1}{k}$
    have h4 : Nat.choose (x + k + 1 + k + 1) (x + k + 1) = Nat.choose (2 * n - k + 1) k := by
      have : x + k + 1 + k + 1 = 2 * n - k + 1 + 2 * k + 1 := by omega
      rw [this]
      have : 2 * n - k + 1 + 2 * k + 1 = 2 * n + k +