-- set $A = \{x \mid |x-1| + |x| + |x+1| = x + 2\}$

  set A : Set ℝ := {x | abs (x - 1) + abs x + abs (x + 1) = x + 2}

  -- it is easy to check that $A \cap (-\infty, -1) = \varnothing$ and $A \cap [1, \infty) = \varnothing$

  have h₁ : A ∩ Set.Iio (-1) = ∅ := by

    ext x

    simp [A]

    intro h

    have hge1 : abs (x - 1) + abs x + abs (x + 1) ≥ 3 - x := by

      by_cases h₁ : x ≥ 1

      · -- if $x \geq 1$, then $|x-1| + |x| + |x+1| = (x-1) + x + (x+1) = 3x \geq 3 - x$

        rw [abs_of_nonneg (by linarith), abs_of_nonneg (by linarith), abs_of_nonneg (by linarith)]

        linarith

      · -- if $x < 1$, then consider $x \leq -1$ or $-1 < x < 1$

        by_cases h₂ : x ≤ -1

        · -- if $x \leq -1$, then $|x-1| + |x| + |x+1| = -(x-1) - x - (x+1) = -3x \geq 3 - x$ because $x \leq -1$

          rw [abs_of_nonpos (by linarith), abs_of_nonpos (by linarith), abs_of_nonpos (by linarith)]

          linarith

        · -- if $-1 < x < 1$, then consider $x \leq 0$ or $0 < x < 1$

          by_cases h₃ : x ≤ 0

          · -- if $-1 < x \leq 0$, then $|x-1| + |x| + |x+1| = -(x-1) + (-x) - (x+1) = -3x \geq 3 - x$ because $x \leq 0$

            rw [abs_of_nonpos (by linarith), abs_of_nonpos (by linarith), abs_of_nonneg (by linarith)]

            linarith

          · -- if $0 < x < 1$, then $|x-1| + |x| + |x+1| = -(x-1) + x - (x+1) = 1 - x \geq 3 - x$ because $0 < x < 1$

            rw [abs_of_nonpos (by linarith), abs_of_nonneg (by linarith), abs_of_nonneg (by linarith)]

            linarith

    have hlt1 : A ∩ Set.Iio (-1) = ∅ := by

      ext x

      simp [A]

      intro h

      linarith [hge1 x, h]

    exact hlt1

  have h₂ : A ∩ Set.Ici 1 = ∅ := by

    ext x

    simp [A]

    intro h

    have hge1 : abs (x - 1) + abs x + abs (x + 1) ≥ 3x - 1 := by

      by_cases h₁ : x ≥ 1

      · -- if $x \geq 1$, then $|x-1| + |x| + |x+1| = (x-1) + x + (x+1) = 3x \geq 3x - 1$

        rw [abs_of_nonneg (by linarith), abs_of_nonneg (by linarith), abs_of_nonneg (by linarith)]

        linarith

      · -- if $x < 1$, then consider $x \leq -1$ or $-1 < x < 1$

        by_cases h₂ : x ≤ -1

        · -- if $x \leq -1$, then $|x-1| + |x| + |x+1| = -(x-1) - x - (x+1) = -3x \geq 3x - 1$ because $x \leq -1$

          rw [abs_of_nonpos (by linarith), abs_of_nonpos (by linarith), abs_of_nonpos (by linarith)]

          linarith

        · -- if $-1 < x < 1$, then consider $x \leq 0$ or $0 < x < 1$

          by_cases h₃ : x ≤ 0

          · -- if $-1 < x \leq 0$, then $|x-1| + |x| + |x+1| = -(x-1) + (-x) - (x+1) = -3x \geq 3x - 1$ because $x \leq 0$

            rw [abs_of_nonpos (by linarith), abs_of_nonpos (by linarith), abs_of_nonneg (by linarith)]

            linarith

          · -- if $0 < x < 1$, then $|x-1| + |x| + |x+1| = -(x-1) + x - (x+1) = 1 - x \geq 3x - 1$ because $0 < x < 1$

            rw [abs_of_nonpos (by linarith), abs_of_nonneg (by linarith), abs_of_nonneg (by linarith)]

            linarith

    have hlt1 : A ∩ Set.Ici 1 = ∅ := by

      ext x

      simp [A]

      intro h

      linarith [hge1 x, h]

    exact hlt1

  -- thus $A \subseteq [-1, 1]$

  have h₃ : A ⊆ Set.Icc (-1) 1 := by

    exact Set.eq_union_of_disjoint_left.mpr ⟨h₁, h₂, Set.disjoint_Iio_Ici⟩

  -- show that $A \cap [-1, 1] = [-1, 1]$

  have h₄ : A ∩ Set.Icc (-1) 1 = Set.Icc (-1) 1 := by

    ext x

    simp [A]

    constructor

    · -- if $x \in A \cap [-1, 1]$, then $|x-1| + |x| + |x+1| = x + 2$

      intro h

      exact h

    · -- if $x \in [-1, 1]$, then $|x-1| + |x| + |x+1| = x + 2$

      intro h

      have hxge1 : x - 1 ≥ -2 := by linarith [h.1]

      have hxle1 : x - 1 ≤ 0 := by linarith [h.2]

      have hxge0 : x ≥ -1 := by linarith [h.1]

      have hxle2 : x ≤ 1 := by linarith [h.2]

      rw [abs_of_nonpos (by linarith), abs_of_nonpos (by linarith), abs_of_nonneg (by linarith)]

      linarith

  -- so $A = [-1, 1]$

  have h₅ : A = Set.Icc (-1) 1 := by

    exact Set.eq_of_subset_of_inter_eq_left h₃ h₄

  -- show that $0 \leq x \land x \leq 1 \Rightarrow |x-1| + |x| + |x+1| = x + 2$

  have h₆ : x ∈ A → 0 ≤ x ∧ x ≤ 1 := by

    intro h

    simp [A] at h

    have hxge1 : x - 1 ≥ -1 := by linarith [h.1]

    have hxle1 : x - 1 ≤ 0 := by linarith [h.2]

    have hxge0 : x ≥ 0 := by linarith [h.1]

    have hxle2 : x ≤ 1 := by linarith [h.2]

    by_cases h₁ : x ≤ 0

    · -- if $x \leq 0$, then $|x-1| + |x| + |x+1| = -(x-1) - x - (x+1) = -3x \geq x + 2$ because $x \leq -\frac{1}{2}$

      rw [abs_of_nonpos (by linarith), abs_of_nonpos (by linarith), abs_of_nonneg (by linarith)]

      linarith

    · -- if $0 < x \leq 1$, then $|x-1| + |x| + |x+1| = -(x-1) + x - (x+1) = 1 - x \geq x + 2$ because $0 \leq x \leq 1$

      rw [abs_of_nonpos (by linarith), abs_of_nonneg (by linarith), abs_of_nonneg (by linarith)]

      linarith

  -- the desired result follows from $A = [-1, 1]$ and the fact that $0 \leq x \land x \leq 1 \Rightarrow x \in A$

  intro h

  have hxi := h₅ ⟨h.1, h.2⟩

  exact h₆ hxi.1

```