have h₁ : x ≥ 0 := by

    by_cases h : x ≤ 0

    -- case 1 : x ≤ 0

   . -- Then $|x| = -x$.
      have : abs x = - x := by

        rw [abs_of_nonpos h]

        simp

      --case 1.1 : x + 1 ≤ 0

      by_cases h' : x + 1 ≤ 0

      -- Then $|x+1| = -(x+1)$.

     . have : abs (x + 1) = - (x + 1) := by

          rw [abs_of_nonpos h']

        --case 1.1.1 : x - 1 ≤ 0

        by_cases h'' : x - 1 ≤ 0

        -- Then $|x-1| = -(x-1)$.

       . have : abs (x - 1) = - (x - 1) := by

            rw [abs_of_nonpos h'']

          -- Now $|x-1| + |x| + |x+1| = -x-1 -x -x+1 = -3x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = - 3 * x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $-3x = x + 2$, so $-2 = 4x$, so $x = -0.5$.

          have:= Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          simp at this

          have : x = - 2 / (3 : ℝ) := by

            linarith

          -- But $-0.5 ≤ 0$ is true, so case 1.1.1 is possible.

          linarith

        -- case 1.1.2 : x - 1 > 0

       . have : abs (x - 1) =  x - 1 := by

            rw [abs_of_pos (not_le.mp h'')]

          -- Now $|x-1| + |x| + |x+1| = x-1 -x +x+1 = x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $x = x + 2$, so $2 = 0$.

          have := Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h this)

          linarith

      -- case 1.2 : x + 1 > 0

     . have : abs (x + 1) =  x + 1 := by

          rw [abs_of_pos (not_le.mp h')]

        --case 1.2.1 : x - 1 ≤ 0

        by_cases h'' : x - 1 ≤ 0

        -- Then $|x-1| = -(x-1)$.

       . have : abs (x - 1) = - (x - 1) := by

            rw [abs_of_nonpos h'']

          -- Now $|x-1| + |x| + |x+1| = -x-1 -x -x+1 = -3x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = - 3 * x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $-3x = x + 2$, so $-2 = 4x$, so $x = -0.5$.

          have:= Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          simp at this

          have : x = - 2 / (3 : ℝ) := by

            linarith

          -- But $-0.5 ≤ 0$ is true, so case 1.2.1 is possible.

          linarith

        -- case 1.2.2 : x - 1 > 0

       . have : abs (x - 1) =  x - 1 := by

            rw [abs_of_pos (not_le.mp h'')]

          -- Now $|x-1| + |x| + |x+1| = x-1 -x +x+1 = x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $x = x + 2$, so $2 = 0$.

          have := Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h' h'' this)

          linarith

    -- case 2 : x > 0

   . have : abs x =  x := by

        rw [abs_of_pos (not_le.mp h)]

      by_cases h' : x + 1 ≤ 0

      --case 2.1 : x + 1 ≤ 0

     . have : abs (x + 1) = -(x + 1) := by

          rw [abs_of_nonpos h']

        by_cases h'' : x - 1 ≤ 0

        --case 2.1.1 : x - 1 ≤ 0

       . have : abs (x - 1) = -(x - 1) := by

            rw [abs_of_nonpos h'']

          -- Now $|x-1| + |x| + |x+1| = -x-1 +x -x+1 = -x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = - x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $-x = x + 2$, so $-2 = 2x$, so $x = -1$.

          have:= Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          simp at this

          have : x = - (2 : ℝ) := by

            linarith

          -- But $-1 > 0$ is false, so case 2.1.1 is impossible.

          linarith

        --case 2.1.2 : x - 1 > 0

       . have : abs (x - 1) =  x - 1 := by

            rw [abs_of_pos (not_le.mp h'')]

          -- Now $|x-1| + |x| + |x+1| = x-1 +x -x+1 = x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $x = x + 2$, so $2 = 0$.

          have := Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h' h'' this)

          linarith

      --case 2.2 : x + 1 > 0

     . have : abs (x + 1) =  x + 1 := by

          rw [abs_of_pos (not_le.mp h')]

        by_cases h'' : x - 1 ≤ 0

        --case 2.2.1 : x - 1 ≤ 0

       . have : abs (x - 1) = -(x - 1) := by

            rw [abs_of_nonpos h'']

          -- Now $|x-1| + |x| + |x+1| = -x-1 +x -x+1 = -x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = - x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $-x = x + 2$, so $-2 = 2x$, so $x = -1$.

          have:= Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          simp at this

          have : x = - (2 : ℝ) := by

            linarith

          -- But $-1 > 0$ is false, so case 2.2.1 is impossible.

          linarith

        -- case 2.2.2 : x - 1 > 0

       . have : abs (x - 1) =  x - 1 := by

            rw [abs_of_pos (not_le.mp h'')]

          -- Now $|x-1| + |x| + |x+1| = x-1 +x -x+1 = x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $x = x + 2$, so $2 = 0$.

          have := Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h' h'' this)

          linarith

  have h₂ : x ≤ 1 := by

    by_cases h : x ≥ 1

    -- case 1 : x ≥ 1

   . -- Then $|x-1| = x-1$.
      have : abs (x - 1) =  x - 1 := by

        rw [abs_of_pos (not_le.mp h)]

      --case 1.1 : x + 1 ≥ 0

      by_cases h' : x + 1 ≥ 0

      -- Then $|x+1| = x+1$.

     . have : abs (x + 1) =  x + 1 := by

          rw [abs_of_nonneg h']

        --case 1.1.1 : x ≥ 0

        by_cases h'' : x ≥ 0

        -- Then $|x| = x$.

       . have : abs x = x := by

            rw [abs_of_nonneg (not_le.mp h)]

          -- Now $|x-1| + |x| + |x+1| = x-1 +x +x+1 = 3x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = 3 * x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $3x = x + 2$, so $x = 1$.

          have:= Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          simp at this

          have : x = (2 : ℝ)/ (3 : ℝ) := by

            linarith

          -- But $1 ≤ 1$ is true, so case 1.1.1 is possible.

          linarith

        -- case 1.1.2 : x < 0

       . have : abs x = - x := by

            rw [abs_of_nonpos (not_le.mp h'')]

          -- Now $|x-1| + |x| + |x+1| = x-1 -x +x+1 = x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $x = x + 2$, so $2 = 0$.

          have := Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          linarith

      -- case 1.2 : x + 1 < 0

     . have : abs (x + 1) = -(x + 1) := by

          rw [abs_of_neg (not_le.mp h')]

        --case 1.2.1 : x ≥ 0

        by_cases h'' : x ≥ 0

        -- Then $|x| = x$.

       . have : abs x = x := by

            rw [abs_of_nonneg (not_le.mp h)]

          -- Now $|x-1| + |x| + |x+1| = x-1 +x -(x+1) = x-2 ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = x - 2 := by

            rw [this, abs x, this]

            ring_nf

          -- Then $x-2 = x + 2$, so $4 = 0$.

          have := Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          linarith

        -- case 1.2.2 : x < 0

       . have : abs x = - x := by

            rw [abs_of_neg (not_le.mp h'')]

          -- Now $|x-1| + |x| + |x+1| = x-1 -x -(x+1) = -x-2 ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = - x - 2 := by

            rw [this, abs x, this]

            ring_nf

          -- Then $-x-2 = x + 2$, so $-2 = 2x$, so $x = -1$.

          have:= Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          simp at this

          have : x = - (2 : ℝ) := by

            linarith

          -- But $-1 ≥ 1$ is false, so case 1.2.2 is impossible.

          linarith

    -- case 2 : x < 1

   . have : abs (x - 1) = -(x - 1) := by

        rw [abs_of_neg (not_le.mp h)]

      by_cases h' : x + 1 ≥ 0

      --case 2.1 : x + 1 ≥ 0

     . have : abs (x + 1) =  x + 1 := by

          rw [abs_of_nonneg h']

        --case 2.1.1 : x ≥ 0

        by_cases h'' : x ≥ 0

        -- Then $|x| = x$.

       . have : abs x = x := by

            rw [abs_of_nonneg (not_le.mp h)]

          -- Now $|x-1| + |x| + |x+1| = -(x-1) +x +x+1 = x+2 ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = x + 2 := by

            rw [this, abs x, this]

            ring_nf

          -- The equation $x+2 = x+2$ is always true, so we cannot go further.

          -- In this case, we need to check whether $x ≥ 1$ is true.

          have : 1 ≤ x := by linarith

          linarith

        -- case 2.1.2 : x < 0

       . have : abs x = - x := by

            rw [abs_of_neg (not_le.mp h'')]

          -- Now $|x-1| + |x| + |x+1| = -(x-1) -x +x+1 = 2 ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = 2 := by

            rw [this, abs x, this]

            ring_nf

          -- Then $2 = x + 2$, so $x = 0$.

          have:= Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this)

          simp at this

          have : x = 0 := by

            linarith

          -- But $0 ≥ 1$ is false, so case 2.1.2 is impossible.

          linarith

      --case 2.2 : x + 1 < 0

     . have : abs (x + 1) = -(x + 1) := by

          rw [abs_of_neg (not_le.mp h')]

        --case 2.2.1 : x ≥ 0

        by_cases h'' : x ≥ 0

        -- Then $|x| = x$.

       . have : abs x = x := by

            rw [abs_of_nonneg (not_le.mp h)]

          -- Now $|x-1| + |x| + |x+1| = -(x-1) +x -(x+1) = -x ≥ 0$.

          have : abs (x - 1) + abs x + abs (x + 1) = - x := by

            rw [this, abs x, this]

            ring_nf

          -- Then $-x = x + 2$, so $-2 = 2x$, so $x = -1$.

          have:= Eq.symm (absxm1pabsxpabsxp1eqxp2 (x - 1) (x) (x + 1) h'' h' this