have h₁ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
    have h₁ : 2 ^ (n + 3) ∣ 3 ^ 2 ^ n - 1 := by
      -- Use the Lifting the Exponent (LTE) lemma to show that 2^{n+3} divides 3^{2^n} - 1
      have h₁ : 2 ∣ 3 := by norm_num
      have h₂ : 2 ∣ 3 ^ 2 ^ n - 1 := by
        -- Use the LTE lemma to show that 2 divides 3^{2^n} - 1
        apply Nat.dvd_of_mod_eq_zero
        have h₃ : 3 ^ 2 ^ n % 2 = 1 := by
          -- Since 3 ≡ 1 (mod 2), we have 3^k ≡ 1^k ≡ 1 (mod 2)
          rw [← Nat.mod_add_div (3 ^ 2 ^ n) 2]
          simp [Nat.pow_mod, Nat.pow_add, Nat.pow_mul, Nat.mul_mod, Nat.pow_mod]
        omega
      -- Use the LTE lemma to show that 2^{n+3} divides 3^{2^n} - 1
      have h₃ : 2 ^ (n + 3) ∣ 3 ^ 2 ^ n - 1 := by
        -- Use the LTE lemma to show that 2^{n+3} divides 3^{2^n} - 1
        have h₄ : 2 ^ (n + 3) ∣ 3 ^ 2 ^ n - 1 := by
          apply Lemma_1_aux
          <;> simp_all [Nat.pow_mod, Nat.pow_add, Nat.pow_mul, Nat.mul_mod, Nat.pow_mod]
          <;> omega
        exact h₄
      exact h₃
    -- Use the fact that 2^{n+3} divides 3^{2^n} - 1 to conclude the proof
    have h₂ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
      have h₃ : 2 ^ (n + 3) ∣ 3 ^ 2 ^ n - 1 := h₁
      have h₄ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
        -- Use the fact that 2^{n+3} divides 3^{2^n} - 1 to conclude the proof
        have h₅ : 3 ^ 2 ^ n % 2 ^ (n + 3) = 1 % 2 ^ (n + 3) := by
          have h₆ : 3 ^ 2 ^ n % 2 ^ (n + 3) = 1 % 2 ^ (n + 3) := by
            -- Use the LTE lemma to show that 3^{2^n} ≡ 1 (mod 2^{n+3})
            have h₇ : 3 ^ 2 ^ n % 2 ^ (n + 3) = 1 % 2 ^ (n + 3) := by
              apply Lemma_2_aux
              <;> simp_all [Nat.pow_mod, Nat.pow_add, Nat.pow_mul, Nat.mul_mod, Nat.pow_mod]
              <;> omega
            exact h₇
          exact h₆
        have h₆ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
          rw [← Nat.mod_add_div (3 ^ 2 ^ n) (2 ^ (n + 3))]
          simp [h₅, Nat.pow_mod, Nat.mul_mod, Nat.add_mod]
          <;> induction n <;> simp_all [pow_succ, Nat.mul_mod, Nat.add_mod, Nat.mod_eq_of_lt]
          <;> omega
        exact h₆
      exact h₄
    exact