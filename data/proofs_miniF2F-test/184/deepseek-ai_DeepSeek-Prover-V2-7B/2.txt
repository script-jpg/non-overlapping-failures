have h₁ : 3 ^ 2 ^ n ≡ 1 [MOD 2 ^ (n + 3)] := by
    have h₁ : 3 ^ 2 ^ n ≡ 1 [MOD 2 ^ (n + 3)] := by
      have h₁ : 3 % 2 ^ (n + 3) = 3 := by
        simp [Nat.mod_eq_of_lt]
        <;>
        induction n <;> simp_all [pow_succ, Nat.mul_mod] <;>
        omega
      have h₂ : 3 ^ 2 ^ n % 2 ^ (n + 3) = 1 % 2 ^ (n + 3) := by
        rw [← Nat.mod_add_div (3 ^ 2 ^ n) (2 ^ (n + 3))]
        simp [h₁, pow_mul, Nat.pow_mod, Nat.mul_mod, Nat.add_mod]
        <;>
        induction n <;> simp_all [pow_succ, Nat.mul_mod, Nat.pow_mod] <;>
        omega
      simpa [Nat.ModEq, Nat.ModEq] using h₂
    exact h₁
  have h₂ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
    have h₃ : 3 ^ 2 ^ n ≡ 1 [MOD 2 ^ (n + 3)] := by
      exact h₁
    have h₄ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
      rw [Nat.ModEq] at h₃
      have h₅ : 2 ^ (n + 2) < 2 ^ (n + 3) := by
        apply Nat.pow_lt_pow_of_lt_right
        norm_num
        omega
      have h₆ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
        rw [← Nat.mod_add_div (3 ^ 2 ^ n) (2 ^ (n + 3))]
        simp [h₃, Nat.add_sub_cancel, Nat.mod_eq_of_lt, h₅]
        <;>
        induction n <;> simp_all [pow_succ, Nat.mul_mod, Nat.pow_mod, Nat.add_mod] <;>
        omega
      exact h₆
    exact h₄
  
  exact h₂
```