have h₁ : 3 ^ 2 ^ n % 2 ^ (n + 3) = 3 ^ 2 ^ n % 2 ^ (n + 3) := rfl
  have h₂ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
    have h₃ : 3 ^ 2 ^ n % 2 ^ (n + 3) = 3 ^ 2 ^ n % 2 ^ (n + 3) := rfl
    have h₄ : 3 ^ 2 ^ n % 2 ^ (n + 3) = 1 + 2 ^ (n + 2) := by
      have h₅ : ∀ n : ℕ, 0 < n → 3 ^ 2 ^ n % 2 ^ (n + 3) = 1 + 2 ^ (n + 2) := by
        intro n hn
        induction' hn with n hn
        · norm_num
        · simp_all [pow_succ, pow_mul, Nat.mul_mod, Nat.pow_mod, Nat.add_mod]
          <;> omega
      exact h₅ n h₀
    have h₆ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
      rw [← Nat.mod_add_div (3 ^ 2 ^ n) (2 ^ (n + 3))]
      simp [h₄, Nat.add_mod, Nat.mul_mod, Nat.pow_mod, Nat.mod_eq_of_lt]
      <;> induction n <;> simp_all [pow_succ, pow_mul, Nat.mul_mod, Nat.pow_mod, Nat.add_mod]
      <;> omega
    exact h₆
  exact h₂