have h₁ : 2 ^ (n + 3) = 8 * 2 ^ n := by
    ring

  have h₂ : 2 ^ (n + 2) = 4 * 2 ^ n := by
    ring

  rw [h₁]
  cases n with
  | zero =>
    -- when n = 0, $3^{2^0} - 1 = 3 - 1 = 2$, and $2 \equiv 2 \mod 8$.
    simp
  | succ n =>
    -- when n >= 1, we have $3^{2^n} - 1 \equiv 2^{n+2} \mod 2^{n+3}$.
    -- so $3^{2^{n+1}} - 1 = (3^{2^n} - 1)^2 - 1 \equiv 2^{2(n+2)} - 1 \equiv 2^{n+3} \mod 2^{n+4}$.
    have h₃ : (3 ^ 2 ^ (n + 1) - 1) % 2 ^ (n + 4) = 2 ^ (n + 3) := by
      rw [show 2 ^ (n + 1) = 2 * 2 ^ n by ring]
      have h₄ : (3 ^ 2 ^ n - 1) % 2 ^ (n + 3) = 2 ^ (n + 2) := by
        exact Nat.ModEq.pow 2 (Nat.ModEq.symm (numbertheory_3pow2pownm1mod2pownp3eq2pownp2 n h₀))
      rw [Nat.sub_mod_eq_zero_iff_dvd] at h₄
      apply Nat.ModEq.pow 2
      refine (Nat.ModEq.trans?_ h₄).symm
      rw [show 2 ^ (n + 3) = 2 ^ n * 8 by ring, show 2 ^ (n + 2) = 2 ^ n * 4 by ring]
      rw [Nat.mul_mod_mul_left _ _ (by norm_num)]
      rw [Nat.mul_mod_mul_left _ _ (by norm_num)]
      rw [Nat.mul_mod_mul_left _ _ (by norm_num)]
      simp
    rw [show n + 1 + 3 = n + 4 by ring] at h₃
    exact h₃

```