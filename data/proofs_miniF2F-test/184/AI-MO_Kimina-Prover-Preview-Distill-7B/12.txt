have h₁ : 2 ^ (n + 3) = 8 * 2 ^ n := by
    ring

  have h₂ : 2 ^ (n + 2) = 4 * 2 ^ n := by
    ring

  have h₃ : 2 ^ n > 0 := by
    exact Nat.pos_of_ne_zero h₀

  have h₄ : 2 ^ n + 2 ^ n = 2 ^ (n + 1) := by
    rw [<-Nat.add_mul, <-Nat.pow_succ]
    congr
    omega

  -- Since $2^{n+2} = 4 \cdot 2^n$, and $2^n > 0$, it is enough to show that
  -- $4 \cdot (2^{2^n} - 1) \equiv 4 \cdot 2^{n+1} \mod 8 \cdot 2^n$.
  suffices 4 * (2 ^ 2 ^ n - 1) % (8 * 2 ^ n) = 4 * 2 ^ (n + 1) by
    rw [<-this, <-h₂]
    omega

  -- Which follows if $2^{2^n} - 1 \equiv 2^{n+1} \mod 2^{n+3}$.
  suffices 2 ^ 2 ^ n - 1 ≡ 2 ^ (n + 1) [MOD 2 ^ (n + 3)] by
    rw [<-this]
    simp [Nat.modEq_iff_dvd']
    omega

  -- We will show that $2^{2^n} - 1 \equiv 2^{n+1} \mod 2^{n+3}$.
  -- Notice that this is true for $n = 1$:
  -- $2^{2^1} - 1 = 2^{2^1} - 1 = 2^2 - 1 = 3 \equiv 2^2 - 1 \mod 2^3$.
  induction' n, h₀ using Nat.le_induction with n h₀ ih
 . rw [show 2 ^ 2 ^ 0 - 1 = 2 ^ 1 - 1 by norm_num]
    simp
  -- For the induction step, we will show that
  -- $2^{2^{n+1}} - 1 = (2^{2^n})^2 - 1 \equiv 2^{n+1} \mod 2^{n+3}$,
  -- and that $2^{2^n} \equiv 2 \mod 2^{n+1}$.
 . have h₅ : 2 ^ 2 ^ (n + 1) - 1 = (2 ^ 2 ^ n - 1) * (2 ^ 2 ^ n + 1) := by
      ring

    suffices 2 ^ 2 ^ n + 1 ≡ 2 ^ (n + 1) + 1 [MOD 2 ^ (n + 3)] by
      rw [h₅, <-this]
      apply Nat.ModEq.mul
      assumption
      assumption

    -- We have $2^{2^n} + 1 = (2^{n+1})^2 - 2^{n+1} + 1 + 2^{n+1} \equiv
    -- (2^{n+1})^2 - 2^{n+1} + 1 + 1 \mod 2^{n+3}$.
    suffices 2 ^ 2 ^ n + 1 ≡ 2 ^ (n + 1) + 1 + 2 ^ (n + 1) [MOD 2 ^ (n + 3)] by
      rw [<-this]
      apply Nat.ModEq.trans
      apply Nat.ModEq.add_right
      rw [Nat.add_assoc]
      apply Nat.ModEq.add_right
      apply Nat.ModEq.pow
      exact ih
      rfl

    rw [show 2 ^ 2 ^ n + 1 = (2 ^ 2 ^ n - 1) + 2 by omega]

    -- Hence, it is enough to show that $2^{2^n} - 1 \equiv 2^{n+1} - 1 \mod 2^{n+3}$.
    suffices 2 ^ 2 ^ n - 1 ≡ 2 ^ (n + 1) - 1 [MOD 2 ^ (n + 3)] by
      rw [<-this]
      apply Nat.ModEq.trans
      apply Nat.ModEq.trans
      assumption
      rw [show 2 ^ (n + 1) + 1 = 2 ^ (n + 1) - 1 + 2 by omega]
      apply Nat.ModEq.add_right
      apply Nat.ModEq.trans
      exact Nat.modEq_iff_dvd.mpr rfl
      omega

    -- We will show that $2^{2^n} \equiv 2 \mod 2^{n+1}$.
    have h₆ : 2 ^ 2 ^ n ≡ 2 ^ (n + 1) [MOD 2 ^ (n + 1)] := by
      rw [<-Nat.add_mul, <-Nat.pow_succ]
      congr
     . omega
     . apply Nat.ModEq.mul
       . exact Nat.modEq_iff_dvd.mpr rfl
       . exact ih

    -- Then, since $2^{n+1} = 2 \cdot 2^n$, we have
    -- $2^{2^{n+1}} - 1 = (2^{2^n})^2 - 1 \equiv 2^{n+1} \mod 2^{n+3}$.
    convert h₆ using 1
   . rw [Nat.add_sub_cancel]
      ring
   . rw [Nat.add_sub_cancel]
      ring

```