-- We define an auxiliary polynomial $P(x)$ with leading coefficient 1 and roots $x_1, x_2, x_3$.
  let P : ℝ → ℝ := fun x => (x - Real.cos (2 * Real.pi / 7)) * (x - Real.cos (4 * Real.pi / 7)) * (x - Real.cos (6 * Real.pi / 7))
  have hP : ∀ x, P x = (x - Real.cos (2 * Real.pi / 7)) * (x - Real.cos (4 * Real.pi / 7)) * (x - Real.cos (6 * Real.pi / 7)) := by
    intro x
    rfl

  -- $P(x)$ has degree 3 and is monic.
  have hPdeg : Monic P := by
    apply Monic.def.mpr
    rw [degree_eq_of_le_of_coeff_ne_zero]
    apply le_of_lt
    apply lt_of_le_of_lt (degree_mul (degree_mul (degree_X_sub_C?_ ) )?_)
    apply degree_X_sub_C
    simp only [Nat.ofNat_pos]
    refine ⟨⟨?_,?_,?_⟩,?_⟩
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · simp [P]
      apply degree_mul (degree_mul (degree_X_sub_C?_ ) )?_
      apply degree_X_sub_C
      simp only [Nat.ofNat_pos]

  -- $P(x)$ has exactly the roots $x_1, x_2, x_3$.
  have hProots : P.roots = {Real.cos (2 * Real.pi / 7), Real.cos (4 * Real.pi / 7), Real.cos (6 * Real.pi / 7)} := by
    simp [P]
    rw [h₁]
    ext x
    simp [h₀]
    constructor
    · intro h
      simp only [mem preimage, mem_singleton_iff] at h
      rcases h with (h | h | h)
      all_goals
        rw [h]
        simp
    · intro h
      simp only [mem_singleton_iff] at h
      rcases h with (rfl | rfl | rfl)
      all_goals
        rw [h₀]
        simp

  -- Now, we define the polynomial $Q(x) = (x - \cos \frac{2\pi}7)(x - \cos \frac{4\pi}7)(x - \cos \frac{6\pi}7)$
  let Q : ℝ → ℝ := fun x => (x - Real.cos (2 * Real.pi / 7)) * (x - Real.cos (4 * Real.pi / 7)) * (x - Real.cos (6 * Real.pi / 7))
  -- and let $q_1, q_2, q_3$ be its roots.
  have hQ : ∀ x, Q x = (x - Real.cos (2 * Real.pi / 7)) * (x - Real.cos (4 * Real.pi / 7)) * (x - Real.cos (6 * Real.pi / 7)) := by
    intro x
    rfl
  have hQdeg : Monic Q := by
    apply Monic.def.mpr
    rw [degree_eq_of_le_of_coeff_ne_zero]
    apply le_of_lt
    apply lt_of_le_of_lt (degree_mul (degree_mul (degree_X_sub_C?_ ) )?_)
    apply degree_X_sub_C
    simp only [Nat.ofNat_pos]
    refine ⟨⟨?_,?_,?_⟩,?_⟩
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · simp [Q]
      apply degree_mul (degree_mul (degree_X_sub_C?_ ) )?_
      apply degree_X_sub_C
      simp only [Nat.ofNat_pos]

  -- $Q(x)$ has exactly the roots $q_1, q_2, q_3$.
  have hQroots : Q.roots = {Real.cos (2 * Real.pi / 7), Real.cos (4 * Real.pi / 7), Real.cos (6 * Real.pi / 7)} := by
    simp [Q]
    rw [h₁]
    ext x
    simp [h₀]
    constructor
    · intro h
      simp only [mem preimage, mem_singleton_iff] at h
      rcases h with (h | h | h)
      all_goals
        rw [h]
        simp
    · intro h
      simp only [mem_singleton_iff] at h
      rcases h with (rfl | rfl | rfl)
      all_goals
        rw [h₀]
        simp

  -- We define the polynomial $R(x) = (x - p_1)(x - p_2)(x - p_3)$
  let R : ℝ → ℝ := fun x => (x - Real.cos (2 * Real.pi / 7)) * (x - Real.cos (4 * Real.pi / 7)) * (x - Real.cos (6 * Real.pi / 7))
  -- where $p_1, p_2, p_3$ are the roots of $P(x)$.
  have hR : ∀ x, R x = (x - Real.cos (2 * Real.pi / 7)) * (x - Real.cos (4 * Real.pi / 7)) * (x - Real.cos (6 * Real.pi / 7)) := by
    intro x
    rfl
  have hRdeg : Monic R := by
    apply Monic.def.mpr
    rw [degree_eq_of_le_of_coeff_ne_zero]
    apply le_of_lt
    apply lt_of_le_of_lt (degree_mul (degree_mul (degree_X_sub_C?_ ) )?_)
    apply degree_X_sub_C
    simp only [Nat.ofNat_pos]
    refine ⟨⟨?_,?_,?_⟩,?_⟩
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · apply degree_X_sub_C
      simp only [Nat.ofNat_pos]
    · simp [R]
      apply degree_mul (degree_mul (degree_X_sub_C?_ ) )?_
      apply degree_X_sub_C
      simp only [Nat.ofNat_pos]

  -- $R(x)$ has exactly the roots $r_1, r_2, r_3$.
  have hRroots : R.roots = {Real.cos (2 * Real.pi / 7), Real.cos (4 * Real.pi / 7), Real.cos (6 * Real.pi / 7)} := by
    simp [R]
    rw [h₁]
    ext x
    simp [h₀]
    constructor
    · intro h
      simp only [mem preimage, mem_singleton_iff] at h
      rcases h with (h | h | h)
      all_goals
        rw [h]
        simp
    · intro h
      simp only [mem_singleton_iff] at h
      rcases h with (rfl | rfl | rfl)
      all_goals
        rw [h₀]
        simp

  -- By the above, we see that $P(x) = Q(x) = R(x)$.
  have hPQR : P = Q ∧ Q = R := by
    apply And.intro
    · ext x
      rw [hP, hQ]
    · ext x
      rw [hQ, hR]

  -- $P(x)$ is a cubic polynomial, so it is of the form $x^3 + ax^2 + bx + c$ for some $a, b, c$.
  have hP_coeff : ∀ i ≤ 3, (P.coeff i) = (if i = 1 then a else if i = 2 then b else if i = 3 then c else 0) := by
    rw [hP, Cubic.strictMono]
    intro i
    interval_cases i
    · simp [h₀]
      simp [P]
      have : -Real.cos (2 * Real.pi / 7) - Real.cos (4 * Real.pi / 7) - Real.cos (6 * Real.pi / 7) = a := by
        apply congrArg
        simp [hP]
        rw [show 1 = 0 + 1 by simp, coeff_sum (by simp), mul_one,
          show 2 = 1 + 1 by simp, coeff_sum (by simp), coeff_X_one, coeff_C_zero, mul_zero]
        simp only [Nat.reduceAdd, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add]
        norm_cast
        rw [← mul_assoc, mul_add, ← mul_assoc, mul_add, mul_one, ← neg_mul, ← mul_neg]
        norm_num
      linarith
    · simp [h₀]
      simp [P]
      have : Real.cos (2 * Real.pi / 7) * Real.cos (4 * Real.pi / 7) + Real.cos (2 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) + Real.cos (4 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) = b := by
        apply congrArg
        simp [hP]
        rw [show 2 = 1 + 1 by simp, coeff_sum (by simp), coeff_one,
          coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul,
          show 3 = 1 + 2 by simp, coeff_sum (by simp), coeff_one, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul]
        norm_cast
        norm_num
      linarith
    · simp [h₀]
      simp [P]
      have : -Real.cos (2 * Real.pi / 7) * Real.cos (4 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) = c := by
        apply congrArg
        simp [hP]
        rw [show 3 = 1 + 2 by simp, coeff_sum (by simp), coeff_one, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul]
        norm_cast
        norm_num
      linarith
    · simp [h₀]
      simp [P]
      norm_num

  -- This means that $P(x) = x^3 + ax^2 + bx + c$ for all $x$.
  have hP3 : ∀ x, P x = x ^ 3 + a * x ^ 2 + b * x + c := by
    intro x
    rw [hP]
    simp [hP_coeff]

  -- $Q(x)$ is a cubic polynomial, so it is of the form $x^3 + ax^2 + bx + c$ for some $a, b, c$.
  have hQ_coeff : ∀ i ≤ 3, (Q.coeff i) = (if i = 1 then a else if i = 2 then b else if i = 3 then c else 0) := by
    rw [hQ, Cubic.strictMono]
    intro i
    interval_cases i
    · simp [h₀]
      simp [Q]
      have : -Real.cos (2 * Real.pi / 7) - Real.cos (4 * Real.pi / 7) - Real.cos (6 * Real.pi / 7) = a := by
        apply congrArg
        simp [hQ]
        rw [show 1 = 0 + 1 by simp, coeff_sum (by simp), mul_one,
          show 2 = 1 + 1 by simp, coeff_sum (by simp), coeff_X_one, coeff_C_zero, mul_zero]
        simp only [Nat.reduceAdd, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add]
        norm_cast
        rw [← mul_assoc, mul_add, ← mul_assoc, mul_add, mul_one, ← neg_mul, ← mul_neg]
        norm_num
      linarith
    · simp [h₀]
      simp [Q]
      have : Real.cos (2 * Real.pi / 7) * Real.cos (4 * Real.pi / 7) + Real.cos (2 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) + Real.cos (4 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) = b := by
        apply congrArg
        simp [hQ]
        rw [show 2 = 1 + 1 by simp, coeff_sum (by simp), coeff_one,
          coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul,
          show 3 = 1 + 2 by simp, coeff_sum (by simp), coeff_one, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul]
        norm_cast
        norm_num
      linarith
    · simp [h₀]
      simp [Q]
      have : -Real.cos (2 * Real.pi / 7) * Real.cos (4 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) = c := by
        apply congrArg
        simp [hQ]
        rw [show 3 = 1 + 2 by simp, coeff_sum (by simp), coeff_one, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul]
        norm_cast
        norm_num
      linarith
    · simp [h₀]
      simp [Q]
      norm_num

  -- This means that $Q(x) = x^3 + ax^2 + bx + c$ for all $x$.
  have hQ3 : ∀ x, Q x = x ^ 3 + a * x ^ 2 + b * x + c := by
    intro x
    rw [hQ]
    simp [hQ_coeff]

  -- $R(x)$ is a cubic polynomial, so it is of the form $x^3 + ax^2 + bx + c$ for some $a, b, c$.
  have hR_coeff : ∀ i ≤ 3, (R.coeff i) = (if i = 1 then a else if i = 2 then b else if i = 3 then c else 0) := by
    rw [hR, Cubic.strictMono]
    intro i
    interval_cases i
    · simp [h₀]
      simp [R]
      have : -Real.cos (2 * Real.pi / 7) - Real.cos (4 * Real.pi / 7) - Real.cos (6 * Real.pi / 7) = a := by
        apply congrArg
        simp [hR]
        rw [show 1 = 0 + 1 by simp, coeff_sum (by simp), mul_one,
          show 2 = 1 + 1 by simp, coeff_sum (by simp), coeff_X_one, coeff_C_zero, mul_zero]
        simp only [Nat.reduceAdd, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add]
        norm_cast
        rw [← mul_assoc, mul_add, ← mul_assoc, mul_add, mul_one, ← neg_mul, ← mul_neg]
        norm_num
      linarith
    · simp [h₀]
      simp [R]
      have : Real.cos (2 * Real.pi / 7) * Real.cos (4 * Real.pi / 7) + Real.cos (2 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) + Real.cos (4 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) = b := by
        apply congrArg
        simp [hR]
        rw [show 2 = 1 + 1 by simp, coeff_sum (by simp), coeff_one,
          coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul,
          show 3 = 1 + 2 by simp, coeff_sum (by simp), coeff_one, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul]
        norm_cast
        norm_num
      linarith
    · simp [h₀]
      simp [R]
      have : -Real.cos (2 * Real.pi / 7) * Real.cos (4 * Real.pi / 7) * Real.cos (6 * Real.pi / 7) = c := by
        apply congrArg
        simp [hR]
        rw [show 3 = 1 + 2 by simp, coeff_sum (by simp), coeff_one, coeff_X_pow, Nat.cast_ofNat, mul_one, zero_add, one_mul]
        norm_cast
        norm_num
      linarith
    · simp [h₀]
      simp [R]
      norm_num

  -- This means that $R(x) = x^3 + ax^2 + bx + c$ for all $x$.
  have hR3 : ∀ x, R x = x ^ 3 + a * x ^ 2 + b * x + c := by
    intro x
    rw [hR]
    simp [hR_coeff]

  -- We have $P(x) = Q(x)$ for all $x$ implies $a = -3\cos \frac{2\pi}7$.
  have ha : a = -3 * Real.cos (2 * Real.pi / 7) := by
    have : ∀ x, P x = Q x := by
      intro x
      rw [hP3 x, hQ3 x]
    simp [h₀] at this
    specialize this 0
    simp at this
    linarith

  -- We have $P(x) = R(x)$ for all $x$ implies $b = 2\cos \frac{2\pi}7 + 2\cos \frac{4\pi}7 + 2\cos \frac{6\pi}7$.
  have hb : b = 2 * Real.cos (2 * Real.pi / 7) + 2 * Real.cos (4 * Real.pi / 7) + 2 * Real.cos (6 * Real.pi / 7) := by
    have : ∀ x, P x = R x := by
      intro x
      rw [hP3 x, hR3 x]
    simp [h₀] at this
    specialize this 1
    simp at this