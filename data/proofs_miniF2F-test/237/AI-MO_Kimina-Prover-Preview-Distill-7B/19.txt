rcases h₁ with ⟨k, hk0, hk1⟩

  have hk2 : 2 ^ k = (a * b) + (a ^ 3 + b ^ 3) + (a ^ 2 * b ^ 2) * 2 := by
    calc
      2 ^ k = (a + b ^ 2) * (b + a ^ 2) := hk1
      _ = (a * b) + (a ^ 3 + b ^ 3) + (a ^ 2 * b ^ 2) * 2 := by ring

  have hk3 : k ≠ 0 := by exact Nat.zero_lt_of_ne_zero hk0

  have hap0 : 0 < a := h₀.1

  have hbp0 : 0 < b := h₀.2

  have hap3 : 0 < a ^ 3 := by exact Nat.pos_pow_of_pos hapos

  have hbp3 : 0 < b ^ 3 := by exact Nat.pos_pow_of_pos hbpos

  have hapos : 0 < a + b ^ 2 := by
    calc
      0 < a := hap0
      _ < a + b ^ 2 := by exact Nat.lt_add_of_pos_right b (a + 0)

  have hbpos : 0 < b + a ^ 2 := by
    calc
      0 < b := hbp0
      _ < b + a ^ 2 := by exact Nat.lt_add_of_pos_right a (b + 0)

  have h2pos : 0 < 2 ^ k := by   -- Note that $2^k$ is positive.
    calc
      0 < 2 := by norm_num
      _ < 2 ^ k := by exact Nat.pow_pos (by norm_num) hk3

  have h2p' : 0 < (a + b ^ 2) * (b + a ^ 2) := by
    exact Nat.mul_pos hapos hbpos

  have h2p : 0 < (a * b) + (a ^ 3 + b ^ 3) + (a ^ 2 * b ^ 2) * 2 := by
    linarith

  have hkeq : (a * b) + (a ^ 3 + b ^ 3) + (a ^ 2 * b ^ 2) * 2 = 2 ^ k := by exact Eq.symm hk2

  have aux_a1ge1 : 1 ≤ a := by exact Nat.succ_le_of_lt hap0

  have aux_b1ge1 : 1 ≤ b := by exact Nat.succ_le_of_lt hbp0

  have aux_a_b1ge1 : 1 ≤ a * b := by exact Nat.le_mul_of_le_left aux_a1ge1 b

  have aux_a_b2ge1 : 1 ≤ (a * b) * (a ^ 2 + b ^ 2) := by
    apply Nat.le_mul_of_le_left
    apply Nat.le_mul_of_le_left aux_a_b1ge1
    exact Nat.pow_pos (show 0 < a by linarith) 2

  have aux_a_b3ge1 : 1 ≤ (a * b) * (a ^ 2 + b ^ 2) * (a ^ 2 * b ^ 2) := by
    apply Nat.le_mul_of_le_left
    apply Nat.le_mul_of_le_left aux_a_b2ge1
    exact Nat.pow_pos (show 0 < a by linarith) 4

  have aux_a3pos : 0 < a ^ 3 := by exact Nat.pos_pow_of_pos hapos

  have aux_b3pos : 0 < b ^ 3 := by exact Nat.pos_pow_of_pos hbp3

  have aux_a3ge1 : 1 ≤ a ^ 3 := by exact Nat.succ_le_of_lt aux_a3pos

  have aux_b3ge1 : 1 ≤ b ^ 3 := by exact Nat.succ_le_of_lt aux_b3pos

  have aux_a4ge1 : 1 ≤ a ^ 4 := by exact Nat.succ_le_of_lt (Nat.pow_pos (show 0 < a by linarith) 3)

  have aux_b4ge1 : 1 ≤ b ^ 4 := by exact Nat.succ_le_of_lt (Nat.pow_pos (show 0 < b by linarith) 3)

  have aux_a_b4ge1 : 1 ≤ a * b ^ 4 := by
    calc
      1 ≤ b ^ 4 := aux_b4ge1
      _ ≤ a * b ^ 4 := by exact Nat.le_mul_of_le_left (by linarith) (b ^ 4)

  have aux_a4ge1 : 1 ≤ a ^ 4 := by exact Nat.succ_le_of_lt (Nat.pow_pos (show 0 < a by linarith) 3)

  have aux_a_b5ge1 : 1 ≤ a ^ 5 * b ^ 4 := by
    calc
      1 ≤ a ^ 4 := aux_a4ge1
      _ ≤ a ^ 5 * b ^ 4 := by exact Nat.le_mul_of_le_left (by linarith) (a ^ 5)

  have h1 : a * b < 2 ^ k := by
    have : a * b < (a + b ^ 2) * (b + a ^ 2) := by
      apply Nat.mul_lt_mul_of_lt_of_gt
      · calc
          a * b < a ^ 2 + b ^ 2 := by exact (Nat.pow_lt_pow_iff_right (show 1 < 2 by norm_num)).mpr (by linarith)
          _ < a + b ^ 2 := by exact Nat.lt_add_of_pos_right b (a + 0)
      · calc
          a * b < a ^ 2 + b ^ 2 := by exact (Nat.pow_lt_pow_iff_right (show 1 < 2 by norm_num)).mpr (by linarith)
          _ < b + a ^ 2 := by exact Nat.lt_add_of_pos_right a (b + 0)
    linarith

  have h1' : a ^ 3 < 2 ^ k := by
    have : a ^ 3 < (a + b ^ 2) * (b + a ^ 2) := by
      apply Nat.mul_lt_mul_of_lt_of_gt
      · calc
          a ^ 3 < a ^ 2 + b ^ 2 := by exact (Nat.pow_lt_pow_iff_right (show 1 < 2 by norm_num)).mpr (by linarith)
          _ < a + b ^ 2 := by exact Nat.lt_add_of_pos_right b (a + 0)
      · calc
          a ^ 3 < b ^ 2 + a ^ 2 * b ^ 2 := by exact (Nat.lt_add_of_pos_right (Nat.pow_pos (show 0 < b by linarith) 2)) (a ^ 2 * b ^ 2)
          _ < b + a ^ 2 := by exact Nat.lt_add_of_pos_right a (b + 0)
    linarith

  have h1'' : b ^ 3 < 2 ^ k := by
    have : b ^ 3 < (a + b ^ 2) * (b + a ^ 2) := by
      apply Nat.mul_lt_mul_of_lt_of_gt
      · calc
        b ^ 3 < a ^ 2 + b ^ 2 := by exact (Nat.lt_add_of_pos_right (Nat.pow_pos (show 0 < a by linarith) 2)) (b ^ 2)
        _ < a + b ^ 2 := by exact Nat.lt_add_of_pos_right b (a + 0)
      · calc
        b ^ 3 < b ^ 2 + a ^ 2 * b ^ 2 := by exact (Nat.lt_add_of_pos_right (Nat.pow_pos (show 0 < a by linarith) 2)) (b ^ 2 * a ^ 2)
        _ < b + a ^ 2 := by exact Nat.lt_add_of_pos_right a (b + 0)
    linarith

  have h2 : a ^ 2 * b ^ 2 < 2 ^ k := by
    have : a ^ 2 * b ^ 2 < (a + b ^ 2) * (b + a ^ 2) := by
      apply Nat.mul_lt_mul_of_lt_of_gt
      · calc
        a ^ 2 * b ^ 2 < a ^ 2 + b ^ 2 := by exact (Nat.lt_add_of_pos_right (Nat.pow_pos (show 0 < b by linarith) 2)) (a ^ 2)
        _ < a + b ^ 2 := by exact Nat.lt_add_of_pos_right b (a + 0)
      · calc
        a ^ 2 * b ^ 2 < b ^ 2 + a ^ 2 * b ^ 2 := by exact (Nat.lt_add_of_pos_right (Nat.pow_pos (show 0 < a by linarith) 2)) (b ^ 2 * a ^ 2)
        _ < b + a ^ 2 := by exact Nat.lt_add_of_pos_right a (b + 0)
    linarith

  have h3 : a ^ 2 + b ^ 2 < 2 ^ k := by
    have : a ^ 2 + b ^ 2 < (a + b ^ 2) * (b + a ^ 2) := by
      apply Nat.mul_lt_mul_of_lt_of_gt
      · calc
        a ^ 2 + b ^ 2 < a ^ 2 * b ^ 2 + a ^ 2 + b ^ 2 := by exact Nat.lt_add_of_pos_right (a ^ 2 * b ^ 2) (a ^ 2)
        _ < a ^ 2 * b ^ 2 + a ^ 2 + b ^ 2 + a ^ 2 * b ^ 2 := by exact Nat.lt_add_of_pos_right (a ^ 2 * b ^ 2 + a ^ 2 + b ^ 2) (a ^ 2 * b ^ 2)
        _ = (a + b ^ 2) * (b + a ^ 2) := by ring
      · calc
        a ^ 2 + b ^ 2 < a * b + a ^ 2 + b ^ 2 := by exact Nat.lt_add_of_pos_right (a * b) (a ^ 2)
        _ < a * b + a ^ 2 + b ^ 2 + a * b := by exact Nat.lt_add_of_pos_right (a * b + a ^ 2 + b ^ 2) (a * b)
        _ = (a + b ^ 2) * (b + a ^ 2) := by ring
    linarith

  -- We show that the only solution is $(1, 1)$.
  suffices a = 1 by exact this

  -- If $a>1$, there is a contradiction.
  by_contra! ha'gt1

  have ha'ge2 : 2 ≤ a := by exact Nat.succ_le_of_lt ha'gt1

  have hbp'ge2 : 2 ≤ b := by
    rcases hbpos with hbmid | hbpos <;> try linarith

  have ha'3ge2 : 2 ≤ a ^ 3 := by exact Nat.le_pow (show 2 ≤ a by linarith) 3

  have hbp'3ge2 : 2 ^ 3 ≤ b ^ 3 := by exact Nat.pow_le_pow_of_le_left hbp'ge2 3

  have h2p'' : 2 ^ k = (a + b ^ 2) * (b + a ^ 2) ≥ (2 + 2 ^ 2) * (2 + 2 ^ 2) := by
    calc
      2 ^ k = (a + b ^ 2) * (b + a ^ 2) := hk1
      _ ≥ (2 + 2 ^ 2) * (2 + 2 ^ 2) := by
        apply Nat.mul_le_mul
        · apply Nat.le_add_of_le_of_pos (show 2 ≤ a by linarith) (show 0 < b ^ 2 by positivity)
        · apply Nat.le_add_of_pos_of_le (show 0 < a ^ 2 by positivity) (show 2 ≤ b by linarith)

  have h2p'' : 2 ^ k ≥ 72 := by
    calc
      2 ^ k ≥ (2 + 2 ^ 2) * (2 + 2 ^ 2) := h2p''
      _ = 72 := by ring

  have h2p'' : k ≥ 6 := by
    by_contra! hkcon
    have : 2 ^ k < 72 := by
      calc
        2 ^ k < 2 ^ 6 := by exact Nat.pow_lt_pow_left (by norm_num) hkcon
        _ = 64 := by norm_num
        _ < 72 := by norm_num
    linarith

  have h3 : a ^ 3 + b ^ 3 < 2 ^ k := by
    have : a ^ 3 + b ^ 3 < (a + b ^ 2) * (b + a ^ 2) := by
      apply Nat.mul_lt_mul_of_lt_of_gt
      · calc
        a ^ 3 + b ^ 3 < a ^ 2 * b ^ 2 + a ^ 3 + b ^ 3 := by exact Nat.lt_add_of_pos_right (a ^ 2 * b ^ 2) (a ^ 3)
        _ < a ^ 2 * b ^ 2 + a ^ 3 + b ^ 3 + a ^ 2 * b ^ 2 := by exact Nat.lt_add_of_pos_right (a ^ 2 * b ^ 2 + a ^ 3 + b ^ 3) (a ^ 2 * b ^ 2)
        _ = (a + b ^ 2) * (b + a ^ 2) := by ring
      · calc
        a ^ 3 + b ^ 3 < a * b + a ^ 3 + b ^ 3 := by exact Nat.lt_add_of_pos_right (a * b) (a ^ 3)
        _ < a * b + a ^ 3 + b ^ 3 + a * b := by exact Nat.lt_add_of_pos_right (a * b + a ^ 3 + b ^ 3) (a * b)
        _ = (a + b ^ 2) * (b + a ^ 2) := by ring
    linarith

  -- We derive a contradiction from the fact that $2^k$ is greater than $2(a^3+b^3)$
  have h4 : a ^ 3 + b ^ 3 + a * b < 2 ^ k := by
    have : a ^ 3 + b ^ 3 + a * b < 2 * ((a ^ 3 + b ^ 3) : ℕ) := by
      apply Nat.lt_two_mul
      apply Nat.add_lt_of_lt_add_right
      linarith
    apply Nat.lt_trans h3 this

  have h5 : a * b < 2 ^ k := by
    calc
      a * b < a ^ 3 + b ^ 3 + a * b := by exact Nat.lt_add_of_pos_right (a ^ 3 + b ^ 3) (a * b)
      _ < 2 ^ k := h4

  have h5' : a ^ 2 * b ^ 2 < 2 ^ k := by
    calc
      a ^ 2 * b ^ 2 < a * b := by exact Nat.lt_mul_of_pos_right (a * b) (show 1 < b by linarith)
      _ < 2 ^ k := h5

  have h6 : a ^ 2 * b ^ 2 + a * b < 2 ^ k := by
    apply Nat.lt_trans h5' h5

  have h7 : a ^ 2 + b ^ 2 + a * b < 2 ^ k := by
   calc
      a ^ 2 + b ^ 2 + a * b < a ^ 2 * b ^ 2 + a ^ 2 + b ^ 2 + a * b := by
         apply Nat.lt_add_of_pos_right
         apply Nat.add_lt_of_lt_add_right
         linarith
      _ < 2 ^ k := by exact Nat.lt_trans h6 h5

  have h8 : a ^ 2 + b ^ 2 < 2 ^ k := by
    calc
      a ^ 2 + b ^ 2 < a ^ 2 + b ^ 2 + a * b := by exact Nat.lt_add_of_pos_right (a ^ 2 + b ^ 2) (a * b)
      _ < 2 ^ k := h7

  have h9 : a ^ 2 + b ^ 2 + (a ^ 2 + b ^ 2) * (a * b) < 2 ^ k := by
   calc
      a ^ 2 + b ^ 2 + (a ^ 2 + b ^ 2) * (a * b) < 2 ^ k + (a ^ 2 + b ^ 2) * (a * b) := by
        apply Nat.lt_add_of_pos_right
        apply Nat.add_lt_of_lt_add_right
        linarith
      _ < 2 ^ k + (a ^ 2 + b ^ 2) * (a ^ 2 + b ^ 2) := by
        rw [← mul_le_mul_right (show 0 < a * b by positivity)]
        apply Nat.lt_add_of_pos_right
        apply Nat.add_lt_of_lt_add_right
        linarith
      _ = (a + b ^ 2) * (b + a ^ 2) := by ring
      _ = 2 ^ k := by exact hk1

  have h10 : (a * b) * (a ^ 2 + b ^ 2) < 2 ^ k := by
    calc
      (a * b) * (a ^ 2 + b ^ 2) < (a ^ 2 + b ^ 2) * (a * b) + (a ^ 2 + b ^ 2) * (a * b) := by
        apply Nat.lt_mul_of_pos_right
        apply Nat.add_lt_of_lt_add_right
        linarith