obtain ⟨k, hk⟩ := h₁

  have hk' : 2 ^ k = (a + b ^ 2) * (b + a ^ 2) := hk

  have ha : 0 < a := h₀.1

  have hb : 0 < b := h₀.2

  have hineq1 : 2 ^ k > 0 := by
    calc
      2 ^ k > 0 := by positivity
      _ = (a + b ^ 2) * (b + a ^ 2) := by rw [hk']
      _ > 0 := by positivity

  have hineq2 : a + b ^ 2 > 0 := by
    calc
      a + b ^ 2 > 0 := by positivity
      _ = 2 ^ k := by rw [hk']
      _ > 0 := by positivity

  have hineq3 : b + a ^ 2 > 0 := by
    calc
      b + a ^ 2 > 0 := by positivity
      _ = 2 ^ k := by rw [hk']
      _ > 0 := by positivity

  have h1 : (a + b ^ 2) * (b + a ^ 2) > 0 := by positivity

  have hmul : (a + b ^ 2) * (b + a ^ 2) = (a + b ^ 2) * (b + a ^ 2) := rfl

  have : a = 1 := by

    -- Primes can't divide $2^k$ except for $2$.

    have h2 : ∀ p : ℕ, ( p.Prime ∧ p ∣ 2 ^ k ) → p = 2 := by

      intro p hp

      rcases hp with ⟨hp, hpdvd⟩

      have : p ∣ 2 := by

        have hp' : p ∣ 2 ^ k := hpdvd

        have h2min : 2 ^ k = 2 * (2 ^ (k - 1)) := by

          calc

            2 ^ k = 2 ^ (k - 1) * 2 := by rw [show k = k - 1 + 1 by omega, pow_add]; ring

            _ = 2 * (2 ^ (k - 1)) := by ring

        rw [h2min] at hp'

        have : p ∣ 2 ∨ p ∣ 2 ^ (k - 1) := by refine (Nat.Prime.dvd_mul hp).mp hp'

        rcases this with hp'' | hp''

        · exact hp''

        · have : p ∣ 2 := by refine Nat.Prime.dvd_of_dvd_pow hp (by omega)

          have : p = 2 := by

            have : p ≤ 2 := by refine Nat.le_of_dvd (by omega) this

            have : 2 ≤ p := by refine Nat.Prime.two_le hp

            linarith

          exact this

      by_contra hpne

      have : p ≠ 2 := by exact Nat.not_eq_of_lt hpne

      absurd this

      refine Nat.Prime.dvd_of_dvd_pow hp (by omega)

    -- Let's show that $a$ is odd.

    have h3 : a.Nonneg := by exact Nat.nonneg a

    have h4 : Odd a := by

      by_contra haeven

      have h2 : ∃ b', a = 2 * b' := by exact Even.exists_two_nsmul a haeven

      rcases h2 with ⟨b', hb'⟩

      have h5 : (a + b ^ 2) * (b + a ^ 2) > 2 * (b + (2 * b' ^ 2) ^ 2) := by

        have : b + a ^ 2 > b := by

          have : b > 0 := hb

          calc

            b + a ^ 2 > b + 0 := by linarith

            _ = b := by rw [add_zero]

        have : a + b ^ 2 > 2 * b' ^ 2 := by

          calc

            a + b ^ 2 = 2 * b' + b ^ 2 := by rw [hb']

            _ > 2 * b' := by linarith

        calc

          (a + b ^ 2) * (b + a ^ 2) > 2 * b' ^ 2 * (b + a ^ 2) := by gcongr; linarith

          _ > 2 * (b + a ^ 2) := by nlinarith

          _ > 2 * (b + (2 * b' ^ 2) ^ 2) := by nlinarith

      have h2 : 2 ∣ (a + b ^ 2) * (b + a ^ 2) := by exact even_iff_two_dvd.mp ⟨(a + b ^ 2) * (b + a ^ 2) / 2, by omega⟩

      have h6 : (a + b ^ 2) * (b + a ^ 2) = 2 * (2 ^ (k - 1)) := by

        rw [hk']

        calc

          2 ^ k = 2 * 2 ^ (k - 1) := by rw [show k = k - 1 + 1 by omega, pow_add]; ring

          _ = 2 * (2 ^ (k - 1)) := by ring

      rw [h6] at h5

      have h7 : 2 ∣ 2 * (b + (2 * b' ^ 2) ^ 2) := by exact Nat.dvd_mul_left 2 (b + (2 * b' ^ 2) ^ 2)

      have h8 : 2 ∣ 2 ^ (k - 1) := by exact dvd_pow_self 2 (by omega)

      have h9 : 2 ∣ b + (2 * b' ^ 2) ^ 2 := by exact Nat.Prime.dvd_of_dvd_mul_left (Nat.prime_two) h7

      have h10 : b + (2 * b' ^ 2) ^ 2 > 0 := by positivity

      have h11 : 2 ∣ (b + (2 * b' ^ 2) ^ 2) := by exact Nat.dvd_of_mod_eq_zero h9

      have h12 : ∃ b'', b + (2 * b' ^ 2) ^ 2 = 2 * b'' := by exact even_iff_two_dvd.mp h11

      rcases h12 with ⟨b'', hb''⟩

      have : 2 * b'' > 0 := by positivity

      have : 2 * b'' ≥ 2 := by omega

      linarith

    -- Then, the prime factorization of $(a + b^2)(b + a^2)$ has only $2$ as a prime.

    have h5 : ∀ p : ℕ, ( p.Prime ∧ p ∣ (a + b ^ 2) * (b + a ^ 2) ) → p = 2 := by

      intro p hp

      rcases hp with ⟨hp, hpdvd⟩

      have h2p : p ∣ 2 ^ k := by rw [hk'] at hpdvd; exact hpdvd

      have h3p : p ∣ 2 := by exact Nat.Prime.dvd_of_dvd_pow hp h2p

      have h4p : p = 2 := by exact Nat.prime_dvd_prime_iff_eq hp (Nat.prime_two) h3p

      exact h4p

    -- Let's show that $b$ is also odd.

    have h6 : Odd b := by

      by_contra hbeven

      have h2 : ∃ b', b = 2 * b' := by exact Even.exists_two_nsmul b hbeven

      rcases h2 with ⟨b', hb'⟩

      have h5 : (a + b ^ 2) * (b + a ^ 2) > (a + (2 * b' ^ 2) ^ 2) * 2 * b' := by

        have : a + b ^ 2 > a + (2 * b' ^ 2) ^ 2 := by

          have : b' ^ 2 > 0 := Nat.pos_pow_of_pos 2 b' (by omega)

          calc

            a + b ^ 2 > a + (2 ^ 2) * b' ^ 2 := by gcongr; nlinarith

            _ = a + 4 * b' ^ 2 := by rw [mul_comm]; exact rfl

            _ > a + b' ^ 2 := by nlinarith

            _ = a + (2 * b' ^ 2) ^ 2 := by ring

        have : b + a ^ 2 > 2 * b' := by

          calc

            b + a ^ 2 > 2 * b' + a ^ 2 := by linarith

            _ = b' * 2 + a ^ 2 := by nth_rw 1 [← mul_one (b')]; rw [← add_mul]; ring

            _ > b' * 2 := by nlinarith

        calc

          (a + b ^ 2) * (b + a ^ 2) > (a + (2 * b' ^ 2) ^ 2) * (b + a ^ 2) := by gcongr; linarith

          _ > (a + (2 * b' ^ 2) ^ 2) * 2 * b' := by nlinarith

      have h2 : 2 ∣ (a + (2 * b' ^ 2) ^ 2) * 2 * b' := by ring

      have h6 : (a + b ^ 2) * (b + a ^ 2) = 2 * (2 ^ (k - 1)) := by rw [hk']

      rw [h6] at h5

      have h7 : 2 ∣ 2 ^ (k - 1) := by exact Nat.dvd_mul_left 2 ((a + (2 * b' ^ 2) ^ 2) * b')

      have h8 : 2 ∣ (a + (2 * b' ^ 2) ^ 2) := by exact Nat.Prime.dvd_of_dvd_mul_left (Nat.prime_two) h7

      have h9 : ∃ b'', (a + (2 * b' ^ 2) ^ 2) = 2 * b'' := by exact even_iff_two_dvd.mp h8

      rcases h9 with ⟨b'', hb''⟩

      have h10 : (a + (2 * b' ^ 2) ^ 2) * b' > b' := by

        have : b' > 0 := hb'

        calc

          (a + (2 * b' ^ 2) ^ 2) * b' > b' * b' := by gcongr; nlinarith

          _ = b' ^ 2 := by ring

          _ > b' := by nlinarith

      have h11 : 2 * b'' * b' > b' := by nlinarith

      have h12 : 2 ∣ (b' * (2 * b'')) := by rw [hb'']; exact Nat.dvd_mul_left 2 b''

      have h13 : 2 ∣ b' := by exact Nat.Prime.dvd_of_dvd_mul_left (Nat.prime_two) h12

      have h14 : b' = 0 ∨ b' = 2 ∨ b' > 2 := by omega

      rcases h14 with (h | h | h)

      · rw [h] at hb'

        linarith

      · rw [h] at hb'

        have h15 : 2 ∣ (a + 2 * 2 ^ 2) := by exact Nat.Prime.dvd_of_dvd_mul_left (Nat.prime_two) (by rw [hb']; omega)

        have h16 : 2 ∣ 2 * b'' := by rw [hb']; omega

        have h17 : 2 ∣ (a + 2 * 2 ^ 2) * (b + a ^ 2) := by exact Dvd.dvd.mul_left h15 (b + a ^ 2)

        have h18 : 2 ∣ 2 ^ k := by rw [hk']; exact Nat.dvd_mul_right 2 (b + a ^ 2)

        have h19 : 2 ∣ 2 ^ (k - 1) := by exact Nat.dvd_of_dvd_mul_left (Nat.Prime.two_le (Nat.prime_two)) h18

        have h20: ∀ k : ℕ, 2 ^ k ≤ 2 ^ (k - 1) → k = 0 := by

          intro k hk

          by_contra hk'

          have hk'' : k ≠ 0 := by exact Nat.not_eq_zero_of_lt hk'

          have h21 : 2 ^ k ≤ 2 ^ (k - 1) := by exact Nat.pow_le_pow_of_le hk

          have h22 : k ≤ k - 1 := by exact Nat.le_of_pow_le_pow_left₀ (by omega) h21

          have h23 : k - 1 ≤ k - 1 - 1 := by exact Nat.le_sub_one_of_lt h22

          have h24 : 2 ^ (k - 1) ≤ 2 ^ (k - 1) - 1 := by exact Nat.pow_le_pow_of_le h23

          omega

        have h21:= h20 k h19

        omega

      · have hk : k > 1 := by

          refine Nat.one_lt_iff_ne_zero_and_ne_one.mpr?_

          constructor

          · exact Nat.Prime.ne_one (Nat.prime_two)

          · exact Nat.ne_zero_of_lt hk

        have h22 : 2 ^ (k - 1) > 2 := by exact Nat.two_lt_pow (Nat.sub_ne_zero_of_lt hk) two_ne_zero

        have h23 : 2 * b'' > b' := by nlinarith

        have h24 : 2 ∣ b' := by exact Nat.Prime.dvd_of_dvd_mul_left (Nat.prime_two) (by rw [hb']; omega)

        have h25 : ∃ b''', b' = 2 * b''' := by exact even_iff_two_dvd.mp h24

        rcases h25 with ⟨b''', hb'''⟩

        have h26 : b''' > 0 := by positivity

        have h27 : 2 * b''' > 0 := by positivity

        have h28 : 2 * b''' ≥ 2 := by omega

        linarith

    -- Then, the prime factorization of $(a + b^2)(b + a^2)$ has only $2$ as a prime.

    have h7 : ∀ p : ℕ, ( p.Prime ∧ p ∣ (a + b ^ 2) * (b + a ^ 2) ) → p = 2 := by

      intro p hp

      rcases hp with ⟨hp, hpdvd⟩

      have h2p : p ∣ 2 ^ k := by rw [hk'] at hpdvd; exact hpdvd

      have h3p : p ∣ 2 := by exact Nat.Prime.dvd_of_dvd_pow hp h2p

      have h4p : p = 2 := by exact Nat.prime_dvd_prime_iff_eq hp (Nat.prime_two) h3p

      exact h4p

    -- Let's show that $a$ is even.

    have h7 : Even a := by

      by_contra haeven

      -- Therefor, the prime factorization of $a$ has no $2$.

      have ha' : ¬ 2 ∣ a := by exact Nat.not_dvd_iff_isUnit.mpr (by exact Nat.prime_two)

      have ha'' : ¬ 2 ∣ a ^ 2 := by exact Nat.Prime.not_dvd_pow ha' (by omega)

      have ha''' : ¬ 2 ∣ (2 + a ^ 2) := by exact Nat.Prime.not_dvd_add ha' (by omega)

      -- Then, the prime factorization of $2 + a ^ 2$ has no $2$.

      have h1 : ∀ p : ℕ, ( p.Prime ∧ p ∣ (a + b ^ 2) * (b + a ^ 2) ) → p = 2 := by

        intro p hp

        rcases hp with ⟨hp, hpdvd⟩

        have : p ∣ 2 ^ k := by rw [hk'] at hpdvd; exact hpdvd

        have : p ∣ 2 := by exact Nat.Prime.dvd_of_dvd_pow hp (by omega)

        have : p = 2 := by exact Nat.prime_dvd_prime_iff_eq hp (Nat.prime_two) this

        exact this

      -- However, $2 + a ^ 2$ divides $2^k$, so the prime factorization of $2 + a ^ 2$ has only $2$ as a prime, which is a contradiction.

      have h2 : 2 + a ^ 2 ∣ 2 ^ k := by exact Dvd.intro (b + a ^ 2) (id (Eq.symm hk'))

      have h3 : ∀ p : ℕ, ( p.Prime ∧ p ∣ 2 + a ^ 2 ) → p = 2 := by exact h1

      have h4 : ¬ 2 ∣ 2 + a ^ 2 := by exact Nat.not_dvd_iff_isUnit.mpr (by exact Nat.prime_two)

      have h5 : 2 + a ^ 2 = 1 ∨ 2 + a ^ 2 = 2 := by

        have h4' : 2 + a ^ 2 ≤ 2 ^ k := by exact Nat.le_of_dvd (by positivity) h2

        have h5 : 2 ^ k < 2 ^ 1 := by

          calc

            2 ^ k < 2 ^ 1 := by exact Nat.pow_lt_pow_of_lt (by omega)