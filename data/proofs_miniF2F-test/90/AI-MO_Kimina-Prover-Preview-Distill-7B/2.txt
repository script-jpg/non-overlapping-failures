-- We first prove that the product $(1 + 1/k^3) (1 + 1/(k + 1)^3)$ is less than or equal to
  -- $1 + 3 / ((k + 1)^2 + (k + 1)k + k^2)$.
  have h₁ (k : ℕ) : (1 : ℝ) + 1 / (k ^ 3) * ((1 : ℝ) + 1 / ((k + 1) ^ 3)) ≤
      1 + 3 / ((k + 1) ^ 2 + (k + 1) * k + k ^ 2) := by
    calc
      _ = 1 + 1 / (k ^ 3) * ((k + 1) ^ 3 + 1) / ((k + 1) ^ 3) := by
        simp only [mul_div_cancel_left₀]
        field_simp
      _ = 1 + (k + 1) ^ 3 + 1 - (1 / (k ^ 3) * ((k + 1) ^ 3 + 1) - (1 / (k ^ 3) * ((k + 1) ^ 3 + 1) / ((k + 1) ^ 3))) := by ring
      _ ≤ 1 + (k + 1) ^ 3 + 1 - (1 / (k ^ 3) * ((k + 1) ^ 3 + 1) - (1 / (k ^ 3) * ((k + 1) ^ 3 + 1) / ((k + 1) ^ 3))) := by
        -- We use the fact that $(k + 1) ^ 2 + (k + 1) k + k ^ 2 ≤ (k + 1) ^ 3 + 1$.
        have : ((k + 1) ^ 2 + (k + 1) * k + k ^ 2 : ℝ) ≤ ((k + 1) ^ 3 + 1 : ℝ) := by
          ring_nf
          positivity
        refine div_le_div_of_nonneg_left?_ this.le
        positivity
      _ = 1 + (k + 1) ^ 3 + 1 - (1 / (k ^ 3) * ((k + 1) ^ 3 + 1) * (1 - 1 / ((k + 1) ^ 3))) := by ring
      _ = 1 + (k + 1) ^ 3 + 1 - (1 / (k ^ 3) * ((k + 1) ^ 3 + 1) * (1 - 1 / ((k + 1) ^ 3))) := by ring
      _ ≤ 1 + (k + 1) ^ 3 + 1 - (1 / (k ^ 3) * ((k + 1) ^ 3 + 1) * (1 - 1 / ((k + 1) ^ 3))) := by
        -- We use the fact that $1 - 1 / ((k + 1) ^ 3) ≤ 3 / ((k + 1) ^ 2 + (k + 1) k + k ^ 2)$.
        have : 1 - 1 / ((k + 1) ^ 3 : ℝ) ≤ 3 / ((k + 1) ^ 2 + (k + 1) * k + k ^ 2 : ℝ) := by
          ring_nf
          rw [div_le_div_iff₀ (by positivity) (by positivity)]
          norm_num
          have : (k + 1) ^ 3 + 1 ≥ 2 * (k + 1) ^ 2 := by
            calc
              _ ≥ (k + 1) * (k + 1) ^ 2 := by
                apply mul_le_mul
                · rfl
                · apply pow_le_pow_left₀ (by norm_num)
              _ ≥ _ := by ring
          linarith
        refine sub_le_sub_left?_ this
        positivity
      _ = 1 + 3 / ((k + 1) ^ 2 + (k + 1) * k + k ^ 2) := by ring

  -- By the lemma `h₁`, we have that the product $(1 + 1/k^3)$ for $1 ≤ k ≤ n$ is less than or equal to
  -- $1 + ∑_{k=1}^{n-1} 3 / ((k + 1) ^ 2 + (k + 1) k + k ^ 2)$.
  have h₂ : (∏ k in Finset.Icc 1 n, 1 + (1 : ℝ) / k ^ 3) ≤ 1 + ∑ k ∈ Finset.Icc 1 (n - 1),
      3 / ((k + 1) ^ 2 + (k + 1) * k + k ^ 2) := by
    induction n with
    | zero => linarith
    | succ n ih =>
      by_cases h : n = 0
      · simp [h]
      · simp only [Finset.prod_Icc_succ_top, Finset.prod_Icc_succ_top, h]
        simp only [h, Nat.add_one_sub_one, Finset.Icc_eq_empty_of_lt, Finset.sum_empty,
          mul_zero, add_zero, ih, Finset.prod_Icc_succ_top]
        exact h₁ n

  -- We show that $1 + ∑_{k=1}^{n-1} 3 / ((k + 1) ^ 2 + (k + 1) k + k ^ 2) ≤ 3 - 1/n$ by induction.
  have h₃ (n : ℕ) : (1 : ℝ) + ∑ k ∈ Finset.Icc 1 n, 3 / ((k + 1) ^ 2 + (k + 1) * k + k ^ 2) ≤
      3 - 1 / ↑n := by
    induction n with
    | zero =>
      simp only [Finset.sum_eq_zero, add_zero, mul_zero, zero_sub, neg_zero, h]
      norm_num
    | succ n ih =>
      simp only [Finset.sum_Icc_succ_top, h, Nat.cast_add, Nat.cast_one]
      simp only [Finset.sum_Icc_succ_top, Nat.cast_add, Nat.cast_one] at ih
      calc
        _ ≤ 1 + ∑ k ∈ Finset.Icc 1 n, 3 / ((k + 1) ^ 2 + (k + 1) * k + k ^ 2) + 3 / ((n + 1) ^ 2 + (n + 1) * n + n ^ 2) := by
          refine add_le_add_right?_ (3 / ((n + 1) ^ 2 + (n + 1) * n + n ^ 2))
          exact ih
        _ ≤ 3 - 1 / ↑n + 3 / ((n + 1) ^ 2 + (n + 1) * n + n ^ 2) := by rel [ih]
        _ = 3 - 1 / (↑n + 1) := by
          field_simp
          ring

  -- The goal is a direct consequence of `h₂` and `h₃`.
  exact h₃ n
```