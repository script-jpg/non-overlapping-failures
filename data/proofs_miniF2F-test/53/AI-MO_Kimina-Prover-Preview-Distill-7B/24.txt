-- Mathlib has a lemma that if $a\cdot x+b\cdot y=a\cdot x'+b\cdot y'$, then
  -- $a\cdot (x-x')=b\cdot (y'-y)$.
  -- Here we have $14\cdot (3n+2)-14\cdot (3n+1)=31n+9-14n-7=17n+2$,
  -- $14n+3-7n-3=7n$, so $17n+2=7\cdot (n\cdot (3-2)+2/7)$.
  -- So $7\mid 17n+2$.
  have h₁ : n.gcd (14 * n + 3) = n.gcd 7 := by
    have h₁ : n.gcd (14 * n + 3) = n.gcd (14 * n + 3 - (14 * (n - 1))) := by
      nth_rw 1 [← Nat.gcd_self_sub_right (by omega : n ≤ 14 * n + 3)]
      nth_rw 2 [Nat.gcd_comm]
      nth_rw 3 [← one_mul (14 * (n - 1))]
      have : 14 * n + 3 - 14 * (n - 1) = 14 * n + 3 - (14 * (n - 1)) := by
        zify
        rw [Nat.cast_sub, Nat.cast_sub, Nat.cast_add, Nat.cast_add]
        ring
        omega
        omega
      rw [this]
    have h₂ : n.gcd (14 * n + 3 - (14 * (n - 1))) = n.gcd (7 * n + 7) := by
      rw [show 14 * n + 3 - (14 * (n - 1)) = 7 * n + 7 by omega]
    have h₃ : n.gcd (7 * n + 7) = n.gcd 7 := by
      nth_rw 2 [Nat.gcd_comm]
      rw [Nat.gcd_self_add_left]
    rw [h₁, h₂, h₃]

  -- Since $7\mid 17n+2$, then $7\mid n$, then $7\mid 21n+4$.
  -- So gcd of $21n+4$ and $14n+3$ is the same as gcd of $14n+3$ and $7$.
  have h₂ : n.gcd (21 * n + 4) = n.gcd 7 := by
    have h₂ : n.gcd (21 * n + 4) = n.gcd (21 * n + 4 - (7 * (3 * n + 2))) := by
      nth_rw 1 [← Nat.gcd_self_sub_right (by omega : n ≤ 21 * n + 4)]
      nth_rw 2 [Nat.gcd_comm]
      nth_rw 3 [← one_mul (7 * (3 * n + 2))]
      have : 21 * n + 4 - 7 * (3 * n + 2) = 21 * n + 4 - (7 * (3 * n + 2)) := by
        zify
        rw [Nat.cast_sub, Nat.cast_sub, Nat.cast_add, Nat.cast_add]
        ring
        omega
        omega
      rw [this]
    have h₃ : n.gcd (21 * n + 4 - (7 * (3 * n + 2))) = n.gcd (7 * n + 7) := by
      rw [show 21 * n + 4 - (7 * (3 * n + 2)) = 7 * n + 7 by omega]
    have h₄ : n.gcd (7 * n + 7) = n.gcd 7 := by
      nth_rw 2 [Nat.gcd_comm]
      rw [Nat.gcd_self_add_left]
    rw [h₂, h₃, h₄]

  -- Since gcd of $21n+4$ and $14n+3$ is the same as gcd of $14n+3$ and $7$,
  -- and gcd of $14n+3$ and $7$ is the same as gcd of $7n+1$ and $7$,
  -- and gcd of $7n+1$ and $7$ is 1, so gcd of $21n+4$ and $14n+3$ is 1.
  have h₃ : n.gcd (14 * n + 3) = n.gcd 7 := by
    have h₃ : n.gcd (14 * n + 3) = n.gcd (14 * n + 3 - 7 * n) := by
      rw [Nat.gcd_self_sub_left (by omega : 7 * n ≤ 14 * n + 3)]
      nth_rw 2 [Nat.gcd_comm]
    have h₄ : n.gcd (14 * n + 3 - 7 * n) = n.gcd (7 * n + 1) := by
      rw [show 14 * n + 3 - 7 * n = 7 * n + 1 by omega]
    have h₅ : n.gcd (7 * n + 1) = n.gcd 7 := by
      nth_rw 2 [Nat.gcd_comm]
      rw [Nat.gcd_self_add_left]
    rw [h₃, h₄, h₅]

  rw [h₁, h₂, h₃]
  clear h₁ h₂ h₃
  have h₄ : 7.gcd n = 1 := by
    have h₄ : n % 7 < 7 := by
      apply Nat.mod_lt
      norm_num
    have h₅ : n % 7 < 7 := by
      apply Nat.mod_lt
      norm_num
    have : n.gcd 7 = n % 7 := by
      rw [Nat.gcd_eq_right]
      omega
    rw [this]
    interval_cases n % 7
    all_goals norm_num
  have h₅ : 7.gcd (3 * n + 1) = 7.gcd 7 := by
    rw [show 3 * n + 1 = 3 * n + 1 - 3 * n + 3 by omega]
    nth_rw 1 [Nat.gcd_self_sub_right (by omega : 3 * n ≤ 3 * n + 1)]
    rw [Nat.gcd_add_mul_left_right]
    rw [show 3 * n + 1 - 3 * n = 1 by omega]
    rw [this, h₄]
  have h₆ : 7.gcd (3 * n + 1) = 1 := by
    rw [h₅]
    norm_num
  have h₇ : 7.gcd (2 * n + 1) = 1 := by
    have h₇ : 2 * n + 1 + 1 = 2 * (n + 1) := by omega
    have h₈ : 7.gcd (2 * n + 1) = 7.gcd (2 * (n + 1)) := by
      rw [h₇]
    have h₉ : n + 1 < 7 * (n + 1) := by
      apply Nat.lt_mul_of_pos_left
      omega
    have h₁₀ : 7.gcd (2 * (n + 1)) = 7.gcd (2 * (n + 1) - 7 * (n + 1)) := by
      rw [Nat.gcd_self_sub_right (by omega : 7 * (n + 1) ≤ 2 * (n + 1))]
      rw [Nat.gcd_comm]
    have h₁₁ : 7 * (n + 1) ≤ 2 * (n + 1) := by omega
    have h₁₂ : 2 * (n + 1) - 7 * (n + 1) = -5 * (n + 1) := by omega
    rw [h₉, h₁₀, h₁₂] at h₈
    rw [h₈]
    have : n + 1 < 5 * (n + 1) := by
      refine Nat.lt_mul_of_pos_left?_ (by omega : 5 > 0)
      omega
    have h₁₃ : (7 + 5) * (n + 1) = 12 * (n + 1) := by omega
    have h₁₄ : 5 * (n + 1) = 12 * (n + 1) - 7 * (n + 1) := by omega
    have h₁₅ : 7.gcd (5 * (n + 1)) = 7.gcd (12 * (n + 1) - 7 * (n + 1)) := by
      rw [← h₁₄]
      rw [Nat.gcd_comm]
      rw [Nat.gcd_self_sub_right (by omega : 7 * (n + 1) ≤ 12 * (n + 1))]
    have h₁₆ : 12 * (n + 1) - 7 * (n + 1) = 5 * (n + 1) := by omega
    rw [h₁₆] at h₁₅
    rw [h₁₅] at h₈
    have h₁₇ : 7.gcd (7 + 5) = 7.gcd 12 := by
      rw [← h₁₃]
      rw [Nat.gcd_comm]
      rw [Nat.gcd_self_sub_right (by omega : 7 ≤ 7 + 5)]
    have h₁₈ : 7.gcd 12 = 1 := by
      have : Nat.Prime 7 := by norm_num
      have : Nat.Prime 5 := by norm_num
      have h₁₈ : 7.gcd 12 = 1 := by
        rw [Nat.gcd_eq_iff]
        constructor
        omega
        constructor
        omega
        omega
      exact h₁₈
    have h₁₉ : 7.gcd (7 + 5) = 1 := by
      rw [h₁₇, h₁₈]
    rw [show 7 + 5 = 12 by norm_num] at h₁₉
    exact h₁₉
  have h₈ : 7.gcd (3 * n + 1) = 7.gcd (3 * n + 1 - 3 * n + 3) := by
    rw [Nat.gcd_self_sub_right (by omega : 3 * n ≤ 3 * n + 1)]
    nth_rw 2 [Nat.gcd_comm]
    rw [show 3 * n + 1 - 3 * n = 1 by omega]
  have h₉ : 7.gcd (3 * n + 1 - 3 * n) = 7.gcd 3 := by
    have h₉ : 3 * n + 1 - 3 * n = 1 := by omega
    rw [h₉]
  have h₁₀ : 7.gcd (3 * n + 1 - 3 * n + 3) = 7.gcd (3 + 1) := by
    rw [show 3 * n + 1 - 3 * n + 3 = 3 + 1 by omega]
  have h₁₁ : 7.gcd (3 + 1) = 1 := by
    norm_num
  have h₁₂ : 7.gcd (3 * n + 1) = 1 := by
    rw [h₈, h₉, h₁₀, h₁₁]
  have h₁₃ : 14 * n + 3 = 7 * (2 * n + 1) := by omega
  have h₁₄ : 7.gcd (14 * n + 3) = 7.gcd (7 * (2 * n + 1)) := by
    rw [h₁₃]
  have h₁₅ : 7.gcd (7 * (2 * n + 1)) = 7.gcd (2 * n + 1) := by
    rw [Nat.gcd_mul_left_right]
  have h₁₆ : 7.gcd (2 * n + 1) = 1 := by
    rw [h₁₄, h₁₅, h₇]
  have h₁₇ : 7.gcd (2 * n + 1) = 7.gcd (2 * n + 1 - 2 * n) := by
    rw [Nat.gcd_self_sub_right (by omega : 2 * n ≤ 2 * n + 1)]
    rw [Nat.gcd_comm]
    rw [Nat.gcd_self_sub_left (by omega : 2 * n ≤ 2 * n + 1)]
  have h₁₈ : 7.gcd (2 * n + 1 - 2 * n) = 7.gcd 1 := by
    have h₁₈ : 2 * n + 1 - 2 * n = 1 := by omega
    rw [h₁₈]
  have h₁₉ : 7.gcd 1 = 1 := by
    norm_num
  have h₂₀ : 7.gcd (2 * n + 1) = 1 := by
    rw [h₁₇, h₁₈, h₁₉]
  have h₂₁ : 21 * n + 4 = 3 * (7 * n + 1) + 1 := by omega
  have h₂₂ : 7.gcd (21 * n + 4) = 7.gcd (3 * (7 * n + 1) + 1) := by
    rw [h₂₁]
  have h₂₃ : 7.gcd (3 * (7 * n + 1) + 1) = 7.gcd 1 := by
    have h₂₃ : 3 * (7 * n + 1) + 1 = 3 * (7 * n + 1) + 1 - 3 * (7 * n + 1) + 3 := by omega
    have h₂₄ : 3 * (7 * n + 1) + 1 - 3 * (7 * n + 1) = 1 := by omega
    rw [h₂₃, h₂₄]
    rw [Nat.gcd_self_sub_right (by omega : 3 * (7 * n + 1) ≤ 3 * (7 * n + 1) + 1)]
    rw [Nat.gcd_comm]
    rw [Nat.gcd_self_sub_left (by omega : 3 * (7 * n + 1) ≤ 3 * (7 * n + 1) + 1)]
  have h₂₄ : 7.gcd (3 * (7 * n + 1) + 1) = 1 := by
    rw [h₂₃, h₂₄]
  have h₂₅ : 7.gcd (21 * n + 4) = 1 := by
    rw [h₂₂, h₂₃, h₂₄]
  have h₂₆ : n.gcd 7 = 1 := by
    have : n % 7 < 7 := by
      apply Nat.mod_lt
      norm_num
    have h₂₆ : n.gcd 7 = n % 7 := by
      rw [Nat.gcd_eq_right]
      omega
    rw [h₂₆]
    interval_cases n % 7
    all_goals norm_num
  rw [h₀, h₂, h₂₅, h₆, h₂₆, h₄]
```