-- Show that the sum of the elements in the range of $a$ is greater than or equal to $n$.
  have h₁ : (∑ x in Finset.range n, a x) ≥ n := by
    apply Finset.sum_le_sum
    simp
    intro i hi
    exact le_of_lt (h₀ i (Finset.mem_range.mp hi))

  -- Show that the product of the elements in the range of $a$ is less than or equal to $1$.
  have h₂ : (∏ x in Finset.range n, a x) ≤ 1 := by
    -- Generalize the statement to include $0$ in the range of $a$.
    generalize h : ∃ x : ℕ, ¬a x = 0
    -- Prove the statement using induction on $n$.
    induction n with
    | zero => simp; exact h
    | succ n ih =>
      -- If $a$ is not equal to $0$ on some element, then it's also true for the rest of the sequence.
      generalize h' : ∃ x : ℕ, ¬a x = 0
      obtain ⟨x, hx⟩ := h'
      -- If $a_1 = 0$, then $a_2 + \ldots + a_n = n$.
      rcases h with ⟨i, hi⟩
      rcases hi with ⟨a_i, ha_i⟩
      simp [Finset.sum_range_succ] at h₀
      have h' := ih (fun x => a x) n (by simpa) (by simpa)
      simp [Finset.prod_range_succ, ha_i] at h₂ ⊢
      calc
        _ = 0 * (a 1 *... * a n) := by simp
        _ ≤ 1 := by norm_num
      simp [Finset.prod_range_succ] at h₂ ⊢
      calc
        _ ≤ a 0 * (a 1 *... * a n) := by
          -- We need to show that $0 \leq a_0 \cdot (a_1 \cdot \ldots \cdot a_n)$.
          apply mul_le_mul_of_nonneg_left
          -- We know that $0 \leq a_0$ as it's a nonnegative real number.
          simpa using h_i
          -- We also know that $0 \leq a_1 \cdot \ldots \cdot a_n$.
          -- Show that the product is nonnegative.
          apply mul_nonneg
          simp
          apply mul_nonneg
          simpa using h_{i + 1}
          apply mul_nonneg
          simpa using h_{i + 2}
          apply mul_nonneg
          simpa using h_{i + 3}
          apply mul_nonneg
          simpa using h_{i + 4}
          apply mul_nonneg
          simpa using h_{i + 5}
          apply mul_nonneg
          simpa using h_{i + 6}
          apply mul_nonneg
          simpa using h_{i + 7}
          apply mul_nonneg
          simpa using h_{i + 8}
          apply mul_nonneg
          simpa using h_{i + 9}
          apply mul_nonneg
          simpa using h_{i + 10}
          apply mul_nonneg
          simpa using h_{i + 11}
          apply mul_nonneg
          simpa using h_{i + 12}
          apply mul_nonneg
          simpa using h_{i + 13}
          apply mul_nonneg
          simpa using h_{i + 14}
          apply mul_nonneg
          simpa using h_{i + 15}
          apply mul_nonneg
          simpa using h_{i + 16}
          apply mul_nonneg
          simpa using h_{i + 17}
          apply mul_nonneg
          simpa using h_{i + 18}
          apply mul_nonneg
          simpa using h_{i + 19}
        _ = a 0 * 0 * (a 2 *... * a n) := by ring
        _ ≤ a 0 * (a 1 *... * a n) := by
          -- We know that $0 \leq a_1 \cdot \ldots \cdot a_n$.
          -- Show that the product is nonnegative.
          apply mul_le_mul_of_nonneg_left
          -- We know that $0 \leq a_0$ as it's a nonnegative real number.
          simpa using h_i
          -- We also know that $0 \leq a_2 \cdot \ldots \cdot a_n$.
          -- Show that the product is nonnegative.
          apply mul_nonneg
          apply mul_nonneg
          simpa using h_{i + 1}
          apply mul_nonneg
          simpa using h_{i + 2}
          apply mul_nonneg
          simpa using h_{i + 3}
          apply mul_nonneg
          simpa using h_{i + 4}
          apply mul_nonneg
          simpa using h_{i + 5}
          apply mul_nonneg
          simpa using h_{i + 6}
          apply mul_nonneg
          simpa using h_{i + 7}
          apply mul_nonneg
          simpa using h_{i + 8}
          apply mul_nonneg
          simpa using h_{i + 9}
          apply mul_nonneg
          simpa using h_{i + 10}
          apply mul_nonneg
          simpa using h_{i + 11}
          apply mul_nonneg
          simpa using h_{i + 12}
          apply mul_nonneg
          simpa using h_{i + 13}
          apply mul_nonneg
          simpa using h_{i + 14}
          apply mul_nonneg
          simpa using h_{i + 15}
          apply mul_nonneg
          simpa using h_{i + 16}
          apply mul_nonneg
          simpa using h_{i + 17}
          apply mul_nonneg
          simpa using h_{i + 18}
          apply mul_nonneg
          simpa using h_{i + 19}
        _ ≤ 1 := by
          -- The sum of the sequence is $n$, so $a_2 + \ldots + a_n = n$.
          -- By induction hypothesis, we know that $a_2 \cdot \ldots \cdot a_n \leq 1$.
          rw [h₀]
          -- The sum of the sequence is $n$, so $a_2 + \ldots + a_n = n$.
          -- By induction hypothesis, we know that $a_2 \cdot \ldots \cdot a_n \leq 1$.
          exact h₂
      -- Otherwise, we have $a_0 = 0$.
      simp at hx
      -- This means that $a_1 + \ldots + a_n = n$.
      have h' : a 1 +... + a n = n := by
        rw [<-h₀]
        simp [hx]
      -- By induction hypothesis, we know that $a_1 \cdot \ldots \cdot a_n \leq 1$.
      have h'' := ih (fun x => a (x + 1)) n (by simpa) (by simpa)
      simp [Finset.prod_range_succ, hx] at h₂ ⊢
      calc
        _ = 0 * (a 1 *... * a n) := by simp
        _ ≤ 1 := by norm_num
        _ ≤ a 1 *... * a n := by apply le_of_eq
        _ ≤ 1 := by exact h...

  -- If the sum of the elements in the range of $a$ is exactly $n$, then the product is less than or equal to $1$.
  exact h₂

  -- Otherwise, we have $a_i = 0$ for some $i$.
  simp at h₁
  obtain ⟨i, hi⟩ := h₁
  -- We can find a sequence $b$ such that $b_j = a_j$ for $j \neq i$ and $b_i = 0$.
  generalize h : ∃ x : ℕ, ¬a x = 0
  obtain ⟨j, hj⟩ := h
  -- Show that the sum of the elements in the range of $b$ is greater than or equal to $n$.
  have h₁ : (∑ x in Finset.range n, (if x = j then 0 else a x) : NNReal) ≥ n := by
    apply Finset.sum_le_sum
    simp
    intro i hi
    by_cases hi' : i = j
    · rw [hi']
      -- If $i = j$, then $a_i = 0$.
      simpa using hj
    · rw [Finset.mem_range] at hi
      -- If $i \neq j$, then $a_i \geq 0$.
      apply le_of_lt
      exact h₀ i (Finset.mem_range.mp hi)
  -- Show that the product of the elements in the range of $b$ is less than or equal to $1$.
  have h₂ : (∏ x in Finset.range n, (if x = j then 0 else a x) : NNReal) ≤ 1 := by
    -- If the sum of the elements in the range of $b$ is exactly $n$, then the product is less than or equal to $1$.
    generalize h : ∃ x : ℕ, ¬(if x = j then 0 else a x) = 0
    obtain ⟨x, hx⟩ := h
    -- Generalize the statement to include $0$ in the range of $b$.
    induction n with
    | zero => simp; exact h
    | succ n ih =>
      -- If $b_1 = 0$, then $b_2 + \ldots + b_n = n$.
      rcases h with ⟨i, hi⟩
      rcases hi with ⟨b_i, hb_i⟩
      simp [Finset.sum_range_succ] at h₀
      have h' := ih (fun x => if x = j then 0 else a x) n (by simpa) (by simpa)
      simp [Finset.prod_range_succ, hb_i] at h₂ ⊢
      calc
        _ = 0 * (a 1 *... * a n) := by simp
        _ ≤ 1 := by norm_num
      simp [Finset.prod_range_succ] at h₂ ⊢
      calc
        _ ≤ (if 1 = j then 0 else a 0) * (a 1 *... * a n) := by
          -- We need to show that $0 \leq (if 1 = j then 0 else a 0) \cdot (a 1 \cdot \ldots \cdot a n)$.
          apply mul_le_mul_of_nonneg_left
          -- We know that $0 \leq (if 1 = j then 0 else a 0)$ as it's a nonnegative real number.
          simpa using h_i
          -- We also know that $0 \leq (a 1 \cdot \ldots \cdot a n)$.
          -- Show that the product is nonnegative.
          apply mul_nonneg
          apply mul_nonneg
          simpa using h_{i + 1}
          apply mul_nonneg
          simpa using h_{i + 2}
          apply mul_nonneg
          simpa using h_{i + 3}
          apply mul_nonneg
          simpa using h_{i + 4}
          apply mul_nonneg
          simpa using h_{i + 5}
          apply mul_nonneg
          simpa using h_{i + 6}
          apply mul_nonneg
          simpa using h_{i + 7}
          apply mul_nonneg
          simpa using h_{i + 8}
          apply mul_nonneg
          simpa using h_{i + 9}
          apply mul_nonneg
          simpa using h_{i + 10}
          apply mul_nonneg
          simpa using h_{i + 11}
          apply mul_nonneg
          simpa using h_{i + 12}
          apply mul_nonneg
          simpa using h_{i + 13}
          apply mul_nonneg
          simpa using h_{i + 14}
          apply mul_nonneg
          simpa using h_{i + 15}
          apply mul_nonneg
          simpa using h_{i + 16}
          apply mul_nonneg
          simpa using h_{i + 17}
          apply mul_nonneg
          simpa using h_{i + 18}
          apply mul_nonneg
          simpa using h_{i + 19}
        _ = (if 1 = j then 0 else a 0) * (a 1 *... * a n) := by simp
        _ ≤ (if j = j then 0 else a 0) * (a 1 *... * a n) := by
          -- If $1 \neq j$, then the two products are equal.
          rw [if_pos]
          -- If $1 = j$, then $a_0 = 0$.
          suffices a 0 = 0 by
            rw [if_neg, this]
            apply mul_le_mul_of_nonneg_right
            -- We know that $0 \leq (a_1 \cdot \ldots \cdot a_n)$.
            -- Show that the product is nonnegative.
            apply mul_nonneg
            apply mul_nonneg
            simpa using h_{i + 1}
            apply mul_nonneg
            simpa using h_{i + 2}
            apply mul_nonneg
            simpa using h_{i + 3}
            apply mul_nonneg
            simpa using h_{i + 4}
            apply mul_nonneg
            simpa using h_{i + 5}
            apply mul_nonneg
            simpa using h_{i + 6}
            apply mul_nonneg
            simpa using h_{i + 7}
            apply mul_nonneg
            simpa using h_{i + 8}
            apply mul_nonneg
            simpa using h_{i + 9}
            apply mul_nonneg
            simpa using h_{i + 10}
            apply mul_nonneg
            simpa using h_{i + 11}
            apply mul_nonneg
            simpa using h_{i + 12}
            apply mul_nonneg
            simpa using h_{i + 13}
            apply mul_nonneg
            simpa using h_{i + 14}
            apply mul_nonneg
            simpa using h_{i + 15}
            apply mul_nonneg
            simpa using h_{i + 16}
            apply mul_nonneg
            simpa using h_{i + 17}
            apply mul_nonneg
            simpa using h_{i + 18}
            apply mul_nonneg
            simpa using h_{i + 19}
          -- If $1 \neq j$, then $a_0 = 0$.
          by_contra! h₀
          obtain h₀ := h₀ 0
          simp at h₀
          obtain h₀ := h₀ (Finset.mem_range.mpr (by linarith))
          rw [<-h₀] at hj
          exact hx <| id (Eq.symm hj)
        _ = 0 := by simp
        _ ≤ 1 := by norm_num
  -- The sum of the elements in the range of $b$ is $n$, so the product is less than or equal to $1$.
  have h₃ : ((∑ x ∈ Finset.range n, (if x = j then 0 else a x) : NNReal) : ℝ) = n := by
    apply_fun (· : ℝ) at h₀
    simp at h₀
    rw [<-h₀]
    simp
  -- If the sum of the elements in the range of $b$ is exactly $n$, then the product is less than or equal to $1$.
  have h₄ : ((∏ x ∈ Finset.range n, (if x = j then 0 else a x) : NNReal) : ℝ) ≤ 1 := by
    generalize h : ∃ x : ℕ, ¬(if x = j then 0 else a x) = 0
    obtain ⟨x, hx⟩ := h
    -- If $a_j \neq 0$, then $b_j = a_j$.
    symm
    simp [<-h₃]
    -- Otherwise, we can find a sequence $c$ such that $c_j = 0$ and $c_i = a_i$ for $i \neq j$.
    have h₅ : ∃ c : ℕ → NNReal, (∑ x ∈ Finset.range n, c x = n) ∧ (∏ x ∈ Finset.range n, c x ≤ 1) ∧ (∀ i ∈ Finset.range n, c i = 0 ∨ c i = a i) ∧ (∃ j ∈ Finset.range n, c j = a j) := by
      -- Define the sequence $c$.
      use fun x => if x = j then a i else 0
      refine ⟨?_,?_,?_,?_⟩
      -- Show that the sum of the elements in the range of $c$ is $n$.
      · rw [Finset.sum_eq_natCast, Finset.sum_eq_natCast]
        apply Nat.cast_sum
        intro i hi
        simp
        by_cases hi' : i = j
        · rw [hi']
          -- If $i = j$, then $c_i = a_i$.
          simpa using ha_i
        · simp [hi]
          -- If $i \neq j$, then $c_i = 0$.
          apply le_of_eq
          simp [<-ha_i]
      -- Show that the product of the elements in the range of $c$ is less than or equal to $1$.
      · simp [Finset.prod_eq_natCast, Finset.prod_eq_natCast]
        apply Nat.cast_le_ofNat
        by_contra!
        simp at this
        obtain ⟨i, hi⟩ := this
        -- If the product is greater than $1$, then $a_i > 0$.
        have h_i : a i > 0