-- Lemma 1. Let $x$ be a real number such that $f(x) \leq 1$. Then, $f(x+a) \geq 1$.
  have h₂ (x : ℝ) (hx : f x ≤ 1) : f (x + a) ≥ 1 := by
    -- Substituting $x$ with $x+a$ in the given functional equation yields the equation.
    have h₂ (y : ℝ) : f (y + a) = 1 / 2 + Real.sqrt (f y - f y ^ 2) := by
      specialize h₁ y
      rw [← add_assoc, h₁]
      ring_nf
    -- Rewrite $x$ as $x+a$ in the hypothesis.
    rw [← h₂ x]
    -- Since $f(x) \leq 1$, it follows that $f(x+a) \geq 1$.
    have h₃ : f x - f x ^ 2 ≥ 1 / 4 := by
      calc
        f x - f x ^ 2 = f x * (1 - f x) := by ring
        _ ≥ f x * (1 - 1) := by
          apply mul_le_mul_of_nonneg_left
          · linarith only [hx]
          · linarith only [h₀]
        _ = 0 := by ring
    rw [show 1 / 2 + Real.sqrt (f x - f x ^ 2) = Real.sqrt (f x - f x ^ 2) + 1 / 2 by ring]
    suffices Real.sqrt (f x - f x ^ 2) ≥ 1 / 2 by
      linarith only [this]
    rw [show (1 / 2 : ℝ) = Real.sqrt (1 / 4) by norm_num [Real.sqrt_eq_iff_sq_eq]] at this
    apply Real.sqrt_le_sqrt
    linarith only [h₃]

  -- Lemma 2. Let $x$ be a real number such that $f(x) = 1$. Then, $f(x+a) = 1$.
  have h₃ (x : ℝ) (hx : f x = 1) : f (x + a) = 1 := by
    -- Substituting $x$ with $x+a$ in the given functional equation yields the equation.
    have h₂ (y : ℝ) : f (y + a) = 1 / 2 + Real.sqrt (f y - f y ^ 2) := by
      specialize h₁ y
      rw [← add_assoc, h₁]
      ring_nf
    -- Rewrite $x$ as $x+a$ in the hypothesis.
    rw [← h₂ x]
    -- Since $f(x) = 1$, it follows that $f(x+a) = 1$.
    norm_num [hx]

  -- Lemma 3. Let $x$ be a real number such that $f(x) ≥ 1$. Then, $f(x+a) ≤ 1$.
  have h₄ (x : ℝ) (hx : f x ≥ 1) : f (x + a) ≤ 1 := by
    -- Substituting $x$ with $x+a$ in the given functional equation yields the equation.
    have h₂ (y : ℝ) : f (y + a) = 1 / 2 + Real.sqrt (f y - f y ^ 2) := by
      specialize h₁ y
      rw [← add_assoc, h₁]
      ring_nf
    -- Rewrite $x$ as $x+a$ in the hypothesis.
    rw [← h₂ x]
    -- Since $f(x) ≥ 1$, it follows that $f(x+a) ≤ 1$.
    have h₅ : f x - f x ^ 2 ≤ 1 / 4 := by
      calc
        f x - f x ^ 2 = f x * (1 - f x) := by ring
        _ ≤ f x * (1 - 1) := by
          apply mul_le_mul_of_nonneg_left
          · linarith only [h₀]
          · linarith only [hx]
        _ = 0 := by ring
    rw [show 1 / 2 + Real.sqrt (f x - f x ^ 2) = Real.sqrt (f x - f x ^ 2) + 1 / 2 by ring]
    suffices Real.sqrt (f x - f x ^ 2) ≤ 1 / 2 by
      linarith only [this]
    rw [show (1 / 2 : ℝ) = Real.sqrt (1 / 4) by norm_num [Real.sqrt_eq_iff_sq_eq]] at this
    apply Real.sqrt_le_sqrt
    linarith only [h₅]

  -- Lemma 4. If $f(x) ≥ 1$, then $f(x+a) ≤ 1$.
  have h₅ (x : ℝ) (hx : f x ≥ 1) : f (x + a) ≤ 1 := by
    -- Apply Lemma 3 directly.
    apply h₄
    exact hx

  -- Lemma 5. If $f(x) ≤ 1$, then $f(x+a) ≥ 1$.
  have h₆ (x : ℝ) (hx : f x ≤ 1) : f (x + a) ≥ 1 := by
    -- Apply Lemma 1 directly.
    apply h₂
    exact hx

  -- Lemma 6. If $f(x) = 1$, then $f(x+a) = 1$.
  have h₇ (x : ℝ) (hx : f x = 1) : f (x + a) = 1 := by
    -- Apply Lemma 2 directly.
    apply h₃
    exact hx

  -- Lemma 7. If $f(x) ≥ 1$, then $f(x+a) ≤ 1$.
  have h₈ (x : ℝ) (hx : f x ≥ 1) : f (x + a) ≤ 1 := by
    -- Apply Lemma 4 directly.
    apply h₅
    exact hx

  -- Lemma 8. If $f(x) ≤ 1$, then $f(x+a) ≥ 1$.
  have h₉ (x : ℝ) (hx : f x ≤ 1) : f (x + a) ≥ 1 := by
    -- Apply Lemma 1 directly.
    apply h₂
    exact hx

  -- Lemma 9. For any integer $n$, $f(x+na) = f(x)$ if $f(x) = 1$.
  have h₁₀ (x : ℝ) (n : ℤ) (hx : f x = 1) : f (x + n * a) = 1 := by
    -- Inductive argument on $n$.
    have h₁₀ (n : ℕ) : f (x + n * a) = 1 := by
      induction n with
      | zero =>
        simp only [mul_zero, add_zero]
        exact hx
      | succ n ih =>
        rw [show (n + 1 : ℕ) = n + 1 by rfl, add_mul, add_assoc]
        simp only [mul_one, add_right_inj]
        exact h₇ (x + n * a) (ih)
    -- For negative $n$, apply Lemma 9 for $-n$ and then apply Lemma 1.
    induction n using Int.induction_on with
    | hz =>
      simp only [zify, Int.cast_zero, add_zero]
      exact hx
    | hp n ih =>
      have h₁₁ := h₈ (x + n * a) (ih)
      rw [show (n : ℤ) + 1 = (n + 1 : ℤ) by rfl, add_mul, add_assoc]
      simp only [zify, Int.cast_add, mul_add, add_right_inj]
      exact h₁₁
    | hn n ih =>
      have h₁₂ := h₉ (x + n * a) (ih)
      rw [show (n : ℤ) - 1 = (n - 1 : ℤ) by rfl, Int.cast_sub, mul_sub, add_right_inj, ih]
      rw [show (n : ℤ) - 1 + 1 = (n : ℤ) by exact Eq.symm (Int.add_sub_of_le (by simp only [Int.cast_nonneg]))]
      exact h₈ (x + n * a) (h₉ (x + n * a) (ih))

  -- Lemma 10. There exists a positive real number $b$ such that $f(x+b) = f(x)$ for all $x$.
  have h₁₁ : ∃ b > 0, ∀ x, f (x + b) = f x := by
    -- Let $b$ be the least common multiple of $a$ and $π$.
    let b := Nat.lcm a Real.pi
    use b
    constructor
    · -- It suffices to show that $b > 0$.
      apply Nat.lcm_pos
      exact h₀
      positivity
    · -- Let $x$ be a real number.
      intro x
      -- If $f(x) = 1$, then $f(x+b) = 1$ by Lemma 10.
      by_cases h₁₃ : f x = 1
      · rw [h₇ (x + b) (h₁₀ x b h₁₃)]
        exact h₁₃
      -- If $f(x) ≤ 1$, then $f(x+b) ≥ 1$ by Lemma 9.
      by_cases h₁₄ : f x ≤ 1
      · right
        exact h₉ (x + b) (h₅ x h₁₄)
      -- If $f(x) ≥ 1$, then $f(x+b) ≤ 1$ by Lemma 9.
      by_cases h₁₅ : f x ≥ 1
      · right
        exact h₈ (x + b) (h₆ x h₁₅)
      -- If $f(x) = 1$ for some $x$, then we expand the definition of $b$ and derive a contradiction.
      simp only [not_le] at h₁₄ h₁₅
      have h₁₆ := h₉ (x + b) (h₅ x (h₁₄.trans h₁₅))
      rw [show (x + b) + b = x + 2 * b by ring] at h₁₆
      have h₁₇ := h₅ (x + 2 * b) (h₆ x (h₁₄.trans h₁₅))
      rw [show (x + 2 * b) + b = x + 3 * b by ring] at h₁₇
      have h₁₈ := h₆ (x + 3 * b) (h₅ x (h₁₄.trans h₁₅))
      rw [show (x + 3 * b) + b = x + 4 * b by ring] at h₁₈
      have h₁₉ := h₅ (x + 4 * b) (h₆ x (h₁₄.trans h₁₅))
      rw [show (x + 4 * b) + b = x + 5 * b by ring] at h₁₉
      have h₁₁₀ := h₆ (x + 5 * b) (h₅ x (h₁₄.trans h₁₅))
      rw [show (x + 5 * b) + b = x + 6 * b by ring] at h₁₁₀
      -- Expanding the definition of $b$ and applying Lemma 9 and Lemma 10 finitely many times leads to a contradiction.
      have h₁₁₁ : x + 6 * b = x + (Nat.lcm a Real.pi : ℝ) := by
        simp only [Nat.cast_ofNat, b]
        rw [← mul_comm]
        simp only [mul_eq_mul_right_iff, OfNat.ofNat_ne_zero, or_false]
        exact Nat.lcm_dvd h₁₃ (by library)
      rw [h₁₁₀, h₁₉, h₈, h₆, h₅, h₄, h₃, h₄, h₅, h₆, h₅, h₄, h₅]
      rw [← h₁₁₀, h₁₈, h₁₆, h₁₇, h₁₉, h₁₀]
      linarith only [h₁₁₁, Real.pi_pos]

  -- Return the value $b$ satisfying the desired properties.
  exact h₁₁

```