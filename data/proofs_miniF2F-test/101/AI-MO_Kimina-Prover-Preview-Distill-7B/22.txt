-- determine f(1,y)
  have r1 (y) : f 1 (y + 1) = 2 ^ (y + 3) - 1 := by
    -- for this we need three auxilary functions.
    let g := fun x => f 1 x
    let h := fun x => f 2 x
    let k := fun x => f 3 x

    -- prove auxilary relation
    have hg (x) : g x = 2 ^ (x + 1) - 1 := by
      induction x with
      | zero => simp [g]
      | succ x ih =>
        calc
          g (x + 1) = f 1 (x + 1) := by simp [g]
          _ = f 2 x := by rw [h₁ x]
          _ = 2 ^ (x + 1) - 1 := by rw [ih]; ring_nf
    have hh (x) : h x = 2 ^ (x + 2) - 1 := by
      induction x with
      | zero => simp [h]
      | succ x ih =>
        calc
          h (x + 1) = f 2 (x + 1) := by simp [h]
          _ = f 3 x := by rw [h₁ x]
          _ = 2 ^ (x + 2) - 1 := by rw [ih]; ring_nf
    have hk (x) : k x = 2 ^ (x + 3) - 1 := by
      induction x with
      | zero => simp [k]
      | succ x ih =>
        calc
          k (x + 1) = f 3 (x + 1) := by simp [k]
          _ = f 4 x := by rw [h₁ x]
          _ = 2 ^ (x + 3) - 1 := by rw [ih]; ring_nf

    -- prove main relation
    have hg' (y x) : g (y + x + 1) = 2 ^ (y + x + 1) - 1 := by
      rw [hg]
    have hh' (y x) : h (y + x + 1) = 2 ^ (y + x + 2) - 1 := by
      rw [hh]
    have hk' (y x) : k (y + x + 1) = 2 ^ (y + x + 3) - 1 := by
      rw [hk]

    have hf (y x) : f 1 (y + x + 1) = 2 ^ (y + x + 3) - 1 := by
      calc
        f 1 (y + x + 1) = f 2 (y + x + 1) := by rw [h₁ (y + x + 1)]
        _ = f 3 x := by rw [h₁ (y + x)]
        _ = 2 ^ (y + x + 3) - 1 := by rw [hk x]
    calc
      f 1 (y + 1) = f 1 (y + 0 + 1) := by simp
      _ = 2 ^ (y + 0 + 3) - 1 := by rw [hf y 0]
      _ = 2 ^ (y + 3) - 1 := by simp

  -- determine f(2,y)
  have r2 (y) : f 2 (y + 1) = 2 ^ (y + 4) - 3 := by
    -- for this we need three auxilary functions.
    let g := fun x => f 2 x
    let h := fun x => f 3 x
    let k := fun x => f 4 x

    -- prove auxilary relation
    have hg (x) : g x = 2 ^ (x + 2) - 1 := by
      induction x with
      | zero => simp [g]
      | succ x ih =>
        calc
          g (x + 1) = f 2 (x + 1) := by simp [g]
          _ = f 3 x := by rw [h₁ x]
          _ = 2 ^ (x + 2) - 1 := by rw [ih]; ring_nf
    have hh (x) : h x = 2 ^ (x + 3) - 1 := by
      induction x with
      | zero => simp [h]
      | succ x ih =>
        calc
          h (x + 1) = f 3 (x + 1) := by simp [h]
          _ = f 4 x := by rw [h₁ x]
          _ = 2 ^ (x + 3) - 1 := by rw [ih]; ring_nf
    have hk (x) : k x = 2 ^ (x + 4) - 1 := by
      induction x with
      | zero => simp [k]
      | succ x ih =>
        calc
          k (x + 1) = f 4 (x + 1) := by simp [k]
          _ = f 5 x := by rw [h₁ x]
          _ = 2 ^ (x + 4) - 1 := by rw [ih]; ring_nf

    -- prove main relation
    have hh' (y x) : h (y + x + 2) = 2 ^ (y + x + 4) - 1 := by
      have : y + x + 2 = y + (x + 2) := by simp
      rw [this]
      nth_rw 2 [← hg (x + 2)]
      rw [← hh x]
      ring_nf
    have hk' (y x) : k (y + x + 2) = 2 ^ (y + x + 5) - 1 := by
      have : y + x + 2 = y + (x + 2) := by simp
      rw [this]
      nth_rw 2 [← hg (x + 2)]
      rw [← hh x]
      ring_nf

    have hf (y x) : f 2 (y + x + 2) = 2 ^ (y + x + 5) - 1 := by
      calc
        f 2 (y + x + 2) = f 3 (y + x + 2) := by rw [h₁ (y + x + 2)]
        _ = f 4 x := by rw [h₁ (y + x)]
        _ = 2 ^ (y + x + 5) - 1 := by rw [hk x]
    calc
      f 2 (y + 1) = f 2 (y + 0 + 1) := by simp
      _ = 2 ^ (y + 0 + 5) - 1 := by rw [hf y 0]
      _ = 2 ^ (y + 5) - 1 := by simp
      _ = 2 ^ (y + 4 + 1) - 1 := by ring_nf
      _ = 2 ^ (y + 4) - 1 := by rw [Nat.pow_add_right 2 1]; ring_nf

  -- determine f(3,y)
  have r3 (y) : f 3 (y + 1) = 2 ^ (y + 5) - 7 := by
    -- for this we need three auxilary functions.
    let g := fun x => f 3 x
    let h := fun x => f 4 x
    let k := fun x => f 5 x

    -- prove auxilary relation
    have hg (x) : g x = 2 ^ (x + 3) - 1 := by
      induction x with
      | zero => simp [g]
      | succ x ih =>
        calc
          g (x + 1) = f 3 (x + 1) := by simp [g]
          _ = f 4 x := by rw [h₁ x]
          _ = 2 ^ (x + 3) - 1 := by rw [ih]; ring_nf
    have hh (x) : h x = 2 ^ (x + 4) - 1 := by
      induction x with
      | zero => simp [h]
      | succ x ih =>
        calc
          h (x + 1) = f 4 (x + 1) := by simp [h]
          _ = f 5 x := by rw [h₁ x]
          _ = 2 ^ (x + 4) - 1 := by rw [ih]; ring_nf
    have hk (x) : k x = 2 ^ (x + 5) - 1 := by
      induction x with
      | zero => simp [k]
      | succ x ih =>
        calc
          k (x + 1) = f 5 (x + 1) := by simp [k]
          _ = f 6 x := by rw [h₁ x]
          _ = 2 ^ (x + 5) - 1 := by rw [ih]; ring_nf

    -- prove main relation
    have hh' (y x) : h (y + x + 3) = 2 ^ (y + x + 6) - 1 := by
      have : y + x + 3 = y + (x + 3) := by simp
      rw [this]
      nth_rw 2 [← hg (x + 3)]
      rw [← hh x]
      ring_nf
    have hk' (y x) : k (y + x + 3) = 2 ^ (y + x + 7) - 1 := by
      have : y + x + 3 = y + (x + 3) := by simp
      rw [this]
      nth_rw 2 [← hg (x + 3)]
      rw [← hh x]
      ring_nf

    have hf (y x) : f 3 (y + x + 3) = 2 ^ (y + x + 7) - 1 := by
      calc
        f 3 (y + x + 3) = f 4 (y + x + 3) := by rw [h₁ (y + x + 3)]
        _ = f 5 x := by rw [h₁ (y + x)]
        _ = 2 ^ (y + x + 7) - 1 := by rw [hk x]
    calc
      f 3 (y + 1) = f 3 (y + 0 + 1) := by simp
      _ = 2 ^ (y + 0 + 7) - 1 := by rw [hf y 0]
      _ = 2 ^ (y + 7) - 1 := by simp
      _ = 2 ^ (y + 5 + 2) - 1 := by ring_nf
      _ = 2 ^ (y + 5) - 1 := by rw [Nat.pow_add_right 2 2]; ring_nf

  -- determine f(4,y)
  have r4 (y) : f 4 (y + 1) = 2 ^ (y + 7) - 15 := by
    -- for this we need three auxilary functions.
    let g := fun x => f 4 x
    let h := fun x => f 5 x
    let k := fun x => f 6 x

    -- prove auxilary relation
    have hg (x) : g x = 2 ^ (x + 4) - 1 := by
      induction x with
      | zero => simp [g]
      | succ x ih =>
        calc
          g (x + 1) = f 4 (x + 1) := by simp [g]
          _ = f 5 x := by rw [h₁ x]
          _ = 2 ^ (x + 4) - 1 := by rw [ih]; ring_nf
    have hh (x) : h x = 2 ^ (x + 5) - 1 := by
      induction x with
      | zero => simp [h]
      | succ x ih =>
        calc
          h (x + 1) = f 5 (x + 1) := by simp [h]
          _ = f 6 x := by rw [h₁ x]
          _ = 2 ^ (x + 5) - 1 := by rw [ih]; ring_nf
    have hk (x) : k x = 2 ^ (x + 6) - 1 := by
      induction x with
      | zero => simp [k]
      | succ x ih =>
        calc
          k (x + 1) = f 6 (x + 1) := by simp [k]
          _ = f 7 x := by rw [h₁ x]
          _ = 2 ^ (x + 6) - 1 := by rw [ih]; ring_nf

    -- prove main relation
    have hh' (y x) : h (y + x + 4) = 2 ^ (y + x + 8) - 1 := by
      have : y + x + 4 = y + (x + 4) := by simp
      rw [this]
      nth_rw 2 [← hg (x + 4)]
      rw [← hh x]
      ring_nf
    have hk' (y x) : k (y + x + 4) = 2 ^ (y + x + 9) - 1 := by
      have : y + x + 4 = y + (x + 4) := by simp
      rw [this]
      nth_rw 2 [← hg (x + 4)]
      rw [← hh x]
      ring_nf

    have hf (y x) : f 4 (y + x + 4) = 2 ^ (y + x + 9) - 1 := by
      calc
        f 4 (y + x + 4) = f 5 (y + x + 4) := by rw [h₁ (y + x + 4)]
        _ = f 6 x := by rw [h₁ (y + x)]
        _ = 2 ^ (y + x + 9) - 1 := by rw [hk x]
    calc
      f 4 (y + 1) = f 4 (y + 0 + 1) := by simp
      _ = 2 ^ (y + 0 + 9) - 1 := by rw [hf y 0]
      _ = 2 ^ (y + 9) - 1 := by simp
      _ = 2 ^ (y + 7 + 2) - 1 := by ring_nf
      _ = 2 ^ (y + 7) - 1 := by rw [Nat.pow_add_right 2 2]; ring_nf

  -- finally we get the result
  intro y
  calc
    f 4 (y + 1) = 2 ^ (y + 7) - 15 := by rw [r4 y]
    _ = 2 ^ (y + 3 + 4) - 15 := by ring_nf
    _ = 2 ^ (y + 3) * 2 ^ 4 - 15 := by rw [Nat.pow_add_right 2 4]
    _ = 2 ^ (y + 3) * 16 - 15 := by norm_num
    _ = 2 ^ (y + 3) * (1 + 15) - 15 := by norm_num
    _ = 2 ^ (y + 3) * 1 + 2 ^ (y + 3) * 15 - 15 := by ring_nf
    _ = 2 ^ (y + 3) + (2 ^ (y + 3) * 15 - 15) := by ring_nf
    _ = 2 ^ (y + 3) + 15 * (2 ^ (y + 3) - 1) := by ring_nf
    _ = 2 ^ (y + 3) + 15 * (2 ^ (y + 2 + 1) - 1) := by congr
    _ = 2 ^ (y + 3) + 15 * (2 ^ (y + 2) * 2 ^ 1 - 1) := by rw [Nat.pow_add_right 2 1]
    _ = 2 ^ (y + 3) + 15 * (2 ^ (y + 2) * 2 - 1) := by norm_num
    _ = 2 ^ (y + 3) + 15 * (2 ^ (y + 2) * 2) - 15 * 1 := by ring_nf
    _ = 2 ^ (y + 3) + 30 * (2 ^ (y + 2) - 1) - 15 * 1 := by rw [← r1 y]; ring_nf
    _ = 2 ^ (y + 3) + 30 * (2 ^ (y + 2) - 1) - 15 := by norm_num
    _ = 2 ^ (y + 3) - 30 * (2 ^ (y + 2) - 1) + 30 * (2 ^ (y + 2) - 1) - 15 := by ring_nf
    _ = 2 ^ (y + 3) - 30 * (2 ^ (y + 2) - 1) + (30 * (2 ^ (y + 2) - 1) - 15) := by ring_nf
    _ = 2 ^ (y + 3) - 30 * (2 ^ (y + 2) - 1) + 15 * (2 ^ (y + 2) - 1) := by ring_nf
    _ = 2 ^ (y + 3) - 15 * (2 ^ (y + 2) - 1) * (30 - 1) := by ring_nf
    _ = 2 ^ (y + 3) - 15 * (2 ^ (y + 2) - 1) *