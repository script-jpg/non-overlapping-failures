-- We need to import Mathlib and Aesop to use their tactics.

  import Mathlib
  import Aesop

  set_option maxHeartbeats 0

  open BigOperators Real Nat Topology Rat

  /- What is the remainder when $129^{34}+96^{38}$ is divided by $11$? Show that it is 9.-/

  theorem mathd_numbertheory_769 : (129 ^ 34 + 96 ^ 38) % 11 = 9 := by

    -- The basic idea is that 129 ≡ 7 (mod 11), 96 ≡ 9 (mod 11), and 7^34 + 9^38 ≡ 9 (mod 11).
    -- To show this, we need a few helper facts.

    -- 129 ≡ 7 (mod 11)
    have fact1 : 129 ≡ 7 [MOD 11] := by
      decide

    -- 96 ≡ 9 (mod 11)
    have fact2 : 96 ≡ 9 [MOD 11] := by
      decide

    -- x ≡ y (mod n) → x^k ≡ y^k (mod n)
    have fact3 {x y n : ℕ} (h : x ≡ y [MOD n]) (k : ℕ) : x ^ k ≡ y ^ k [MOD n] := by
      exact Nat.ModEq.pow k h

    -- 7^34 ≡ 9 (mod 11)
    have fact4 : 7 ^ 34 ≡ 9 [MOD 11] := by
      -- 7^34 ≡ 7^33 * 7 ≡ 7^33 * 7^34 (mod 11)
      have : 7 ^ 34 ≡ 7 ^ 33 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (33)) (fact3 fact1 (1))
      rw [show 33 = 34 - 1 by omega, pow_succ] at this
      -- 7^33 ≡ 7^32 * 7 (mod 11)
      have : 7 ^ 33 ≡ 7 ^ 32 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (32)) (fact3 fact1 (1))
      rw [show 32 = 34 - 2 by omega, pow_succ] at this
      -- 7^32 ≡ 7^31 * 7 (mod 11)
      have : 7 ^ 32 ≡ 7 ^ 31 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (31)) (fact3 fact1 (1))
      rw [show 31 = 34 - 3 by omega, pow_succ] at this
      -- 7^31 ≡ 7^30 * 7 (mod 11)
      have : 7 ^ 31 ≡ 7 ^ 30 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (30)) (fact3 fact1 (1))
      rw [show 30 = 34 - 4 by omega, pow_succ] at this
      -- 7^30 ≡ 7^29 * 7 (mod 11)
      have : 7 ^ 30 ≡ 7 ^ 29 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (29)) (fact3 fact1 (1))
      rw [show 29 = 34 - 5 by omega, pow_succ] at this
      -- 7^29 ≡ 7^28 * 7 (mod 11)
      have : 7 ^ 29 ≡ 7 ^ 28 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (28)) (fact3 fact1 (1))
      rw [show 28 = 34 - 6 by omega, pow_succ] at this
      -- 7^28 ≡ 7^27 * 7 (mod 11)
      have : 7 ^ 28 ≡ 7 ^ 27 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (27)) (fact3 fact1 (1))
      rw [show 27 = 34 - 7 by omega, pow_succ] at this
      -- 7^27 ≡ 7^26 * 7 (mod 11)
      have : 7 ^ 27 ≡ 7 ^ 26 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (26)) (fact3 fact1 (1))
      rw [show 26 = 34 - 8 by omega, pow_succ] at this
      -- 7^26 ≡ 7^25 * 7 (mod 11)
      have : 7 ^ 26 ≡ 7 ^ 25 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (25)) (fact3 fact1 (1))
      rw [show 25 = 34 - 9 by omega, pow_succ] at this
      -- 7^25 ≡ 7^24 * 7 (mod 11)
      have : 7 ^ 25 ≡ 7 ^ 24 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (24)) (fact3 fact1 (1))
      rw [show 24 = 34 - 10 by omega, pow_succ] at this
      -- 7^24 ≡ 7^23 * 7 (mod 11)
      have : 7 ^ 24 ≡ 7 ^ 23 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (23)) (fact3 fact1 (1))
      rw [show 23 = 34 - 11 by omega, pow_succ] at this
      -- 7^23 ≡ 7^22 * 7 (mod 11)
      have : 7 ^ 23 ≡ 7 ^ 22 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (22)) (fact3 fact1 (1))
      rw [show 22 = 34 - 12 by omega, pow_succ] at this
      -- 7^22 ≡ 7^21 * 7 (mod 11)
      have : 7 ^ 22 ≡ 7 ^ 21 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (21)) (fact3 fact1 (1))
      rw [show 21 = 34 - 13 by omega, pow_succ] at this
      -- 7^21 ≡ 7^20 * 7 (mod 11)
      have : 7 ^ 21 ≡ 7 ^ 20 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (20)) (fact3 fact1 (1))
      rw [show 20 = 34 - 14 by omega, pow_succ] at this
      -- 7^20 ≡ 7^19 * 7 (mod 11)
      have : 7 ^ 20 ≡ 7 ^ 19 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (19)) (fact3 fact1 (1))
      rw [show 19 = 34 - 15 by omega, pow_succ] at this
      -- 7^19 ≡ 7^18 * 7 (mod 11)
      have : 7 ^ 19 ≡ 7 ^ 18 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (18)) (fact3 fact1 (1))
      rw [show 18 = 34 - 16 by omega, pow_succ] at this
      -- 7^18 ≡ 7^17 * 7 (mod 11)
      have : 7 ^ 18 ≡ 7 ^ 17 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (17)) (fact3 fact1 (1))
      rw [show 17 = 34 - 17 by omega, pow_succ] at this
      -- 7^17 ≡ 7^16 * 7 (mod 11)
      have : 7 ^ 17 ≡ 7 ^ 16 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (16)) (fact3 fact1 (1))
      rw [show 16 = 34 - 18 by omega, pow_succ] at this
      -- 7^16 ≡ 7^15 * 7 (mod 11)
      have : 7 ^ 16 ≡ 7 ^ 15 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (15)) (fact3 fact1 (1))
      rw [show 15 = 34 - 19 by omega, pow_succ] at this
      -- 7^15 ≡ 7^14 * 7 (mod 11)
      have : 7 ^ 15 ≡ 7 ^ 14 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (14)) (fact3 fact1 (1))
      rw [show 14 = 34 - 20 by omega, pow_succ] at this
      -- 7^14 ≡ 7^13 * 7 (mod 11)
      have : 7 ^ 14 ≡ 7 ^ 13 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (13)) (fact3 fact1 (1))
      rw [show 13 = 34 - 21 by omega, pow_succ] at this
      -- 7^13 ≡ 7^12 * 7 (mod 11)
      have : 7 ^ 13 ≡ 7 ^ 12 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (12)) (fact3 fact1 (1))
      rw [show 12 = 34 - 22 by omega, pow_succ] at this
      -- 7^12 ≡ 7^11 * 7 (mod 11)
      have : 7 ^ 12 ≡ 7 ^ 11 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (11)) (fact3 fact1 (1))
      rw [show 11 = 34 - 23 by omega, pow_succ] at this
      -- 7^11 ≡ 7^10 * 7 (mod 11)
      have : 7 ^ 11 ≡ 7 ^ 10 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (10)) (fact3 fact1 (1))
      rw [show 10 = 34 - 24 by omega, pow_succ] at this
      -- 7^10 ≡ 7^9 * 7 (mod 11)
      have : 7 ^ 10 ≡ 7 ^ 9 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (9)) (fact3 fact1 (1))
      rw [show 9 = 34 - 25 by omega, pow_succ] at this
      -- 7^9 ≡ 7^8 * 7 (mod 11)
      have : 7 ^ 9 ≡ 7 ^ 8 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (8)) (fact3 fact1 (1))
      rw [show 8 = 34 - 26 by omega, pow_succ] at this
      -- 7^8 ≡ 7^7 * 7 (mod 11)
      have : 7 ^ 8 ≡ 7 ^ 7 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (7)) (fact3 fact1 (1))
      rw [show 7 = 34 - 27 by omega, pow_succ] at this
      -- 7^7 ≡ 7^6 * 7 (mod 11)
      have : 7 ^ 7 ≡ 7 ^ 6 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (6)) (fact3 fact1 (1))
      rw [show 6 = 34 - 28 by omega, pow_succ] at this
      -- 7^6 ≡ 7^5 * 7 (mod 11)
      have : 7 ^ 6 ≡ 7 ^ 5 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (5)) (fact3 fact1 (1))
      rw [show 5 = 34 - 29 by omega, pow_succ] at this
      -- 7^5 ≡ 7^4 * 7 (mod 11)
      have : 7 ^ 5 ≡ 7 ^ 4 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (4)) (fact3 fact1 (1))
      rw [show 4 = 34 - 30 by omega, pow_succ] at this
      -- 7^4 ≡ 7^3 * 7 (mod 11)
      have : 7 ^ 4 ≡ 7 ^ 3 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (3)) (fact3 fact1 (1))
      rw [show 3 = 34 - 31 by omega, pow_succ] at this
      -- 7^3 ≡ 7^2 * 7 (mod 11)
      have : 7 ^ 3 ≡ 7 ^ 2 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (2)) (fact3 fact1 (1))
      rw [show 2 = 34 - 32 by omega, pow_succ] at this
      -- 7^2 ≡ 7^1 * 7 (mod 11)
      have : 7 ^ 2 ≡ 7 ^ 1 * 7 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact1 (1)) (fact3 fact1 (1))
      rw [show 1 = 34 - 33 by omega, pow_succ] at this
      -- 7^1 ≡ 7 (mod 11)
      have : 7 ^ 1 ≡ 7 [MOD 11] := by
        exact fact1
      rw [this] at this
      -- 9 ≡ 9 (mod 11)
      exact this

    -- 9^38 ≡ 9 (mod 11)
    have fact5 : 9 ^ 38 ≡ 9 [MOD 11] := by
      -- 9^38 ≡ 9^37 * 9 (mod 11)
      have : 9 ^ 38 ≡ 9 ^ 37 * 9 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact2 (37)) (fact3 fact2 (1))
      rw [show 37 = 38 - 1 by omega, pow_succ] at this
      -- 9^37 ≡ 9^36 * 9 (mod 11)
      have : 9 ^ 37 ≡ 9 ^ 36 * 9 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact2 (36)) (fact3 fact2 (1))
      rw [show 36 = 38 - 2 by omega, pow_succ] at this
      -- 9^36 ≡ 9^35 * 9 (mod 11)
      have : 9 ^ 36 ≡ 9 ^ 35 * 9 ^ 1 [MOD 11] := by
        apply Nat.ModEq.mul (fact3 fact2 (35)) (fact3 fact2 (1