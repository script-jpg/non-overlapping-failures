-- We first show that the following inequality holds:
  -- $\frac{a^2}{b+c-a}+\frac{b^2}{c+a-b}+\frac{c^2}{a+b-c}\geq 3\sqrt{3}abc$.
  have H {a b c : ℝ} (h₀ : 0 < a ∧ 0 < b ∧ 0 < c) (h₁ : c < a + b) (h₂ : b < a + c)
      (h₃ : a < b + c) :
      a ^ 2 / (b + c - a) + b ^ 2 / (c + a - b) + c ^ 2 / (a + b - c) ≥ 3 * √3 * a * b * c := by
    -- Perform a substitution to simplify the inequality.
    set x := b + c - a with hx
    set y := c + a - b with hy
    set z := a + b - c with hz

    -- Perform some simple calculations.
    have : a = y + z := by linarith
    have : b = z + x := by linarith
    have : c = x + y := by linarith

    -- Prove that $x, y, z$ are positive.
    have hxpos : 0 < x := by linarith
    have hypos : 0 < y := by linarith
    have hzpos : 0 < z := by linarith

    -- Rewrite the inequality in terms of $x, y, z$.
    rw [←hx, ←hy, ←hz]
    clear_value x y z

    -- We have $\frac{(y+z)^2}{x}+\frac{(z+x)^2}{y}+\frac{(x+y)^2}{z}\geq 3\sqrt{3}xyz$.
    have H₁ : (y + z) ^ 2 / x + (z + x) ^ 2 / y + (x + y) ^ 2 / z ≥ 3 * √3 * (x * y * z) := by
      -- The following key inequality is due to Cauchy-Schwarz:
      -- $(y^2+z^2+2yz)(z^2+x^2+2zx)(x^2+y^2+2xy)\geq 8\sqrt{3}x^2y^2z^2$.
      have H₂ : (y ^ 2 + z ^ 2 + 2 * y * z) * (z ^ 2 + x ^ 2 + 2 * z * x) * (x ^ 2 + y ^ 2 + 2 * x * y) ≥ 8 * √3 * (x * y * z) ^ 2 := by
        calc _ = (x ^ 3 + 2 * x ^ 2 * y + 2 * x ^ 2 * z + 3 * x * y * z + 2 * x * y ^ 2 + 2 * x * z ^ 2 + y ^ 3 + 2 * y ^ 2 * z + 2 * y * z ^ 2 + z ^ 3) ^ 2 := by
            ring
          _ ≥ (8 * √3 * (x * y * z)) ^ 2 := by
            apply sq_le_sq.mpr
            apply le_of_mul_le_mul_left
            positivity
            calc _ = 8 * (x * y * z) * (√3 * (x * y * z)) := by ring
              _ ≤ (x ^ 3 + 2 * x ^ 2 * y + 2 * x ^ 2 * z + 3 * x * y * z + 2 * x * y ^ 2 + 2 * x * z ^ 2 + y ^ 3 + 2 * y ^ 2 * z + 2 * y * z ^ 2 + z ^ 3) * (√3 * (x * y * z)) := by
                apply mul_le_mul_of_nonneg_left
                positivity
                apply mul_nonneg
                positivity
                positivity
              _ = _ := by ring
    -- Perform a substitution to simplify the inequality.
    set p := x * y * z with hp
    clear_value p

    -- Transform the inequality into a form involving $p$.
    have H₃ : 3 * √3 * p * (1 / x + 1 / y + 1 / z) ≥ 8 * √3 * p := by
      calc _ = 3 * √3 * p * (x + y + z) / (x * y * z) := by
          field_simp
          ring
        _ = 3 * √3 * (x + y + z) * (x * y * z) * (1 / x + 1 / y + 1 / z) / (x * y * z) := by
          field_simp
          ring
        _ = 3 * √3 * (x + y + z) * (x * y * z) * (1 / x + 1 / y + 1 / z) / (x * y * z) := by rfl
        _ ≥ 8 * √3 * (x * y * z) * (1 / x + 1 / y + 1 / z) / (x * y * z) := by
          apply div_le_div_of_nonneg_right
          positivity
          apply mul_le_mul_of_nonneg_left
          positivity
          exact H₂
        _ = _ := by
          rw [hp]
          field_simp
          ring

    -- Rearrange the inequality to the desired form.
    calc _ = 3 * √3 * p * (1 / x + 1 / y + 1 / z) := by
        rw [hp]
        field_simp
        ring
      _ ≥ 8 * √3 * p := by
        exact H₃
      _ = 8 * √3 * (x * y * z) := by
        rw [hp]
      _ ≥ 3 * √3 * (x * y * z) := by
        nth_rewrite 2 [mul_comm]
        apply mul_le_mul_of_nonneg_left
        positivity
        positivity

    -- The following inequality is due to AM-GM:
    -- $x^3+y^3+z^3-3xyz\geq 0$.
    have H₂ : x ^ 3 + y ^ 3 + z ^ 3 - 3 * x * y * z ≥ 0 := by
      calc _ = (x + y + z) * (x ^ 2 + y ^ 2 + z ^ 2 - x * y - x * z - y * z) := by ring
        _ = (x + y + z) * ((x - y) ^ 2 + (y - z) ^ 2 + (z - x) ^ 2) / 2 := by ring
        _ ≥ 0 := by
          apply mul_nonneg
          positivity
          positivity

    -- The desired inequality follows from the above inequalities.
    calc _ = (x ^ 3 + y ^ 3 + z ^ 3 - 3 * x * y * z) * (√3 * (1 / x + 1 / y + 1 / z) - 3) + 3 * √3 * (x * y * z) := by ring
      _ ≥ 0 + 3 * √3 * (x * y * z) := by
        apply add_le_add
        positivity
        apply mul_le_mul_of_nonneg_left
        positivity
        apply div_le_div_of_nonneg_right
        positivity
        exact H₁
      _ = 3 * √3 * (x * y * z) := by ring

  -- We can now prove the desired inequality.
  calc _ = a ^ 2 * (b + c - a) + b ^ 2 * (c + a - b) + c ^ 2 * (a + b - c) + 3 * a * b * c - 3 * a * b * c := by ring
    _ = _ := by
      linarith [H h₀ h₁ h₂ h₃]

```